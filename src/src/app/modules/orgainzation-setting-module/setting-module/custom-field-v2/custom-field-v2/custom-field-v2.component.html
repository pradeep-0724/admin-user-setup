<div >
  
  <div class="d-flex justify-content-between align-items-center py-3 px-4">
    <button  type="button" class="custom-collapse-toggle " data-bs-toggle="collapse" data-bs-target="#customer-freight-toggle" aria-expanded="true" aria-controls="customer-freight-toggle">
      <button class="collapse-arrow">
      <i class="bi bi-caret-down-fill " ></i>
      </button> 
      <span class="ms-3">{{previewName}}</span>
</button>

<button class="btn btn--primary float-end" (click)="showAddCustomField=true">Add Column Field</button>
  </div>
  <div class="collapse custom-collapse-content show def-color " id="customer-freight-toggle">
    <div class="d-flex justify-content-between def-color fw-semibold my-3 mb-4 px-4">
      <span>Preview</span>
      <div>
      <span class="me-4 ">Client Column: <span class="green-text">{{clientColumn}} </span>/{{maxClientColumn}}</span>
      <span > Active Column: <span class="primary-brand-text">{{activeColumn}}</span></span>

    </div>
    </div>
    <div class="px-4">
      <div class="overflow-auto">
      <table>
        <thead>
          <tr> 
            <ng-container  *ngIf="showOnlyNonPrivate">
              <ng-container *ngFor="let col of selectedColumnList" >
                <ng-container *ngIf="!col.is_private">
                  <th  *ngIf="col.key !='description'">
                    {{col.field_label}} 
                  </th>  
                </ng-container>
               
  
              </ng-container>
            </ng-container>
            <ng-container  *ngIf="!showOnlyNonPrivate" >
              <ng-container *ngFor="let col of selectedColumnList" >
                <th  *ngIf="col.key !='description'">
                  {{col.field_label}} <span  *ngIf="col.key !='description' && col.is_private"class="gb-private-icon " [matTooltip]="'This is a private column'" matTooltipClass="material-toltip-class" matTooltipPosition="above">p</span>
                </th>  
  
              </ng-container>
            </ng-container>
          
           
          </tr>
        </thead>
        <tbody>
          <tr>

            <ng-container  *ngIf="showOnlyNonPrivate">
              <ng-container *ngFor="let col of selectedColumnList" >
                <ng-container *ngIf="!col.is_private">
                  <td  *ngIf="col.key !='description'">
                    <ng-container  *ngIf="col.field_type =='decimal'" >0</ng-container>
                    <ng-container  *ngIf="col.field_type =='date'" >DD/MM/YYYY</ng-container>
                    <ng-container  *ngIf="col.field_type =='string'" >Input</ng-container>
                    <ng-container  *ngIf="col.field_type =='select_option'" >
                      <p *ngIf="col.key=='make_model'">Select  &nbsp; &nbsp; | &nbsp; &nbsp;   Select </p>
                      <p *ngIf="col.key!='make_model'">Select  </p>
                    </ng-container>              
                  </td>  
                </ng-container>
              </ng-container>
            </ng-container>
            <ng-container  *ngIf="!showOnlyNonPrivate">
              <ng-container *ngFor="let col of selectedColumnList" >
                <td  *ngIf="col.key !='description'">
                  <ng-container  *ngIf="col.field_type =='decimal'" >0</ng-container>
                  <ng-container  *ngIf="col.field_type =='date'" >DD/MM/YYYY</ng-container>
                  <ng-container  *ngIf="col.field_type =='string'" >Input</ng-container>
                  <ng-container  *ngIf="col.field_type =='select_option'" >
                    <p *ngIf="col.key=='make_model'">Select  &nbsp; &nbsp; | &nbsp; &nbsp;   Select </p>
                    <p *ngIf="col.key!='make_model'">Select  </p>
                  </ng-container>              
                </td>  
              </ng-container>
            </ng-container>
          
          
          </tr>
          <tr >
            <ng-container *ngFor="let col of selectedColumnList" >
              <td [attr.colspan]="activeColumn"   *ngIf="col.key =='description'">
                <p class="preview custom-footer-bg">Enter Description</p>
              </td>
            </ng-container>
          
          </tr>


        </tbody>
      </table>
    </div>
    <form [formGroup]="customFieldForm" >
      <div class="d-flex flex-wrap py-4">
        <mat-checkbox formControlName="show_pdf_columns"  class="me-4" (change)="showPdfColumns()">Show only columns visible to Client.</mat-checkbox><mat-checkbox formControlName="hide_pdf_empty_columns" (change)="hidePdfEmptyColums()" >Hide the column from PDF if no data is found.</mat-checkbox>
      </div>
    </form>
    
        
     
    </div>
  </div>
  
  
  </div>




<form [formGroup]="customFieldForm" class="def-color ">
    <div formArrayName="custom_field">
        <div class="row mx-0 custom-footer-bg py-3 fw-semibold border-top border-bottom">
            <div class="col-md-2 pe-0">

            </div>
            <div class="col-md-3 pe-0 fs-12">
                FIELD NAME
            </div>
            <div class="col-md-2 pe-0 fs-12">
                FIELD TYPE
            </div>
            <div class="col-md-4 pe-0 fs-12 " >
                DESCRIPTION
            </div>
            <div class="col-md-1 pe-0"> 

            </div>
 
           </div>
      <div cdkDropList  
        (cdkDropListDropped)="drop($event)" class="drag-list">
        <div *ngFor="
            let control of customFieldForm.controls.custom_field['controls'];let i = index
          "  cdkDrag class="drag-item py-2" [cdkDragDisabled]="customFieldForm.controls.custom_field['controls'].length-1==i">
          <div class="row  mx-0" [formGroupName]="i">
            
           <div class="col-md-2 pe-0 d-flex align-items-end justify-content-around ">
            <mat-icon class="indicator-icon def-color drag-icon"    *ngIf="customFieldForm.controls.custom_field['controls'].length-1 ==i"></mat-icon>
            <mat-icon class="indicator-icon def-color drag-icon"  cdkDragHandle  *ngIf="customFieldForm.controls.custom_field['controls'].length-1 !=i">drag_indicator</mat-icon>

            <ng-container  *ngIf="control.get('display').value=='1'">
              <mat-icon style="color: #ACB5BD;" class="disabled" ngClass="" > visibility</mat-icon>
            </ng-container>

            <ng-container  *ngIf="control.get('display').value!='1'"> 
              <mat-icon [ngClass]="control.get('display').value=='2'?'green-text':'def-color'" (click)="changeVisibility(control)"> {{control.get('display').value=='2'?'visibility':'visibility_off'}}</mat-icon>
            </ng-container>
     
        </div>

            <ng-container  *ngIf="control.get('system_created').value">
              <div class="col-md-3 pe-0 mb-0 custom-box-input-wrap">
                <input type="text" class="box-input disabled-bg "  placeholder="123456" value="" formControlName="field_label" disabled>
               </div>
               <div class="col-md-2 pe-0 custom-box-input-wrap mb-0">
                <mat-form-field class="disabled-bg" >
                  <mat-select  formControlName="field_type" disabled >
                    <mat-option value="string">Text</mat-option>
                    <mat-option value="decimal">Number</mat-option>
                    <mat-option value="date">Date</mat-option>
                    <mat-option value="select_option">Dropdown</mat-option>
                  </mat-select>
                </mat-form-field>
               </div>
               <div class="col-md-4 pe-0 d-flex align-items-center ">
                  <p class="line-height-normal">{{control.get('description').value}}</p>              
               </div>
               <div class="col-1 pe-0 d-flex align-items-end justify-content-center">
                <button  class=" custom-delete-btn" [disabled]="!control.get('is_edit_deletable').value"><i
                  class="material-icons ">delete</i></button> 
               </div>
               <ng-container  *ngIf="control.get('display').value!='1'"> 
                <div class="col-10 offset-2"><mat-checkbox class="mt-2 def-color" formControlName="is_private" (change)="changePrivate(control)">Make private?</mat-checkbox><span class="fs-12px ms-2 warn-text" *ngIf="control.get('error_msg').value">You already selected {{maxClientColumn}} columns, If you want to view this column then hide another column or make it private.</span></div>
                </ng-container>
            </ng-container>

            <ng-container *ngIf="!control.get('system_created').value" >
              <div class="col-md-3 pe-0 mb-0 custom-box-input-wrap ">
                <input type="text" class="box-input" [ngClass]="{'fieldError':control.get('field_label').invalid}"  placeholder="123456" value="" (keyup)="changeFieldName(control)" formControlName="field_label">
                <p style="margin: 1px ; color: red;" *ngIf="control.get('field_label').touched && control.get('field_label').hasError('required')">This field is required</p>
               </div>
               <div class="col-md-2 pe-0 custom-box-input-wrap mb-0">
                <mat-form-field [ngClass]="{'disabled-bg':!control.get('is_edit_deletable').value}" >
                  <mat-select formControlName="field_type" (selectionChange)="changeFieldType(control)"  [disabled]="!control.get('is_edit_deletable').value" >
                    <mat-option value="string">Text</mat-option>
                    <mat-option value="decimal">Number</mat-option>
                    <mat-option value="date">Date</mat-option>
                    <mat-option value="select_option">Dropdown</mat-option>
                  </mat-select>
                </mat-form-field>
               </div>
               <div class="col-md-4 pe-0 mb-0 custom-box-input-wrap ">
                <input type="text" class="box-input"  placeholder="" value="" (keyup)="changeDescription(control)" formControlName="description">
               </div>
               <!-- <div class="col-md-4 pe-0 d-flex align-items-center ">
                <input type="text" class="box-input"  placeholder="123456" value="" (keyup)="changeFieldName(control)" formControlName="description">

    
               </div> -->
               <div class="col-1 pe-0 d-flex align-items-end justify-content-center">
                <button [disabled]="!control.get('is_edit_deletable').value"  class=" custom-delete-btn"><i
                  class="material-icons " (click)="deleteField(control)">delete</i></button> 
               </div>
               <ng-container  *ngIf="control.get('display').value!='1'"> 
                <div class="col-10 offset-2"><mat-checkbox class="mt-2 def-color" formControlName="is_private" (change)="changePrivate(control)">Make private?</mat-checkbox>
                  <span class="fs-12px ms-2 warn-text" *ngIf="control.get('error_msg').value">You already selected {{maxClientColumn}}  columns, If you want to view this column then hide another column or make it private.</span>
                  <span class="fs-12px ms-2 warn-text" *ngIf="control.get('api_error').value">Column Name already exists. Try different name.</span>
                </div>
                </ng-container>
            </ng-container>


          

          </div>
          
        </div>
     
      </div>
    </div>
  </form>
  <alert-popup [inputData]="popupInputData" (outputData)="confirmButton($event)"></alert-popup>
  <app-add-custom-field-v2 [clientColumn]="clientColumn" [maxClientColumn]="maxClientColumn" [showAddCustomField]="showAddCustomField" [customFieldUrl]="customFieldUrl" *ngIf="showAddCustomField" (modalClosed)="modalClosed($event)" ></app-add-custom-field-v2>

