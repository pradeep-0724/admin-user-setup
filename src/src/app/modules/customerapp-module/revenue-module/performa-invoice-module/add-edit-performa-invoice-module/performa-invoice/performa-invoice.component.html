<div class="right-section__header align-items-center justify-content-between">
    <h1 class="heading" *ngIf="invoiceId !=='null'">Edit Proforma Invoice</h1>
    <h1 class="heading" *ngIf="invoiceId =='null'">Add Proforma Invoice</h1>
    
    <!-- <button class="gb-video-play float-right"  (click)="openGothrough()">
      <i class="bi bi-play-circle-fill"></i>
  </button> -->
  </div>
  <form [formGroup]="addInvoiceForm">
    <div class="alert alert-primary" role="alert" *ngIf="invoiceDetails?.has_invoice">
      Invoice is already created, Invoice will not be updated on update of Proforma Invoice
    </div>
    <div class="alert-msg" *ngIf="apiError">
      <span class="icon-wrap"></span>
      <p class="message-cont">{{ apiError }}</p>
    </div>
    <div class="error-msg-list" *ngIf="globalFormErrorList.length > 0">
      <p class="message-head">{{ errorHeaderMessage }}</p>
      <span class="icon-wrap"></span>
      <ul *ngFor="let error of globalFormErrorList">
        <li class="message-cont">{{ error }}</li>
      </ul>
    </div>
    <div class="form-layout shadow-inset-top-lg form-layout--pd">
      <div class="form-layout__card active">
        <div class="form-body">
          <div class="row tabIndexActiveFields">
            <div class="col-lg-3 col-sm-6" [ngClass]="{disableInput: invoiceId !=='null'}">
              <div class="input-wrap error" [ngClass]="addErrorClass(addInvoiceForm.controls.party)">
                <label for="" class="input--required">Customer </label>
                <material-dropdown [searchable]="true" [addable]="true" class="dropDownWidth"
                  [selectedOption]="initialValues.party" [disabled]="invoiceId !=='null'" [party]="true"
                  (addPartyPopup)="openAddPartyModal($event)" (addValueToList)="addValueToPartyPopup($event)"
                  [params]="partyNamePopup">
                  <select #customSelect formControlName="party" class="no-style select--modify"
                    (change)="onPartySelected($event.target.value)" (change)="stopLoaderClasstoBody()">
                    <option *ngFor="let party of partyList" value="{{ party.id }}">
                      {{ party.party_display_name }}
                    </option>
                  </select>
                </material-dropdown>
                <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}} : {{gstin}} </span>
                <app-error [controlName]="addInvoiceForm.controls.party"></app-error>
                <!-- <span class="border-anim"></span> -->
              </div>
            </div>
  
            <div class="col-lg-3 col-sm-6">
              <div class="input-wrap">
                <label for="">Employee In Charge</label>
                <material-dropdown [searchable]="true" [selectedOption]="initialValues.employee" [addable]="false"
                  class="dropDownWidth" [addBlank]="true">
                  <select #customSelect formControlName="employee" class="no-style select--modify">
                    <option *ngFor="let employee of employeeList" value="{{ employee.id }}">
                      {{  employee.display_name }}
                    </option>
                  </select>
                </material-dropdown>
               <!--  <span class="border-anim"></span> -->
              </div>
            </div>
            <div class="col-lg-3 col-sm-6" [ngClass]="{disableInput: invoiceId !=='null'}">
              <div class="input-wrap error" [ngClass]="addErrorClass(addInvoiceForm.controls.invoice_number)">
                <label for="" class="input--required">Proforma Invoice No</label>
                <input type="text" class="no-style input--bd" [readonly]="{disableInput: invoiceId !=='null'}"
                  placeholder="Placeholder" maxlength="16" formControlName="invoice_number">
                <app-error [controlName]="addInvoiceForm.controls.invoice_number"></app-error>
                <!-- <span class="border-anim"></span> -->
              </div>
            </div>
            <div class="col-lg-3 col-sm-6">
              <div class="input-wrap error error--type-1" [ngClass]="addErrorClass(addInvoiceForm.controls.invoice_date)">
                <label for="" class="input--required">Proforma Invoice Date</label>
                <mat-form-field class="width--100">
                  <input matInput [matDatepicker]="invoice_date" (focus)="invoice_date.open()"
                    formControlName="invoice_date" (dateChange)="onDateSelection()" placeholder="DD/MM/YYYY" readonly>
                  <mat-datepicker-toggle matSuffix [for]="invoice_date"></mat-datepicker-toggle>
                  <mat-datepicker #invoice_date></mat-datepicker>
                </mat-form-field>
                <app-error [controlName]="addInvoiceForm.controls.invoice_date"></app-error>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6">
              <div class="input-wrap error" [ngClass]="addErrorClass(addInvoiceForm.controls.payment_term)">
                <label for="" class="input">Payment Term</label>
                <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" 
                  [selectedOption]="initialValues.paymentTerm">
                  <select #customSelect formControlName="payment_term" class="no-style select--modify"
                    (change)="onpaymentTermSelected($event.target.value)">
                    <option *ngFor="let option of paymentTermList" value="{{ option.id }}">
                      {{ option.label }}
                    </option>
                  </select>
                </material-dropdown>
                <app-error [controlName]="addInvoiceForm.controls.payment_term"></app-error>
                <!-- <span class="border-anim"></span> -->
              </div>
            </div>
            <div class="col-lg-3 col-sm-6">
              <div class="input-wrap error error--type-1" [ngClass]="addErrorClass(addInvoiceForm.controls.due_date)">
                <label for="" *ngIf="!isDueDateRequired">Due Date</label>
                <label for="" class="input--required" *ngIf="isDueDateRequired">Due Date</label>
                <mat-form-field class="width--100">
                  <input matInput [matDatepicker]="due_date" (focus)="due_date.open()" formControlName="due_date"
                    placeholder="DD/MM/YYYY" readonly>
                  <mat-datepicker-toggle matSuffix [for]="due_date"></mat-datepicker-toggle>
                  <mat-datepicker #due_date></mat-datepicker>
                </mat-form-field>
                <app-error [controlName]="addInvoiceForm.controls.due_date"></app-error>
              </div>
            </div>
            <div class="col-lg-3 col-sm-4">
              <div class="input-wrap error" [ngClass]="addErrorClass(addInvoiceForm.controls.bank_account)">
                <label for="" class="input">Bank</label>
                <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth"
                  [selectedOption]="initialValues.bank_account" [addBlank]="false">
                  <select #customSelect formControlName="bank_account" class="no-style select--modify">
                    <option *ngFor="let option of bankList" value="{{ option.id }}">
                      {{ option.display_name }}
                    </option>
                  </select>
                </material-dropdown>
                <app-error [controlName]="addInvoiceForm.controls.bank_account"></app-error>
                <!-- <span class="border-anim"></span> -->
              </div>
            </div>
  
            <div class="col-lg-3 col-sm-6">
              <div class="input-wrap ">
                <label for="" class="input">Reference No </label>
                <input type="text" class="no-style input--bd"
                  placeholder="Reference No" formControlName="reference_no">
                <!-- <span class="border-anim"></span> -->
              </div>
            </div>
  
            <div class="col-lg-3 col-sm-6">
              <div class="input-wrap">
                <label for="">Contact Person</label>
                <material-dropdown [searchable]="true" [selectedOption]="initialValues.contactperson" [addable]="false"
                  class="dropDownWidth" [addBlank]="true">
                  <select #customSelect formControlName="contact_person" class="no-style select--modify">
                    <option *ngFor="let contactperson of contactPersonList" value="{{ contactperson.id }}">
                      {{  contactperson.display_name }}
                    </option>
                  </select>
                </material-dropdown>
                <!-- <span class="border-anim"></span> -->
              </div>
            </div>
  
          </div>
          <div>
            <app-revenue-header-tax-box [ngClass]="{'hiddenContent':!isTax}" [partyDetailsData]="partyTaxDetails"
              (headerTaxDetails)="headerTaxDetails($event)" [taxFormValid]="taxFormValid" [editData]="editData">
            </app-revenue-header-tax-box>
          </div>
          <div *ngIf="selectedParty?.address && selectedParty?.address.length" class="col-lg-12">
            <app-address [address]="selectedParty?.address" (emitAddress)="getAddress($event)"></app-address>
          </div>
  
          <div class="form-layout__card mg-top-30">
            <ng-container *ngIf="doChallanExists || doTripChallanExists">
              <div class="form-layout__header">
                <h2 class="sub-heading"> Description</h2>
                <span class="collapse-line"></span>
              </div>
              <div class="challan-header p-0">
               
                <div [ngClass]="{'hiddenContent':!isTax}" class="tabIndexActiveFields">
                  <div class="input-wrap" [ngClass]="{disable: disableTax || !companyRegistered}">
                    <label>Populate item challan tax with</label>
                    <material-dropdown [disabled]="disableTax || !companyRegistered"
                      [selectedOption]="itemChallanCommonTax">
                      <select #customSelect class="no-style select--modify" (change)="onSelectPopulateTax($event)">
                        <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                          {{ option.label }}
                        </option>
                      </select>
                    </material-dropdown>
                     <span class="border-anim"></span>
                  </div>
                </div>
              </div>
            </ng-container>
            <div class="mg-top-30" *ngIf="tripChallansList.length > 0">
              <div
                class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg overflow-unset dropDownOverflow">
                <table class="table-container mat-icon-font-17">
                  <thead>
                    <tr class="desktop_th">
                      <th width=10%>Date</th>
                      <th width=10%>Vehicle No.</th>
                      <th width=10% *ngIf="isWorkOrderAvailable">Work Order No.</th>
                      <th width=10%>Freight</th>
                      <th width=10%>Charges</th>
                      <th width=10%>Deduction</th>
                      <th width=10%>Adjustments</th>
                      <th width=10% [ngClass]="{'hiddenContent':!isTax}">Tax</th>
                      <th width=13%>Net Amount</th>
                      <th width="10%">Balance</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody formArrayName="trip_challan">
                    <tr class="mobile-flex icon-14 tabIndexActive" *ngFor="let challan of addInvoiceForm.get('trip_challan').controls;let i_trip = index;"
                      [formGroupName]="i_trip">
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Date </h5>
                        <div class="filledData">{{ challan.value?.date }}</div>
                      </td>
                      <td class=" align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Vehicle No. </h5>
                        <div class="filledData">{{ challan.value?.vehicle }}</div>
                      </td>
                      <td class="max-wd-120 align-middle pt-1" *ngIf="isWorkOrderAvailable"> <h5 class="th_h5_mobile fw-semibold">{{terminology?.DN}} No.</h5>
                        <div class="filledData">{{ challan.value?.work_order_no }}</div>
                      </td>
                   
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Freight </h5>
                        <div class="editData">{{ challan.value?.freights }}
                           <button class="material-icons py-0 align-middle" (click)="editTripFreight(challan.value?.trip,challan.value?.work_order_no)"> create </button></div>
                      </td>
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Charges </h5>
                        <div class="editData">{{ challan.value?.charges }} <button class="material-icons py-0 align-middle"  (click)="editTripAddBillCharges(challan.value?.trip)" >create </button></div>
                      </td>
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Deduction </h5>
                        <div class="editData">{{ challan.value?.deductions }} <button class="material-icons py-0 align-middle"  (click)="editTripReduceBillCharges(challan.value?.trip)"> create </button></div>
                      </td>
  
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Adjustments </h5>
                        <div class="input-wrap"
                          [ngClass]="addErrorClass(addInvoiceForm.controls['trip_challan'].controls[i_trip].controls.adjustment)">
                          <input twoDigitDecimalNumber type="text" placeholder="1000" formControlName="adjustment"
                            class="error-box" (change)="calculationsChanged()">
                        </div>
                      </td>
  
                      <td class="max-wd-120 align-middle pt-1" [ngClass]="{'hiddenContent':!isTax}">
                        <div [ngClass]="{disable: disableTax || !companyRegistered}"> <h5 class="th_h5_mobile fw-semibold">Tax </h5>
                          <div class="select-wrap"
                            [ngClass]="addErrorClass(addInvoiceForm.controls['trip_challan'].controls[i_trip].controls.tax)">
                            <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth"
                              [addBlank]="false" [selectedOption]="initialValues.tripChallanTax[i_trip]"
                              [disabled]="disableTax || !companyRegistered">
                              <select #customSelect name="" class="no-style select--modify error-box"
                                formControlName="tax" (change)="setTripTaxValue(i_trip,$event);">
                                <option *ngFor="let option of taxOptions" value="{{ option.id }}">{{
                                                                option.label }}</option>
                              </select>
                            </material-dropdown>
                            <app-error
                              [controlName]="addInvoiceForm.controls['trip_challan'].controls[i_trip].controls.tax">
                            </app-error>
                          </div>
                        </div>
                      </td>
  
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Net Amount </h5>
                        <div class="filledData">{{ addInvoiceForm.controls['trip_challan'].controls[i_trip].controls.total_amount.value }} </div>
                      </td>
                      <td class="max-wd-120 align-middle pt-1"> <h5 class="th_h5_mobile fw-semibold">Balance </h5>
                        <div class="filledData">{{ addInvoiceForm.controls['trip_challan'].controls[i_trip].controls.balance.value }} </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="tabIndexActive">
              <app-trip-challan [tripId]="tripId" [alreadySelectedTripChallans]="tripChallansList"
                [inlineAdd]="tripChallanModelInline" [isAdd]="isTripAdd" (checkChallanExist)="checkTripChallanExist($event)"
                (onAddChallanClicked)="tripChallansSelected($event)"></app-trip-challan>
            </div>
          </div>
  
  
  
          <div class="form-layout__card mg-top-30">
            <div class="form-layout__header">
              <h2 class="sub-heading">Item Others</h2>
              <span class="collapse-line"></span>
            </div>
            <div class="mg-top-30">
              <div
                class="table-wrapper table-wrapper--type1 table-wrapper--type2  table--bd table--nobg dropDownOverflow">
                <table class="table-container">
                  <thead>
                    <tr class="desktop_th">
                      <th width=15%>Item</th>
                      <th width=13%>Total units</th>
                      <th width=7%>Unit</th>
                      <th width=9%>Rate per unit ({{ currency_type?.symbol}})</th>
                      <th width=9%>Amount ({{ currency_type?.symbol}})</th>
                      <th width=9%>Discount ({{ currency_type?.symbol}})</th>
                      <th width=11% [ngClass]="{'hiddenContent':!isTax}">Tax</th>
                      <th width=11%>Total ({{ currency_type?.symbol}})</th>
                      <th width=9%></th>
                    </tr>
                  </thead>
                  <tbody formArrayName="item_others">
                    <tr class="mobile-flex tabIndexActive"
                      *ngFor="let otherItem of addInvoiceForm.controls.item_others.controls; let i = index;"
                      [formGroupName]="i">
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Item</span>
                        <div class="select-wrap">
                          <material-dropdown [addable]="true" class="dropDownWidth" [maxLength]="36"
                            [addErrorClass]="addErrorClass(addInvoiceForm.controls.item_others.controls[i].controls.item)"
                            [item]="true" (addItemPopup)="openAddItemModal($event, i)" class="dropDownWidth"
                            (addValueToList)="addValueToMaterial($event)" [params]="materialParams"
                            [selectedOption]="initialValues.items[i]">
                            <select #customSelect formControlName="item" class="no-style select--modify"
                              (change)="onMaterialSelected($event, otherItem,i);">
                              <option *ngFor="let option of staticOptions.materialList" value="{{ option.id }}">
                                {{ option.name }}
                              </option>
                            </select>
                          </material-dropdown>
                        </div>
                      </td>
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Total units</span>
                        <div class="input-wrap">
                          <input positiveThreeDigitDecimalNumber type="text" placeholder="Eg.: 1234567"
                            formControlName="quantity" (change)="calculateItemOthersAmount(i)">
                        </div>
                      </td>
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Unit</span>
                        <div class="select-wrap">
                          <material-dropdown [searchable]="true" [addable]="false" [addBlank]="true" class="dropDownWidth"
                            [selectedOption]="initialValues.units[i]">
                            <select #customSelect formControlName="units" class="no-style select--modify">
                              <option *ngFor="let option of staticOptions.itemUnits" value="{{ option.id }}">
                                {{ option.label }}
                              </option>
                            </select>
                          </material-dropdown>
                        </div>
                      </td>
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Rate per unit ({{ currency_type?.symbol}})</span>
                        <div class="input-wrap">
                          <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="unit_cost"
                            (change)="calculateItemOthersAmount(i)">
                        </div>
                      </td>
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Amount ({{ currency_type?.symbol}})</span>
                        <div class="input-wrap" [ngClass]="addErrorClass(otherItem.controls.amount)">
                          <input positiveThreeDigitDecimalNumber type="text" class="error-box" placeholder="1000"
                            formControlName="amount" (change)="calculateItemOther(i)" [readonly]="otherItem.controls.item.value==null">
                        </div>
                      </td>
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Discount ({{ currency_type?.symbol}})</span>
                        <div class="input-wrap"
                          [ngClass]="addErrorClass(addInvoiceForm.controls.item_others.controls[i].controls.discount)">
                          <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="discount"
                            (change)="calculateOtherFinalAmount(i);" class="error-box">
                        </div>
                      </td>
                      <td [ngClass]="{'hiddenContent':! isTax}" class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Tax</span>
                        <div [ngClass]="{disable: disableTax || !companyRegistered}">
                          <div class="select-wrap">
                            <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth"
                              [selectedOption]="initialValues.tax[i]" [disabled]="disableTax || !companyRegistered">
                              <select #customSelect formControlName="tax" class="no-style select--modify"
                                (change)="calculationsChanged()">
                                <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                  {{ option.label }}
                                </option>
                              </select>
                            </material-dropdown>
                          </div>
                        </div>
                      </td>
                      <td class="max-wd-120">
                        <span class="th_h5_mobile fw-semibold">Total ({{ currency_type?.symbol}})</span>
                        <div class="input-wrap disabled">
                          <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" class="error-box"
                            formControlName="total_amount" [attr.disabled]="true">
                        </div>
                      </td>
                      <td class="mobile-width-100">
                        <button class="material-icons clear p-0 font-24" (click)="resetOther(otherItem, i)">remove_circle_outline</button>
                        <button class="material-icons delete p-0 font-24" (click)="removeOtherItem(i)"
                          *ngIf="addInvoiceForm.controls.item_others.controls.length !== 1">add_circle_outline</button>
                        <button class="material-icons add p-0 font-24" (click)="addMoreOtherItem()">add_circle_outline</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="table-footer-actions mg-top-20 tabIndexActive">
                <button class="clear-item p-0" (click)="clearAllOtherItems()">Remove all</button>
              </div>
            </div>
          </div>
  
          <div class="gst-table-wrapper mg-top-30">
  
            <div class="gst-main py-2">
                <div class="text-end fw-bold gst-left"> Subtotal Challan: </div>
                <div class="px-0  text-end fw-bold gst-right"> {{ currency_type?.symbol}} {{totals.subtotal_challan}}</div>
            </div>
            <div class="gst-main py-2">
              <div class="text-end fw-bold gst-left"> Subtotal Others: </div>
                <div class="px-0  text-end fw-bold gst-right"> {{ currency_type?.symbol}} {{totals.subtotal_others}}</div>
            </div>
            <div class="gst-main py-2">
              <div class="text-end fw-bold gst-left"> Subtotal:</div>
              <div class="px-0  text-end fw-bold gst-right"> {{ currency_type?.symbol}} {{ totals.subtotal }}</div>
            </div>
            <div class="gst-main" *ngFor="let percentageTotal of totals.taxes;" [ngClass]="{'hiddenContent':!isTax}">
                  <ng-container *ngIf="percentageTotal.total && percentageTotal.taxAmount>0">
                    <div class="text-end gst-left">
                      Include {{terminology.tax_type}} @{{ percentageTotal.value }}% on <span>{{ percentageTotal.total }}</span>:
                    </div>
                    <div class="px-0  text-end gst-right"> {{ percentageTotal.taxAmount }} </div>
                  </ng-container>
             </div>
             <div class="gst-main tabIndexActive">
              <div class="text-start pt-0 gst-left">
  
                  <div class="dropdown select-wrap">
                      <material-dropdown [selectedOption]="initialValues.adjustmentAccount" class=" text-end">
                        <select #customSelect formControlName="adjustment_account"
                          class="no-style select--modify">
                          <option *ngFor="let option of expenseAccountList" value="{{ option.id }}">
                            {{ option.name }}
                          </option>
                        </select>
                      </material-dropdown>
                    </div>
                    <div class="input"
                      [ngClass]="addErrorClass(addInvoiceForm.controls.adjustment_amount)">
                      <input twoDigitDecimalNumber type="text"
                        class="error-box" placeholder=""
                        formControlName="adjustment_amount" (change)="calculationsChanged()">
                    </div>
  
                    <div class="select-wrap d-inline-block" id="margin-left">
                      <select name="" class="no-style select--modify" formControlName="adjustment_choice"
                        (change)="calculationsChanged();">
                        <option value="0" selected>%</option>
                        <option value="1">{{ currency_type?.symbol}}</option>
                      </select>
                    </div>
  
                  </div>
                  <div class="px-0  text-end gst-right"> {{ currency_type?.symbol}} {{ totals.adjustment }} </div>
              </div>
  
  
  
  
            <div class="gst-main">
              <div class="text-end gst-left">
                                  <mat-checkbox [disableRipple]="true" (change)="onRoundOffEvent($event)"
                                    formControlName="is_roundoff">Round Off</mat-checkbox>
              </div>
              <div class="px-0  text-end fw-bold gst-right"> {{ currency_type?.symbol}} {{ totals.roundOffAmount }}</div>
            </div>
  
            <div class="text-end gst-main">
              <div class="text-end h5 gst-left"> <strong> Total: </strong></div>
              <div class="px-0 text-end ms-3 h5  gst-right"><strong> {{ currency_type?.symbol}} {{ totals.total }}  </strong></div>
            </div>
            <div class="text-end gst-main" *ngIf="totals.advanceTotal>0">
              <div class="text-end  gst-left">    Advance:    </div>
              <div class="px-0 text-end ms-3  gst-right">    {{ currency_type?.symbol}} {{ totals.advanceTotal }} </div>
            </div>
            <div class="text-end gst-main" *ngIf="totals.fuelTotal>0">
              <div class="text-end gst-left"> Fuel:  </div>
              <div class="px-0 text-end ms-3 gst-right">   {{ currency_type?.symbol}} {{ totals.fuelTotal }} </div>
            </div>
            <div class="text-end gst-main" *ngIf="totals.battaAdvance>0">
              <div class="text-end gst-left">   Driver Allowance: </div>
              <div class="px-0 text-end ms-3 gst-right">   {{ currency_type?.symbol}} {{ totals.battaAdvance }}  </div>
            </div>
            <div class="text-end gst-main">
              <div class="text-end gst-left h5"> <strong> Proforma Invoice Balance:</strong> </div>
              <div class="px-0 text-end ms-3 h5 gst-right">   <strong>{{ currency_type?.symbol}} {{ totals.invoiceBalance  }} </strong></div>
            </div>
          </div>
  
  <hr>
          <div class="form-layout__card notes mg-top-15">
            <div class="row tabIndexActiveFields">
  
              <div class="col-xl-3 col-lg-3  col-md-3 col-6">
                <div class="input-wrap mb-0 pb-3">
                  <label>Terms and Conditions</label>
                  <material-dropdown [addBlank]="true" [addable]="true" [disclaimer]="true"
                    (addDisclaimerPopup)="openAddDisclaimerModal($event)" [selectedOption]="initialValues.disclaimer"
                    (addValueToList)="addValueToDisclaimer($event)" [params]="disclaimerParams">
                    <select #customSelect formControlName="disclaimer" class="no-style select--modify">
                      <option *ngFor="let option of disclaimerList" value="{{ option.id }}">
                        {{ option.name }}
                      </option>
                    </select>
                  </material-dropdown>
                </div>
              </div>
  
  
              <div class="col-xl-3 col-lg-3  col-md-3 col-6">
                <div class="input-wrap clearfix">
                  <label for="" class="">Signature</label>
                  <div>
                    <material-dropdown [selectedOption]="initialValues.digitalSignature">
                      <select #customSelect class="no-style select--modify" formControlName="signature">
                        <option *ngFor="let option of digitalSignature " value="{{option.id}}">{{option.name}}
                        </option>
                      </select>
                    </material-dropdown>
                  </div>
                </div>
              </div>
  
  
              <div class="col-xl-3 col-lg-3  col-md-3 col-6">
                <div class="input-wrap mb-0 pb-3">
                  <label for="" class="">Narration</label>
                  <input type="text" class="no-style input--bd" placeholder="Comments" value=""
                    formControlName="optional_comments">
                </div>
              </div>
  
  
  
            </div>
          </div>
  
  
          <div class="form-layout__card mg-top-30">
            <file-uploader (onFileUploaded)="fileUploader($event)" (onFileDeleted)="fileDeleted($event)" [multiple]="true"
              [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'" [showFileName]="false"
              [patchFileUrls]="patchFileUrls">
            </file-uploader>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">
     
  
        <button class="btn  btn--sm " type="button" [routerLink]="[preFixUrl+'/income/performa-invoice/list']">Cancel</button>
        <button class="btn  btn--primary btn--default btn-mg-left w-auto btn--dropdown saveButton"
          (click)="saveButton = !saveButton" (click)="RemoveLoaderClasstobody()">{{invoiceId ==='null'?'Save':"Update"}} Proforma Invoice<i
            class="material-icons">arrow_drop_down</i>
          <div class="more-actions__menu "id="custom-dropdown-top" [ngClass]="{'show': saveButton}">
            <button class="more-actions__item  w-100 text-start" type="click" (click)="submitInvoiceForm()">Save & Submit</button>
            <div *ngIf="invoiceId !=='null'">
              <button class="more-actions__item w-100 text-start" type="button" *ngIf="invoiceDetails?.status?.label == 'Draft'"
                (click)="saveAsDraft()">Save as Draft</button>
            </div>
            <div *ngIf="invoiceId =='null'">
              <button class="more-actions__item w-100 text-start" type="button" (click)="saveAsDraft()">Save as Draft</button>
            </div>
          </div>
        </button>
      
    </div>
  </form>
  
  
  <app-add-item [itemPopDetail]="showAddItemPopup" (closeModal)="closeItemPopup()" [units]="staticOptions?.itemUnits"
    (itemAdded)="addDropDownMaterial($event)"></app-add-item>
  <app-edit-trip-new-pop-up (dataFromEdit)="editCompleteTripFreight($event)" [showEditPopup]="showFreightPopup" [isAddExpense]="isAddExpense"
    *ngIf="showFreightPopup.show"></app-edit-trip-new-pop-up>
  <app-add-disclaimer [disclaimerPopDetail]="showAddDisclaimerPopup" (closeModal)="closeDisclaimerPopup()"
    (disclaimerAdded)="setDisclaimer($event)"></app-add-disclaimer>
  <app-add-party-popup [popDetail]="showAddPartyPopup" (closeModal)="closePartyPopup()"
    (partyAdded)="addPartyToOption($event)"></app-add-party-popup>
  <app-charges-popup (dataFromEdit)="editCompleteTripCharges($event)" [showChargesPopup]="showChargesPopup" [isAddExpense]="isAddExpense"
    *ngIf="showChargesPopup.show"></app-charges-popup>
  <app-advances-popup *ngIf="showAdvancePopup.show" (dataFromAdvancePopUp)="dataFromAdavnces($event)"
    [advancesData]="showAdvancePopup"></app-advances-popup>
  
  
    <app-go-through  [goThroughDetais]="goThroughDetais"></app-go-through>
  