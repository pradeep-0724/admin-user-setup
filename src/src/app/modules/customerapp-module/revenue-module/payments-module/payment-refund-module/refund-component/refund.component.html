<form [formGroup]="addRefundVoucher" class="add-screen-wrap">
    <div class="right-section__header">
        <h1 *ngIf="refund_id" class="heading">Edit Refund Voucher</h1>
        <h1 *ngIf="!refund_id" class="heading">Add Refund Voucher</h1>
        <button class="gb-video-play float-right"  (click)="openGothrough()">
            <i class="bi bi-play-circle-fill"></i>
        </button>
  
    </div>

    <div class="form-layout shadow-inset-top-lg form-layout--pd">
        <div class="form-layout__card active">
            <div class="alert-msg" *ngIf="apiError">
                <span class="icon-wrap"></span>
                <p class="message-cont">{{ apiError }}</p>
            </div><br>
            <div class="form-body">
                <div class="row tabIndexActiveFields">

                    <div *ngIf="refund_id" class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap disabled">
                            <label for="" class="input--required">Customer </label>
                            <div class="input--bd">{{ initialValues.party.label }}</div>
                              <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
                        </div>
                    </div>

                    <div *ngIf="!refund_id" class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap error" [ngClass]="addErrorClass(addRefundVoucher.controls.party)">
                            <label for="" class="input--required">Customer </label>
                            <material-dropdown [searchable]="true" [addable]="true"
                                               class="dropDownWidth"
                                               [selectedOption]="initialValues.party"
                                               [party]="true" (addPartyPopup)="openAddPartyModal($event)"
                                               (addValueToList)="addValueToPartyPopup($event)"
                                               [params]="partyNamePopup"
                                               [maxLength]="255">
                                  <select #customSelect formControlName="party" class="no-style select--modify"
                                    (change)="onPartySelected($event.target.value)">
                                      <option *ngFor="let party of partyList" value="{{ party.id }}">
                                              {{ party.party_display_name }}
                                      </option>
                                  </select>
                            </material-dropdown>
                            <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
                            <span class="border-anim"></span>
                            <app-error [controlName]="addRefundVoucher.get('party')"></app-error>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap error" [ngClass]="addErrorClass(addRefundVoucher.controls.refund_against)" [class.disabled]="refund_id">
                              <label for="" class="input--required">Refund Against</label>
                              <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" [selectedOption]="initialValues.creditnote" [disabled]="refund_id">
                                    <select #customSelect name="" class="custom no-style input--bd disabled-input" formControlName="refund_against" (change)="oncreditNoteSelected($event.target.value)">
                                            <option *ngFor="let credit of creditNoteList" value="{{ credit.id }}">{{ credit.credit_note_number }}</option>
                                    </select>
                              </material-dropdown>
                              <span class="border-anim"></span>
                              <app-error [controlName]="addRefundVoucher.controls.refund_against"></app-error>
                          </div>
                    </div>

                    
                    <div *ngIf="refund_id" class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap disabled">
                            <label for="" class="input--required">Refund Number</label>
                            <div class="input--bd">{{ addRefundVoucher.controls.refund_number.value }}</div>
                        </div>
                    </div>

                    <div *ngIf="!refund_id" class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap error" [ngClass]="addErrorClass(addRefundVoucher.controls.refund_number)">
                            <label for="" class="input--required">Refund Number</label>
                            <input type="text" class="no-style input--bd" placeholder="Enter Number"
                                value="" formControlName="refund_number">
                            <span class="border-anim"></span>
                            <app-error [controlName]="addRefundVoucher.get('refund_number')"></app-error>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap error" [ngClass]="addErrorClass(addRefundVoucher.controls.date)">
                            <label for="" class="input--required">Date</label>
                            <mat-form-field>
                                <input matInput [matDatepicker]="date" (focus)="date.open()" formControlName="date" placeholder="DD/MM/YYYY">
                                <mat-datepicker-toggle matSuffix [for]="date"></mat-datepicker-toggle>
                                <mat-datepicker #date></mat-datepicker>
                            </mat-form-field>
                            <app-error [controlName]="addRefundVoucher.controls.date"></app-error>
                        </div>
                    </div>


                    

                    
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                            <div class="input-wrap">
                                <label for="" class="">Total Balance ({{ currency_type?.symbol}})</label>
                                <input type="text" class="no-style disabled-input input--bd"
                                    value="" formControlName="credit_balance">
                                <span class="border-anim"></span>
                            </div>
                        </div>
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap error" [ngClass]="addErrorClass(addRefundVoucher.controls.refund_amount)">
                            <label for="" class="input--required">Refund Amount ({{ currency_type?.symbol}})</label>
                            <input positiveThreeDigitDecimalNumber type="text" class="no-style input--bd" placeholder="2000"
                                value="" formControlName="refund_amount">
                            <span class="border-anim"></span>
                            <!-- <app-error [controlName]="addRefundVoucher.controls.refund_amount"></app-error> -->
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap error" [ngClass]="addErrorClass(addRefundVoucher.controls.payment_mode)">
                            <label for="" class="input--required">Payment Mode</label>
                            <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" [selectedOption]="initialValues.paymentMode">
                                <select #customSelect formControlName="payment_mode" class="no-style select--modify" (change)="onPaymentModeSelected()">
                                    <option *ngFor="let option of accountsList" value="{{option.id}}">
                                        {{ option.name }}
                                    </option>
                                </select>
                            </material-dropdown>
                            <app-error [controlName]="addRefundVoucher.controls.payment_mode"></app-error>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="input-wrap" [ngClass]="{disabled: !bankingChargesApply}">
                            <label for="">Banking Charges ({{ currency_type?.symbol}})</label>
                            <input type="text" class="no-style input--bd" placeholder="2000"
                                value="" formControlName="bank_charge" [attr.disabled]="!bankingChargesApply ? '' : null">
                            <span class="border-anim"></span>
                            <span class="error-message">Error messge!</span>
                        </div>
                    </div>
                </div>
                <div class="form-layout__card notes ">
                    <div class="row tabIndexActiveFields">
                        <div class="col-sm-6">
                            <div class="input-wrap">
                                <label for="" class="">Description of Supply</label>
                                <input type="text" class="no-style input--bd"
                                    placeholder="Max 250 Characters" value="" formControlName="description_of_supply">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="input-wrap">
                                <label for="" class="">Remarks</label>
                                <input type="text" class="no-style input--bd"
                                    placeholder="Max 250 Characters" value="" formControlName="remarks">
                            </div>
                        </div>
                    </div>
                </div>

 <div class="form-layout__card mg-top-30 tabIndexActive">
    <file-uploader (onFileUploaded)="fileUploader($event)"
    (onFileDeleted)="fileDeleted($event)" [multiple]="true"
    [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'"
    [showFileName]="false" [patchFileUrls]="patchFileUrls">
    </file-uploader>
 </div>
            </div>
        </div>
    </div>
   
  </form>
 <div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">
       
            <button class="btn btn--sm me-2" type="button" [routerLink]="[prefixUrl+'/income/payments/list/refund']">Cancel</button>
            <button class="btn btn--primary btn--sm" type="button" (click)="submitAddRefundForm()">{{refund_id?'Update':'Save'}}</button>
        
    </div>
    <!-- Popup for adding party details -->
    <app-add-party-popup [popDetail]="showAddPartyPopup" (closeModal)="closePartyPopup()"
    (partyAdded)="addPartyToOption($event)"></app-add-party-popup>
    <app-go-through  [goThroughDetais]="goThroughDetais"></app-go-through>