<form [formGroup]="editInvoicePaymentForm" *ngIf="editInvoicePaymentForm">
    <div class="right-section__header">
    <h1 class="heading" *ngIf="invoiceId">Edit Payment Received</h1>
    <h1 class="heading" *ngIf="!invoiceId">Add Payment Received</h1>
    <button class="gb-video-play float-right"  (click)="openGothrough()">
        <i class="bi bi-play-circle-fill"></i>
    </button>

    </div>
    <div class="alert-msg" #alertMsg *ngIf="apiError">
        <span class="icon-wrap"></span>
        <p class="message-cont">{{ apiError }}</p>
    </div>
    <div class="error-msg-list" *ngIf="globalFormErrorList.length > 0">
        <p class="message-head">{{ errorHeaderMessage }}</p>
        <span class="icon-wrap"></span>
        <ul *ngFor="let error of globalFormErrorList">
          <li class="message-cont">{{ error }}</li>
        </ul>
      </div>
    <div class="form-layout shadow-inset-top-lg form-layout--pd">
    <div class="form-layout__card active">
        <div class="form-body">

            <div class="row tabIndexActiveFields">
                <div *ngIf="invoiceId" class="col-lg-3 col-sm-6">
                    <div class="input-wrap disabled">
                        <label for="" class="input--required">Customer  <span *ngIf="isTdsDecleration" class="blueTag">TDS Declaration Received</span></label>
                        <div class="input--bd">{{ initialValues.party.label }}</div>
                        <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
                    </div>
                </div>

                <div *ngIf="!invoiceId" class="col-lg-3 col-sm-6">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.party)">
                        <label for="" class="input--required position-relative">Customer  <span *ngIf="isTdsDecleration" class="blueTag">TDS Declaration Received</span> </label>
                        <material-dropdown [searchable]="true" [addable]="false"
                          class="dropDownWidth"
                          [selectedOption]="initialValues.party"
                          [party]="true" (addPartyPopup)="openAddPartyModal($event)"
                          (addValueToList)="addValueToPartyPopup($event)"
                          [params]="partyNamePopup">
                                <select #customSelect formControlName="party" class="no-style select--modify"
                                       (change)="onPartySelected($event)" (change)="stopLoaderClasstoBody()">
                                    <option *ngFor="let party of partyList" value="{{ party.id }}">
                                        {{ party.party_display_name }}
                                    </option>
                                </select>
                        </material-dropdown>
                        <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
                        <app-error [controlName]="editInvoicePaymentForm.controls.party"></app-error>
                        <!-- <span class="error-message">Error messge!</span> -->
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.date_of_payment)">
                        <label for="" class="input--required">Date of Payment</label>
                        <mat-form-field>
                            <input matInput [matDatepicker]="date_of_payment" (focus)="date_of_payment.open()" formControlName="date_of_payment" placeholder="DD/MM/YYYY">
                            <mat-datepicker-toggle matSuffix [for]="date_of_payment"></mat-datepicker-toggle>
                            <mat-datepicker #date_of_payment></mat-datepicker>
                        </mat-form-field>
                        <app-error [controlName]="editInvoicePaymentForm.controls.date_of_payment"></app-error>
                    </div>
                </div>

                <div *ngIf="!invoiceId" class="col-lg-3 col-sm-6">
                    <div class="input-wrap">
                        <label for="" class="input--required">Payment Number</label>
                        <input type="text" class="no-style input--bd"  placeholder="Placeholder"
                            value="" formControlName="payment_number">

                        <span class="error-message">Error messge!</span>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6">
                    <div class="input-wrap">
                        <label for="" class="">Reference Number</label>
                        <input type="text" class="no-style input--bd" placeholder="2000"
                            value="" formControlName="reference_number">
    
                        <span class="error-message">Error messge!</span>
                    </div>
                </div>

                <div *ngIf="invoiceId" class="col-lg-3 col-sm-6">
                    <div class="input-wrap disabled">
                        <label for="" class="input--required">Payment Number</label>
                        <div class="input--bd">{{ editInvoicePaymentForm.controls.payment_number.value }}</div>
                    </div>
                </div>
                <div>
                    <app-revenue-payment-box (revenueHeader)="revenueHeader($event)" [ngClass]="{'hiddenContent':!isTax||isTds}" [editData]="editData"></app-revenue-payment-box>
                  </div>
            </div>

            <div class="form-layout__card mg-top-30 tabIndexActive" *ngIf="creditNoteList.length > 0">
                <div class="form-layout__header">
                    <h2 class="sub-heading">Utilise Credits</h2>
                    <span class="collapse-line"></span>
                </div>
                <div class="mg-top-30">
                    <div class="table-header px-0 pt-0">
                      <div class="row">
                          <div class="col-md-4 col-9">
                              <div class="table-header__left">
                                  <div  id="demo-2">
                                      <input type="search" class=" no-style"
                                          placeholder="Credit Number" [(ngModel)]="searchCredit" [ngModelOptions]="{standalone: true}">

                                  </div>
                              </div>
                          </div>
                         <!--  <div class="col-md-8 col-3">
                              <div class=" text-end">
                                  <button class="btn--action">
                                      <img src="../assets/img/filter-icon.svg" alt="">
                                  </button>
                              </div>
                          </div> -->
                      </div>
                    </div>
                    <div
                        class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg">
                        <table class="table-container">
                            <thead>
                                <tr>
                                    <th width=6% class="table-checkbox">
                                        <label for="all-cn" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" id="all-cn" formControlName="all_credit_note_selected" (change)="onSelectAllCreditNotes($event)">
                                            <span class="check-mark"></span>
                                        </label>
                                    </th>
                                    <th width=16%>Date Of Credit</th>
                                    <th width=16%>Credit Number</th>
                                    <th width=20%>Original Amount ({{ currency_type?.symbol}})</th>
                                    <th width=20%>Reamining Balance ({{ currency_type?.symbol}})</th>
                                    <th width=15%>Availing  ({{ currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="utilise_credit">
                                <tr *ngFor="let creditNote of creditNoteList | invoicecreditListFilter: searchCredit; let i = index;" [formGroupName]="i">
                                    <td class="table-checkbox">
                                        <label for="cn-{{ i }}" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" #cnCheckbox id="cn-{{ i }}" formControlName="selected" value="{{ creditNote.id }}" [checked] ="creditNote?.selected" (change)="onCreditNotesSelected($event , i)">
                                            <span class="check-mark"></span>
                                        </label>
                                    </td>
                                    <td>{{dateChange(creditNote.credit_note_date)}}</td>
                                    <td>{{creditNote.credit_note_number}}</td>
                                    <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{creditNote.total_amount | numberFormat}}</td>
                                    <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{creditNote.balance | numberFormat}}</td>
                                    <td>
                                        <div class="input-wrap tabIndexActive" [ngClass]="addErrorClass(editInvoicePaymentForm.controls['utilise_credit'].controls[i].controls.availing_amount)">
                                            <input positiveThreeDigitDecimalNumber class="error-box" type="text" placeholder="1000" formControlName="availing_amount"
                                            (change)="onChangeCreditAvail(i, creditNote)">
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="creditNoteList.length === 0">
                                    <td colspan="7" align="center">Credit notes not available.</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Utilised_Credit_Summation.availing| numberFormat}}</td>
                                </tr>
                            </tbody>
                          
                        </table>
                    </div>
                </div>
            </div>
            <div class="form-layout__card mg-top-30 tabIndexActive" *ngIf="advanceList.length > 0">
                <div class="form-layout__header">
                    <h2 class="sub-heading">Customer Advance</h2>
                    <span class="collapse-line"></span>
                </div>
                <div class="mg-top-30">
                    <div class="table-header px-0 pt-0">
                      <div class="row">
                          <div class="col-md-4 col-9">
                              <div class="table-header__left">
                                  <div  id="demo-2">
                                      <input type="search" class=" no-style"
                                          placeholder="Advance Number" [(ngModel)]="searchAdvance" [ngModelOptions]="{standalone: true}">

                                  </div>
                              </div>
                          </div>
                        <!--   <div class="col-md-8 col-3">
                              <div class=" text-end">
                                  <button class="btn--action">
                                      <img src="../assets/img/filter-icon.svg" alt="">
                                  </button>
                              </div>
                          </div> -->
                      </div>
                    </div>
                    <div
                        class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg">
                        <table class="table-container">
                            <thead>
                                <tr>
                                    <th width=6% class="table-checkbox">
                                        <label for="all-ca" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" id="all-ca" formControlName="all_advance_selected" (change)="onSelectAllAdvances($event)">
                                            <span class="check-mark"></span>
                                        </label>
                                    </th>
                                    <th width=16%>Date Of Advance</th>
                                    <th width=16%>Advance Number</th>
                                    <th width=20%>Original Amount ({{ currency_type?.symbol}})</th>
                                    <th width=20%>Remaining Balance ({{ currency_type?.symbol}})</th>
                                    <th width=15%>Availing  ({{ currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="advance_received">
                                <tr *ngFor="let advance of advanceList | advancePaymentListFilter: searchAdvance; let i = index;" [formGroupName]="i">
                                    <td class="table-checkbox">
                                        <label for="ca-{{ i }}" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" #caCheckbox id="ca-{{ i }}" formControlName="selected" value="{{ advance.id }}" [checked] ="advance?.selected" (change)="onAdvanceSelected($event , i)">
                                            <span class="check-mark"></span>
                                        </label>
                                    </td>
                                    <td>{{dateChange(advance.received_date)}}</td>
                                    <td>{{advance.advance_number}}</td>
                                    <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{advance.amount| numberFormat}}</td>
                                    <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{advance.balance| numberFormat}}</td>
                                    <td>
                                        <div class="input-wrap tabIndexActive" [ngClass]="addErrorClass(editInvoicePaymentForm.controls['advance_received'].controls[i].controls.availing_amount)">
                                            <input positiveThreeDigitDecimalNumber type="text" class="error-box" placeholder="1000" formControlName="availing_amount"
                                            (change)="onChangeAvailingAmount(i, advance)">
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="advanceList.length === 0">
                                    <td colspan="7" align="center">Customer Advance not available.</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Customer_Advance_Summation.availing| numberFormat}}</td>
                                </tr>
                            </tbody>
                           
                        </table>
                    </div>
                </div>
            </div>
            <div class="form-layout__card mg-top-30 tabIndexActive" *ngIf="debitNoteList.length > 0">
                    <div class="form-layout__header">
                        <h2 class="sub-heading">Outstanding Debit</h2>
                        <span class="collapse-line"></span>
                    </div>
                    <div class="mg-top-30">
                        <div class="table-header px-0 pt-0">
                            <div class="row">
                                <div class="col-md-4 col-9">
                                    <div class="table-header__left">
                                        <div  id="demo-2">
                                            <input type="search" class=" no-style"
                                                placeholder="Search"  [(ngModel)]="searchDebit" [ngModelOptions]="{standalone: true}">

                                        </div>
                                    </div>
                                </div>
                               <!--  <div class="col-md-8 col-3">
                                    <div class=" text-end">
                                        <button class="btn--action">
                                            <img src="../assets/img/filter-icon.svg" alt="">
                                        </button>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                        <div
                            class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd tcol-10 table--nobg">
                            <table class="table-container" *ngIf="debitNoteList.length > 0">
                                <thead>
                                    <tr>
                                        <th class="table-checkbox">
                                            <label for="all-debit" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" id="all-debit" formControlName="all_debit_selected" (change)="onSelectAllDebitNotes($event)">
                                                <span class="check-mark"></span>
                                            </label>
                                        </th>
                                        <th>Date of Debit</th>
                                        <th>Debit Number</th>
                                        <th>Due Date</th>
                                        <th>Debit Amount ({{ currency_type?.symbol}})</th>
                                        <th>Amount Due</th>
                                        <th>Discount ({{ currency_type?.symbol}})</th>
                                        <th [ngClass]="{'hiddenContent':!isTax||isTds}">Withheld  ({{ currency_type?.symbol}})</th>
                                        <th>Amount Received ({{ currency_type?.symbol}})</th>
                                        <th>Balance ({{ currency_type?.symbol}})</th>
                                    </tr>
                                </thead>
                                <tbody formArrayName="outstanding_debit">
                                    <tr *ngFor="let debit of debitNoteList | addDebitListFilter: searchDebit; let i = index;" [formGroupName]="i">
                                        <td class="table-checkbox">
                                            <label for="de-{{ i }}" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" id="de-{{ i }}" formControlName="selected" value="{{ debit.id }}" [checked] ="debit?.selected"  (change)="onDebitNotesSelected($event, i)">
                                                <span class="check-mark"></span>
                                            </label>
                                        </td>
                                        <td>{{debit.debit_note_date}}</td>
                                        <td>{{debit.debit_note_number}}</td>
                                        <td>{{debit.due_date}}</td>
                                        <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{debit.total_amount| numberFormat}}</td>
                                        <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{ editInvoicePaymentForm.controls['outstanding_debit'].controls[i].controls.balance.value | numberFormat}}</td>
                                        <td>
                                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="adjustment"
                                            (change)="roundOffAmount(editInvoicePaymentForm.controls.outstanding_debit.controls[i].controls.adjustment);
                                            onChangeDebitAdjustment(i, debit)">
                                        </td>
                                        <td [ngClass]="{'hiddenContent':!isTax||isTds}">
                                          <div class="input-wrap tabIndexActive" [ngClass]="{disabled: deductAmountDisabled}">
                                              <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="withheld"
                                              (change)="onChangeDebitWtihheld(i, debit)">
                                          </div>
                                      </td>
                                        <td>
                                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="amount_received"
                                            (change)="onChangeDebitAmountReceived(i, debit)">
                                        </td>
                                        <td>
                                            <div class="input-wrap disabled" [ngClass]="addErrorClass(editInvoicePaymentForm.controls['outstanding_debit'].controls[i].controls.total_balance)">
                                                <input positiveThreeDigitDecimalNumber type="text" class="error-box" placeholder="1000" formControlName="total_balance" [attr.disabled]="true">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr *ngIf="debitNoteList.length === 0">
                                            <td colspan="10" align="center">Debit Notes are not available.</td>
                                        </tr>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                                            <td  class="rupee-symbol rupee-symbol--sm fw-semibold fs-6"> {{ currency_type?.symbol}} {{total_Outstanding_Debit_Summation.adjustment| numberFormat}}</td>
                                            <td [ngClass]="{'hiddenContent':!isTax||isTds}"></td>
                                            <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Outstanding_Debit_Summation.amount_received| numberFormat}}</td>
                                            <td></td>
                                        </tr>
                                </tbody>
                               
                            </table>
                        </div>
                    </div>
                </div>
            <div class="form-layout__card mg-top-30 tabIndexActive" *ngIf="invoiceList.length > 0">
            <div class="form-layout__card mg-top-30">
                <div class="form-layout__header">
                    <h2 class="sub-heading">Outstanding Invoices</h2>
                    <span class="collapse-line"></span>
                </div>
                <div class="mg-top-30">
                    <div class="table-header px-0 pt-0">
                        <div class="row">
                            <div class="col-md-4 col-9">
                                <div class="table-header__left">
                                    <div  id="demo-2">
                                        <input type="search" class=" no-style"
                                            placeholder="Search"  [(ngModel)]="searchInvoice" [ngModelOptions]="{standalone: true}">

                                    </div>
                                </div>
                            </div>
                           <!--  <div class="col-md-8 col-3">
                                <div class=" text-end">
                                    <button class="btn--action">
                                        <img src="../assets/img/filter-icon.svg" alt="">
                                    </button>
                                </div>
                            </div> -->
                        </div>
                    </div>
                    <div
                        class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd tcol-10 table--nobg">
                        <table class="table-container" *ngIf="invoiceList.length > 0">
                            <thead>
                                <tr>
                                    <th class="table-checkbox">
                                        <label for="all-invoices" class="check-box">
                                             <input type="checkbox"  tabindex="-1" id="all-invoices" formControlName="all_invoice_selected" (change)="onSelectAllInvoices($event)">
                                            <span class="check-mark"></span>
                                        </label>
                                    </th>
                                    <th>Date of Invoice</th>
                                    <th>Invoice Number</th>
                                    <th>Due Date</th>
                                    <th>Invoice Amount ({{ currency_type?.symbol}})</th>
                                    <th>Amount Due ({{ currency_type?.symbol}})</th>
                                    <th>Discount ({{ currency_type?.symbol}})</th>
                                    <th [ngClass]="{'hiddenContent':!isTax||isTds}">Withheld  ({{ currency_type?.symbol}})</th>
                                    <th>Amount Received ({{ currency_type?.symbol}})</th>
                                    <th>Balance ({{ currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="outstanding_invoice">
                                <tr *ngFor="let invoice of invoiceList | addInvoiceListFilter: searchInvoice; let i = index;" [formGroupName]="i">
                                    <td class="table-checkbox">
                                        <label for="in-{{ i }}" class="check-box">
                                                 <input type="checkbox"  tabindex="-1" id="in-{{ i }}" formControlName="selected" value="{{ invoice.id }}" [checked] ="invoice?.selected" (change)="onInvoiceSelected($event, i)">
                                            <span class="check-mark"></span>
                                        </label>
                                    </td>
                                    <td>{{invoice.invoice_date ? dateChange(invoice.invoice_date) : '-'}}</td>
                                    <td>{{invoice.invoice_number}}</td>
                                    <td>{{dateChange(invoice.due_date)}}</td>
                                    <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{invoice.total_amount| numberFormat}}</td>
                                    <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{ editInvoicePaymentForm.controls['outstanding_invoice'].controls[i].controls.balance.value| numberFormat }}</td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="adjustment"
                                        (change)="onChangeInvoiceAdjustment(i, invoice)">
                                    </td>
                                    <td [ngClass]="{'hiddenContent':!isTax||isTds}">
                                      <div class="input-wrap tabIndexActive" [ngClass]="{disabled: deductAmountDisabled}">
                                          <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="withheld"
                                          (change)="onChangeInvoiceWithheld(i, invoice)">
                                      </div>
                                  </td>

                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="amount_received"
                                        (change)="onChangeInvoiceAmountReceived(i, invoice)">
                                    </td>
                                    <td>
                                        <div class="input-wrap disabled tabIndexActive" [ngClass]="addErrorClass(editInvoicePaymentForm.controls['outstanding_invoice'].controls[i].controls.total_balance)">
                                            <input positiveThreeDigitDecimalNumber class="error-box" type="text" placeholder="1000" formControlName="total_balance" [attr.disabled]="true">
                                        </div>
                                    </td>
                                </tr>
                                <tr *ngIf="invoiceList.length === 0">
                                        <td colspan="10" align="center">Invoices not available.</td>
                                    </tr>
                                    <tr>
                                        <td class="ps-4 fs-6 fw-semibold">{{total_Outstanding_Invoices_Summation.selected}}</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td  class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                                        <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Outstanding_Invoices_Summation.adjustment| numberFormat}}</td>
                                        <td [ngClass]="{'hiddenContent':!isTax||isTds}"></td>
                                        <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Outstanding_Invoices_Summation.amount_received| numberFormat}}</td>
                                        <td></td>
                                    </tr>
                            </tbody>
                            
                        </table>
                    </div>
                </div>
            </div>
            </div>


            <div class="form-layout__card mg-top-30 tabIndexActiveFields" *ngIf="bosList.length > 0">
              <div class="form-layout__card mg-top-30">
                  <div class="form-layout__header">
                      <h2 class="sub-heading">Outstanding BOS</h2>
                      <span class="collapse-line"></span>
                  </div>
                  <div class="mg-top-30">
                      <div class="table-header px-0 pt-0">
                          <div class="row">
                              <div class="col-md-4 col-9">
                                  <div class="table-header__left">
                                      <div  id="demo-2">
                                          <input type="search" class=" no-style"
                                              placeholder="Search"  [(ngModel)]="searchBos" [ngModelOptions]="{standalone: true}">

                                      </div>
                                  </div>
                              </div>
                              <div class="col-md-8 col-3">
                                  <div class=" text-end">
                                      <!-- <button class="btn--action">
                                          <img src="../assets/img/filter-icon.svg" alt="">
                                      </button> -->
                                  </div>
                              </div>
                          </div>
                      </div>
                      <div
                          class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd tcol-10 table--nobg">
                          <table class="table-container" *ngIf="bosList.length > 0">
                              <thead>
                                  <tr>
                                      <th class="table-checkbox">
                                          <label for="all-bos" class="check-box">
                                               <input type="checkbox"  tabindex="-1" id="all-bos" formControlName="all_bos_selected" (change)="onSelectAllBos($event)">
                                              <span class="check-mark"></span>
                                          </label>
                                      </th>
                                      <th>Date of Bos</th>
                                      <th>Bos Number</th>
                                      <th>Due Date</th>
                                      <th>Bos Amount ({{ currency_type?.symbol}})</th>
                                      <th>Amount Due ({{ currency_type?.symbol}})</th>
                                      <th>Discount ({{ currency_type?.symbol}})</th>
                                      <th [ngClass]="{'hiddenContent':!isTax||isTds}">Withheld  ({{ currency_type?.symbol}})</th>
                                      <th>Amount Received ({{ currency_type?.symbol}})</th>
                                      <th>Balance ({{ currency_type?.symbol}})</th>
                                  </tr>
                              </thead>
                              <tbody formArrayName="outstanding_bos">
                                  <tr *ngFor="let bos of bosList | bosSearchListFilter: searchBos; let i = index;" [formGroupName]="i">
                                      <td class="table-checkbox">
                                          <label for="bos-{{ i }}" class="check-box">
                                                   <input type="checkbox"  tabindex="-1" id="bos-{{ i }}" formControlName="selected" value="{{ bos.id }}" [checked] ="bos?.selected" (change)="onBosSelected($event, i)">
                                              <span class="check-mark"></span>
                                          </label>
                                      </td>
                                      <td>{{bos.bos_date ? dateChange(bos.bos_date) : '-'}}</td>
                                      <td>{{bos.bos_number}}</td>
                                      <td>{{dateChange(bos.due_date)}}</td>
                                      <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{bos.total_amount| numberFormat}}</td>
                                      <td class="rupee-symbol rupee-symbol--sm">{{ currency_type?.symbol}} {{ editInvoicePaymentForm.controls['outstanding_bos'].controls[i].controls.balance.value| numberFormat }}</td>
                                      <td>
                                          <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="adjustment"
                                          (change)="onChangeBosAdjustment(i, bos)">
                                      </td>
                                      <td [ngClass]="{'hiddenContent':!isTax||isTds}">
                                        <div class="input-wrap" [ngClass]="{disabled: deductAmountDisabled}">
                                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="withheld"
                                            (change)="onChangeBosWithheld(i, bos)">
                                        </div>
                                    </td>

                                      <td>
                                          <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" formControlName="amount_received"
                                          (change)="onChangeBosAmountReceived(i, bos)">
                                      </td>
                                      <td>
                                          <div class="input-wrap disabled" [ngClass]="addErrorClass(editInvoicePaymentForm.controls['outstanding_bos'].controls[i].controls.total_balance)">
                                              <input positiveThreeDigitDecimalNumber class="error-box" type="text" placeholder="1000" formControlName="total_balance" [attr.disabled]="true">
                                          </div>
                                      </td>
                                  </tr>
                                  <tr *ngIf="bosList.length === 0">
                                          <td colspan="10" align="center">BOS not available.</td>
                                      </tr>

                                      <tr>
                                        <td class="ps-4 fs-6 fw-semibold">{{total_Outstanding_Bos_Summation.selected}}</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                                        <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Outstanding_Bos_Summation.adjustment| numberFormat}}</td>
                                        <td [ngClass]="{'hiddenContent':!isTax||isTds}"></td>
                                        <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Outstanding_Bos_Summation.amount_received| numberFormat}}</td>
                                        <td></td>
                                    </tr>
                              </tbody>
                             
                          </table>
                      </div>
                  </div>
              </div>
              </div>
              <!--  -->
              <div class="row tabIndexActive mt-4">
                <div class="col-lg-3 col-sm-6" [ngClass]="{'disabled': isPaymentDisabled}">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.payment_choice)">
                        <label for="" class="input--required">Payment Mode</label>
                        <material-dropdown [searchable]="true" [disabled]="isPaymentDisabled"  [selectedOption]="initialValues.paymentChoice"[addable]="false" class="dropDownWidth">
                                <select #customSelect formControlName="payment_choice" class="no-style select--modify" (change)="paymentModeChange()">
                                    <option *ngFor="let account of paymentModeList" value="{{ account.id }}">
                                        {{ account.label }}
                                    </option>
                                </select>
                        </material-dropdown>
                        <app-error [controlName]="editInvoicePaymentForm.controls.payment_choice"></app-error>
                    </div>
                  </div>
                <div class="col-lg-3 col-sm-6" *ngIf="isChequeRequired" [ngClass]="{'disabled': ischequeStatusDisabled}">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.cheque_status)">
                        <label for=""  class="input--required">Cheque Status</label>
                        <material-dropdown [searchable]="true" [disabled]="ischequeStatusDisabled"  [selectedOption]="initialValues.paymentChequeStatus" [addable]="false" class="dropDownWidth">
                                <select #customSelect  formControlName="cheque_status" class="no-style select--modify" (change)="chequeStatus()" >
                                    <option *ngFor="let account of chequeStatusList" value="{{ account.id }}">
                                        {{ account.label }}
                                    </option>
                                </select>
                        </material-dropdown>
                        <app-error [controlName]="editInvoicePaymentForm.controls.cheque_status"></app-error>
                    </div>
                  </div>
                  <div class="col-lg-3 col-sm-6" *ngIf="isChequeRequired"  [ngClass]="{'disabled': isAlreadyCancelled || isAlreadyCleared }">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.cheque_no)">
                        <label for=""  class="input--required">Cheque No.</label>
                        <input type="text" [disabled]="isAlreadyCancelled || isAlreadyCleared" class="no-style input--bd" placeholder="2000" value=""
                        [readonly]="isAlreadyCancelled || isAlreadyCleared"
                            formControlName="cheque_no">
                        <app-error [controlName]="editInvoicePaymentForm.controls.cheque_no"></app-error>
                        
                    </div>
                  </div>
                  <div class="col-lg-3 col-sm-6" *ngIf="isChequeRequired"  [ngClass]="{'disabled': isAlreadyCancelled || isAlreadyCleared}">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.cheque_date)">
                        <label for=""  class="input--required">Cheque Date</label>
                        <mat-form-field>
                            <input matInput [disabled]="isAlreadyCancelled || isAlreadyCleared" [matDatepicker]="cheque_date" (focus)="cheque_date.open()" [readonly]="isAlreadyCancelled || isAlreadyCleared"
                                formControlName="cheque_date" placeholder="DD/MM/YYYY">
                            <mat-datepicker-toggle matSuffix [for]="cheque_date"></mat-datepicker-toggle>
                            <mat-datepicker #cheque_date></mat-datepicker>
                        </mat-form-field>
                        <app-error [controlName]="editInvoicePaymentForm.controls.cheque_date"></app-error>
                    </div>
                  </div>
                  <div class="col-lg-3 col-sm-6" *ngIf="isClearedCheque" [ngClass]="{'disabled': isAlreadyCancelled || isAlreadyCleared}">
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.clearance_date)">
                        <label for=""  class="input--required">Clearance Date</label>
                        <mat-form-field>
                            <input matInput [matDatepicker]="clearance_date" (focus)="clearance_date.open()" [readonly]="isAlreadyCancelled || isAlreadyCleared"
                                formControlName="clearance_date" placeholder="DD/MM/YYYY">
                            <mat-datepicker-toggle matSuffix [for]="clearance_date"></mat-datepicker-toggle>
                            <mat-datepicker #clearance_date></mat-datepicker>
                        </mat-form-field>
                        <app-error [controlName]="editInvoicePaymentForm.controls.clearance_date"></app-error>
                    </div>
                  </div>
            </div>

            <div class="row tabIndexActiveFields">
                <div class="col-lg-3 col-sm-6">
                
                    <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.account)">
                      <label for=""  *ngIf="!isChequeRequired || (isChequeRequired && isClearedCheque)" class="input--required">Account</label>
                      <label for=""  *ngIf="isChequeRequired && !isClearedCheque" >Account</label>
                        <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" [selectedOption]="initialValues.accountNo">
                            <select #customSelect formControlName="account" class="no-style select--modify" (change)="onPaymentModeSelected()">
                                <option *ngFor="let option of accountsList" value="{{ option.id }}">
                                    {{ option.name  }}
                                </option>
                            </select>
                        </material-dropdown>
                        <app-error [controlName]="editInvoicePaymentForm.controls.account"></app-error>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="input-wrap" [ngClass]="{disabled: !paymentModeSelected}">
                     <div class="input-wrap error" [ngClass]="addErrorClass(editInvoicePaymentForm.controls.amount_received)">
                         <label for=""  [ngClass]="{'input--required': isAmountRequired}">Amount Received ({{ currency_type?.symbol}})</label>
                         <input positiveThreeDigitDecimalNumber type="text" class="no-style input--bd"
                             placeholder="2000" value="" formControlName="amount_received"
                             (change)="setPartyAmountRecevied()">

                         <app-error [controlName]="editInvoicePaymentForm.controls.amount_received"></app-error>
                     </div>
                    </div>
                 </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="input-wrap">
                        <div class="input-wrap" [ngClass]="{disabled: !bankingChargeRequired}">
                          <label for="" >Banking Charges ({{ currency_type?.symbol}})</label>
                          <input positiveThreeDigitDecimalNumber type="text" class="no-style input--bd "  placeholder="2000" formControlName="bank_charge" value=""
                          [attr.disabled]="!bankingChargeRequired ? '' : null" (change)="setBankingCharges()">

                          <app-error [controlName]="editInvoicePaymentForm.controls.bank_charge"></app-error>
                        </div>
                    </div>
                </div>
                
            </div>




              <div class="gst-table-wrapper mg-top-30 tabIndexActiveFields">

                <div class="gst-main py-2" [ngClass]="{'hiddenContent':!isTax||isTds}">
                    <div class="text-end fw-bold gst-left" [ngClass]="{'error-text': deductAndWitheldErr}">Deduction Amount: </div>
                    <div class="px-0  text-end fw-bold gst-right" [ngClass]="{'error-text': deductAndWitheldErr}"> {{ currency_type?.symbol}}  {{deductAmount | numberFormat}} </div>
                </div>

                <div class="gst-main py-2" [ngClass]="{'hiddenContent':!isTax||isTds}">
                  <div class="text-end fw-bold gst-left" [ngClass]="{'error-text': deductAndWitheldErr}">Withheld amount:</div>
                  <div class="px-0  text-end fw-bold gst-right" [ngClass]="{'error-text': deductAndWitheldErr}"> {{ currency_type?.symbol}}  {{ totals?.total_amount_withheld| numberFormat }}</div>
                </div>

                <div class="gst-main py-2">
                  <div class="text-end gst-left flex-column d-block"><strong class="py-2 d-block" [ngClass]="{'error-text': breakUpAmountErr}"> Total: </strong>

                    <p class="fw-light fst-italic py-1">Amount Received: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.total_party_received| numberFormat}}</p>
                    <p class="fw-light fst-italic py-1">Advance Availed: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.advance_avail| numberFormat}}</p>
                    <p class="fw-light fst-italic py-1">Credit Utilised: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.credit_avail| numberFormat }}</p>
                    <p class="fw-light fst-italic py-1">Discount: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.total_discount_amount | numberFormat }}</p>
                    <p class="fw-light fst-italic py-1">Banking Charges: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.total_banking_charges | numberFormat }}</p>
                  </div>
                  <div class="px-0  text-end fw-bold gst-right" [ngClass]="{'error-text': breakUpAmountErr}"> {{ currency_type?.symbol}} {{ total | numberFormat}}</div>
                </div>

                <div class="gst-main py-2">
                  <div class="text-end gst-left flex-column d-block"><strong class="py-2 d-block" [ngClass]="{'error-text': breakUpAmountErr}"> Amount Breakup: </strong>
                      <p class="fw-light fst-italic py-1">Invoice: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.invoice_amount_received | numberFormat }}</p>
                      <p class="fw-light fst-italic py-1" *ngIf="!isTds">BoS: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.bos_amount_received | numberFormat }}</p>
                      <p class="fw-light fst-italic py-1">Debit: <span class="px-0  text-end"></span>{{ currency_type?.symbol}} {{ totals?.debit_amount_received | numberFormat }}</p>
                    </div>
                    <div class="px-0  text-end fw-bold gst-right" [ngClass]="{'error-text': breakUpAmountErr}"> {{ currency_type?.symbol}} {{ amountPayable | numberFormat }}</div>
                </div>
                <input type='hidden' formControlName="credit_availed">
                <input type='hidden' formControlName="advance_availed">
                <input type='hidden' formControlName="withheld_amount">


            </div>
            <hr>
            <div class="form-layout__card mg-top-30">
                <div class="row tabIndexActiveFields">
                    <!-- <div class="col-xl-12">
                        <file-uploader (onFileRead)="onPresentFileUpload($event)" (onFileUploaded)="fileUploaderPresentAddress($event,0)"
                            (onFileDeleted)="fileDeletedPresentAddress($event,0)" [multiple]="true" [accept]="'image/*, capture=camera'"
                            [showFileName]="false" [uploaderId]="documents">
                        </file-uploader>
                    </div> -->
                    <div class="col-xl-3 col-lg-3  col-md-3 col-6">
                        <div class="input-wrap clearfix">
                          <label for="" class="">Signature</label>
                          <div>
                            <material-dropdown [selectedOption]="initialValues.digitalSignature">
                              <select #customSelect class="no-style select--modify" formControlName="signature">
                                <option *ngFor="let option of digitalSignature " value="{{option.id}}">{{option.name}}
                                </option>
                              </select>
                            </material-dropdown>
                          </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3  col-md-3 col-6">
                        <div class="input-wrap mb-0 pb-3">
                            <label for="" class="">Optional Comment</label>
                            <input type="text" class="no-style input--bd" placeholder="Comments"
                                value="" formControlName="optional_comments">
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3  col-md-3 col-6">
                        <div class="input-wrap mb-0 pb-3">
                            <label for="" class="">Terms and Conditions</label>
                            <div>
                                <material-dropdown [addBlank]="true" [selectedOption]="initialValues.termsAndCondition">
                                <select #customSelect formControlName="terms_and_condition" class="no-style select--modify">
                                  <option *ngFor="let option of termsAndConditions" value="{{ option.id }}">
                                    {{ option.name }}
                                  </option>
                                </select>
                              </material-dropdown>
                              </div>
                        </div>
                    </div>
                </div>
            </div>

 <div class="form-layout__card mg-top-30 tabIndexActive">
    <file-uploader (onFileUploaded)="fileUploader($event)"
    (onFileDeleted)="fileDeleted($event)" [multiple]="true"
    [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'"
    [showFileName]="false" [patchFileUrls]="patchFileUrls">
    </file-uploader>
 </div>
        </div>
    </div>
    </div>
    
</form>
<div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">
   
        <button class="btn btn--sm me-2" type="button" [routerLink]="[prefixUrl+'/income/payments/list/invoice']">Cancel</button>
        <!-- <button class="btn btn--primary btn--default" type="button" (click)="submitInvoicePayment()">Proceed Payment Received</button> -->
        <button class="btn mx-0 px-2 max-width-220 btn--primary btn--default btn-mg-left btn--dropdown"
        (click)="saveButton = !saveButton">{{!invoiceId?'Save':'Update'}} Payment Received<i class="material-icons">arrow_drop_down</i>


        <div class="more-actions__menu w-100" [ngClass]="{'show': saveButton}" id="custom-dropdown-top">
            <button class="more-actions__item w-100 text-start" type="button" (click)="submitInvoicePayment(false)">Save Payment Received</button>
            <button class="more-actions__item w-100 text-start" *ngIf="paymentData?.status?.label == 'Draft'" type="button" (click)="submitInvoicePayment(true)">Save as Draft</button>
            <button class="more-actions__item w-100 text-start" *ngIf="!invoiceId" type="button" (click)="submitInvoicePayment(true)">Save as Draft</button>

        </div>
    </button>
   
    </div>
    <!-- Popup for adding party details -->
    <app-add-party-popup [popDetail]="showAddPartyPopup" (closeModal)="closePartyPopup()"
    (partyAdded)="addPartyToOption($event)"></app-add-party-popup>


    <app-go-through  [goThroughDetais]="goThroughDetais"></app-go-through>