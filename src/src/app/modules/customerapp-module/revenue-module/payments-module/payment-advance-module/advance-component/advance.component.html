<form [formGroup]="addAdvanceForm" class="add-screen-wrap">
  <div class="right-section__header">
    <h1 *ngIf="advanceId" class="heading">Edit Customer Advance</h1>
    <h1 *ngIf="!advanceId" class="heading">Add Customer Advance</h1>
    <button class="gb-video-play float-right"  (click)="openGothrough()">
      <i class="bi bi-play-circle-fill"></i>
  </button>
  </div>
  <div class="alert-msg" *ngIf="apiError">
    <span class="icon-wrap"></span>
    <p class="message-cont">{{ apiError }}</p>
  </div>
  <div class="form-layout shadow-inset-top-lg form-layout--pd">
    <div class="form-layout__card active">
      <div class="form-body">
        <div class="row">
          <div class="col-12">
            <div class="row tabIndexActiveFields">

              <div *ngIf="advanceId" class="col-lg-3 col-sm-6">
                <div class="input-wrap disabled">
                  <label for="" class="input--required">Customer </label>
                  <div class="input--bd">{{ initialValues.party.label }}</div>
                  <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
                </div>
              </div>

              <div *ngIf="!advanceId" class="col-lg-3 col-sm-6">
                <div class="input-wrap select-custom error" [ngClass]="addErrorClass(addAdvanceForm.controls.party)">
                  <label for="" class="input--required">Customer </label>
                  <material-dropdown [searchable]="true" [addable]="true" class="dropDownWidth"
                    [selectedOption]="initialValues.party" [party]="true" (addPartyPopup)="openAddPartyModal($event)"
                    (addValueToList)="addValueToPartyPopup($event)" [params]="partyNamePopup" [maxLength]="255">
                    <select #customSelect formControlName="party" class="no-style select--modify"
                      (change)="onPartySelected($event.target.value)" (change)="stopLoaderClasstoBody()">
                      <option *ngFor="let party of partyList" value="{{ party.id }}">
                        {{ party.party_display_name }}
                      </option>
                    </select>
                  </material-dropdown>
                  <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
                  <app-error [controlName]="addAdvanceForm.controls.party"></app-error>

                </div>
              </div>

              <div *ngIf="advanceId" class="col-lg-3 col-sm-6">
                <div class="input-wrap disabled">
                  <label for="" class="input--required">Payment Number</label>
                  <div class="input--bd">{{ addAdvanceForm.controls.advance_number.value }}</div>
                </div>
              </div>

              <div *ngIf="!advanceId" class="col-lg-3 col-sm-6" >
                <div class="input-wrap select-custom error"
                  [ngClass]="addErrorClass(addAdvanceForm.controls.advance_number)">
                  <label for="" class="input--required">Payment Number</label>
                  <input type="text" class="no-style input--bd"  [readonly]="{disableInput: advanceId !=='null'}" placeholder="1234" value=""
                    formControlName="advance_number">
                  <app-error [controlName]="addAdvanceForm.controls.advance_number"></app-error>
                </div>
              </div>


              <div class="col-lg-3 col-sm-6">
                <div class="input-wrap error" [ngClass]="addErrorClass(addAdvanceForm.controls.received_date)">
                  <label for="" class="input--required">Receipt Date</label>
                  <mat-form-field>
                    <input matInput [matDatepicker]="received_date" (focus)="received_date.open()"
                      formControlName="received_date" placeholder="DD/MM/YYYY">
                    <mat-datepicker-toggle matSuffix [for]="received_date"></mat-datepicker-toggle>
                    <mat-datepicker #received_date></mat-datepicker>
                  </mat-form-field>
                  <app-error [controlName]="addAdvanceForm.controls.received_date"></app-error>
                </div>
              </div>
              <div class="col-lg-3 col-sm-6">
                <div class="input-wrap error" [ngClass]="addErrorClass(addAdvanceForm.controls.amount)">
                  <label for="" class="input--required">Amount ({{ currency_type?.symbol}})</label>
                  <input positiveThreeDigitDecimalNumber type="text" class="no-style input--bd" placeholder="1234"
                    value="" formControlName="amount" (change)="finalCalculation();">

                  <app-error [controlName]="addAdvanceForm.controls.amount"></app-error>
                </div>
              </div>

            </div>

            <app-advance-payment-box [ngClass]="{'hiddenContent':!isTax}" [editData]="editData" [gstin]="gstin"
              (paymentTax)="paymentTax($event)" [taxFormValid]="taxFormValid"></app-advance-payment-box>
            <div class="row tabIndexActiveFields">
              <div class="col-lg-3 col-sm-6">
                <div class="input-wrap select-custom" [ngClass]="addErrorClass(addAdvanceForm.controls.payment_mode)">
                  <label for="" class="input--required">Payment Mode</label>
                  <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth"
                    [selectedOption]="initialValues.paymentMode">
                    <select #customSelect formControlName="payment_mode" class="no-style select--modify"
                      (change)="onPaymentModeSelected()">
                      <option *ngFor="let option of accountsList" value="{{ option.id }}">
                        {{ option.name  }}
                      </option>
                    </select>
                  </material-dropdown>
                  <span class="error-message">Error messge!</span>
                </div>
              </div>
              <div class="col-lg-3 col-sm-6">
                <div class="input-wrap" [ngClass]="{disabled: !bankingChargesApply}">
                  <label for="">Banking Charges ({{ currency_type?.symbol}})</label>
                  <input positiveThreeDigitDecimalNumber type="text" class="no-style input--bd" placeholder="12" value=""
                    formControlName="bank_charge">

                  <span class="error-message">Error messge!</span>
                </div>
              </div>
              <div class="col-lg-3 col-sm-6">
                <div class="input-wrap">
                  <label for="">Description of Supply</label>
                  <input type="text" class="no-style input--bd" placeholder="Description of Supply" value=""
                    formControlName="description_of_supply">

                  <span class="error-message">Error messge!</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-layout__card notes">
          <div class="row tabIndexActiveFields">

            <div class="col-sm-6">
              <div class="input-wrap mb-0 pb-3">
                <label for="" class="">Optional Comments</label>
                <input type="text" class="no-style input--bd" placeholder="Comments" value=""
                  formControlName="optional_comments">
              </div>
            </div>
            <div class="col-sm-3">
              <div class="input-wrap mb-0 pb-3">
                <label for="" class="">Terms and Conditions</label> 
                  <material-dropdown [searchable]="true" [selectedOption]="initialValues.termsAndCondition" [addable]="false" class="dropDownWidth"
                  [addBlank]="true">
                     <select #customSelect formControlName="terms_and_condition" class="no-style select--modify">
                         <option *ngFor="let option of tersmAndConditions " value="{{option.id}}">
                          {{option.name}}
                         </option>
                     </select>
                  </material-dropdown>
              </div>
            </div>
          </div>
        </div>


        <div class="form-layout__card mg-top-30 tabIndexActive">
          <file-uploader (onFileUploaded)="fileUploader($event)" (onFileDeleted)="fileDeleted($event)" [multiple]="true"
            [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'" [showFileName]="false"
            [patchFileUrls]="patchFileUrls">
          </file-uploader>
        </div>
      </div>
    </div>
  </div>
  
</form>
<div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">
   
      <button class="btn btn--sm me-2" type="button" [routerLink]="[prefixUrl+'/income/payments/list/advance']">Cancel</button>
      <button class="btn btn--primary btn--sm" type="button" (click)="submitAdvancePayment()">{{advanceId?'Update':'Save'}}</button>
    
  </div>
<!-- Popup for adding party details -->
<app-add-party-popup [popDetail]="showAddPartyPopup" (closeModal)="closePartyPopup()"
  (partyAdded)="addPartyToOption($event)"></app-add-party-popup>
  <app-go-through  [goThroughDetais]="goThroughDetais"></app-go-through>
