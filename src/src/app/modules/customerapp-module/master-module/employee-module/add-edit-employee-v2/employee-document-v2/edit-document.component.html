<form [formGroup]="employee_details">
    <div class=" upload-id-wrap ">
        <div class="row layout-bg mx-0">

            <div class="col-xl-3 col-lg-3">
                <aside class="upload-menu-wrapper  h-500px px-0 overflow-auto">
                    <nav class="upload-menu">
                        <button class="gb-document-add  primary-brand-text border-bottom" matRipple type="button"
                            (click)="popupOverflowActive();openAddEditComponent(false,false,'')">
                            <i class="material-icons material-icons--al-top me-2 primary-brand-text">add</i>
                            Add Certificate </button>
                        <div class="flex-lg-wrap flex-nowrap row mx-0  ">
                            <button
                                class="upload-menu__item  text-start d-inline-flex align-items-center justify-content-between"
                                *ngFor="let document of documentsList; let i = index;"
                                [ngClass]="{'active': i==activeDoc, 'error': employee_details.controls.documents.controls[i]?.invalid && employee_details.controls.documents.controls[i]?.touched}"
                                (click)="changeDocument(i)">
                                <a class=" " [id]="'certificate-id'+document.name">{{document?.name }}</a>
                                <div>
                                    <span class="no-style px-2 " *ngIf=" i>=1"
                                        (click)="openAddEditComponent(true,false,i)">
                                        <i class="material-icons def-color gb-btn-hover edit-icon">edit</i>
                                    </span>
                                    <span class="no-style px-2 " *ngIf=" i>=1" (click)="deleteDocument()">
                                        <i class="material-icons text-danger del-icon">delete</i>
                                    </span>
                                </div>
                            </button>
                        </div>
                    </nav>
                </aside>
            </div>
            <div class="col-xl-9 col-lg-9 h-500px" formArrayName="documents">
                <div class="upload-id-content " *ngFor="let document of documentsList; let i = index;"
                    [formGroupName]="i" [ngClass]="{'active': i==activeDoc}">
                    <div class="form-layout__card" [ngClass]="{'active': i==activeDoc}">
                        
                        <div class="row tabIndexActiveFields align-items-center">
                            <div class="col-lg-4 col-sm-6">
                                <div class="input-wrap error"
                                    [ngClass]="addErrorClass(employee_details.controls.documents.controls[i].controls.number)">
                                    <label for="" class="input">{{ document?.name ? document?.name :document}} number</label>
                                    <input type="text" class="no-style input--bd" formControlName="number"
                                        placeholder="11/22/30945" value="" appUpperCase   (change)="onChangeNumber(employee_details.controls.documents.controls[i])">
                                    <app-error
                                        [controlName]="employee_details.controls.documents.controls[i].controls.number"></app-error>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="input-wrap error error--type-1"
                                    [ngClass]="addErrorClass(employee_details.controls.documents.controls[i].controls.issue_date)">
                                    <label for="" class="">{{ document?.name ? document?.name :document }} Issue Date</label>
                                    <mat-form-field class="width--100">
                                        <input matInput placeholder="DD/MM/YYYY" [matDatepicker]="iii"
                                            (focus)="iii.open()" formControlName="issue_date" readonly>
                                        <mat-datepicker-toggle matSuffix [for]="iii"></mat-datepicker-toggle>
                                        <mat-datepicker #iii startView="multi-year"></mat-datepicker>
                                    </mat-form-field>
                                    <app-error
                                        [controlName]="employee_details.controls.documents.controls[i].controls.issue_date"></app-error>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="input-wrap error" [ngClass]="addErrorClass(employee_details.controls.documents.controls[i].controls.expiry_date)">
                                    <label for="" [ngClass]="{'input--required':employee_details.controls.documents.controls[i].controls.is_expiry_mandatory.value && employee_details.controls.documents.controls[i].controls.number.value}">{{ document?.name ? document?.name :document }} Expiry Date</label>
                                    <mat-form-field class="width--100">
                                        <input matInput placeholder="DD/MM/YYYY" [matDatepicker]="ii" [min]="employee_details.controls.documents.controls[i].controls.issue_date.value"
                                            (focus)="ii.open()" formControlName="expiry_date" readonly>
                                        <mat-datepicker-toggle matSuffix [for]="ii"></mat-datepicker-toggle>
                                        <mat-datepicker #ii startView="multi-year"></mat-datepicker>
                                    </mat-form-field>
                                    <app-error [controlName]="employee_details.controls.documents.controls[i].controls.expiry_date"></app-error>
                                </div>
                            </div>
                            <div class="col-lg-4 col-sm-6">
                                <div class="input-wrap error"
                                    [ngClass]="addErrorClass(employee_details.controls.documents.controls[i].controls.country)">
                                    <label for="" class="">Country of Issue</label>
                                    <material-dropdown [searchable]="true" [selectedOption]="initialValues.country[i]">
                                        <select formControlName="country" #customSelect
                                            class="no-style select--modify">
                                            <option *ngFor="let option of countryList" value="{{ option?.name }}">
                                                {{ option?.name }}
                                            </option>
                                        </select>
                                    </material-dropdown>
                                    <app-error
                                        [controlName]="employee_details.controls.documents.controls[i].controls.country"></app-error>
                                </div>
                            </div>
                            <div class=" col-lg-4 col-sm-6">
                                <div class="input-wrap error"
                                    [ngClass]="addErrorClass(employee_details.controls.documents.controls[i].controls.vendor)">
                                    <label for="" class="input">Certificate Issued By</label>
                                    <material-dropdown [searchable]="true" [addBlank]="true" [addable]="true" [party]="true" 
                                    (addPartyPopup)="openAddPartyModal($event)" [params]="partyNamePopup" (addValueToList)="addValueToPartyPopup($event)"
                                    [selectedOption]="{label:employee_details.controls.documents.controls[i].controls.vendor_label.value,value:''}"
                                        class="dropDownWidth">
                                        <select #customSelect formControlName="vendor"
                                            class="no-style select--modify">
                                            <option *ngFor="let vendor of vendorList"
                                                value="{{ vendor.id }}">
                                                {{ vendor.party_display_name }}</option>
                                        </select>
                                    </material-dropdown>
                                    <app-error
                                        [controlName]="employee_details.controls.documents.controls[i].controls.vendor"></app-error>
                                </div>
                            </div>
                            <div class="d-flex flex-wrap gap-4 pt-4 border-top">
                                        
                                <file-uploader-v2 (onFileUploaded)="fileUploader($event,i)" [uploaderId]="'document-'+i"
                                [isShowOnlyUpload]="false"></file-uploader-v2>
                         
                            <div  *ngFor="let document of employee_details.controls.documents.controls[i].controls.files.value">
                                <app-file-delete-view [showInlineEdit]="false" [fileData]="document" 
                                (fileDeleted)="fileDeleted($event,i)"></app-file-delete-view>
                            </div>
                          
                        </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</form>
