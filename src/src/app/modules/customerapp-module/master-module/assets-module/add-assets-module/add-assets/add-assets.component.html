
    

<div class="add-screen-wrap d-flex flex-column">
    <div class="def-color px-4 py-3 layout-bg">

        <h6 class="fs-5" *ngIf="!assetId">Add Own Asset</h6>
        <h6 class="fs-5" *ngIf="assetId">Edit Own Asset</h6>
    </div>
    <div class="info-msg" *ngIf="!canCreateAsset">
        <p class="message-cont">Please Note: The Maximum Asset Limit ({{registeredAssets}}) has been reached for the
            tenant. Please delete any unused assets or
            contact the team to increase the limit.</p>
    </div>

    <div class="def-color p-4 shadow-inset-top-bottom" [ngClass]="{'disabled':assetId!='' || !canCreateAsset}">
        <p class=" fw-semibold">Asset Category<span class="text-danger">*</span></p>
        <p class="error-reg mt-1">{{category_selected_err}}</p>
        <div class="d-flex align-items-center pt-4">

            <div class=" me-4  veh-type" matRipple (click)="assetCatagoryChange('0')" [class.active]="assetsDetailsForm.get('category').value =='0'">
                <img src="../../../../../../../../assets/img/icons/trailer.svg"  alt="trailer image">

                               <p class="text-center mt-2">Trailer</p>
            </div>

            <div class=" me-4  veh-type"  matRipple (click)="assetCatagoryChange('1')" [class.active]="assetsDetailsForm.get('category').value =='1'">
                <img src="../../../../../../../../assets/img/icons/dollie.svg"   alt="dollie image">
               <p class="text-center mt-2">Dolly</p>
            </div>
        </div>


    </div>
   
    
            <div class=" flex-grow-1 d-flex justify-content-center align-items-center flex-column" *ngIf="!isCatagorySelected" >
                <i class="bi bi-truck select-veh-truck"></i>
                <p class="select-veh-text"> Please select a Asset category for more details</p>
            </div>
        
      
   
    <div *ngIf="isCatagorySelected">
        <form [formGroup]="assetsDetailsForm">
            <div class="alert-msg" *ngIf="apiError">
                <span class="icon-wrap"></span>
                <p class="message-cont">{{ apiError }}</p>
            </div>
            <div class="row p-4 pb-0 mx-0 shadow-inset-bottom">
                <div class="col-xl-3 col-lg-4 col-sm-6 ">
                    <div class="input-wrap error" [ngClass]="addErrorClass(assetsDetailsForm.controls.asset_no)">
                        <label for="" class="input--required">Asset No.</label>
                        <input appUpperCase type="text" class="no-style input--bd" placeholder="AAAA0000"
                            formControlName="asset_no" maxlength="14" value="" (change)="setDisplayNo()">
                        <app-error [controlName]="assetsDetailsForm.controls.asset_no"></app-error>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-4 col-sm-6 ">
                    <div class="input-wrap error" [ngClass]="addErrorClass(assetsDetailsForm.controls.display_no)">
                        <label for="" class="input--required">Display No.</label>
                        <input appUpperCase type="text" class="no-style input--bd" placeholder="AAAA0000"
                            formControlName="display_no" maxlength="14" value="">
                        <span *ngIf="regError" class="error-reg">{{regError}}</span>
                        <app-error [controlName]="assetsDetailsForm.controls.display_no"></app-error>
                    </div>
                </div>
        
                <div class="col-xl-3 col-lg-4 col-sm-6"> 
                    <div class="input-wrap error" [ngClass]="addErrorClass(assetsDetailsForm.controls.specification)">
                        <label for="" class="input--required">Specification</label>
                        <material-dropdown  [searchable]="true" [selectedOption]="initialValues.specification" [addable]="true" class="dropDownWidth" 
                            [postApiUrl]="assetsApi" [params]="addSpecificatins" (postApiResponse)="getNewSpecifications($event)"
                            (addValueToList)="addNewSpecifications($event)">
                            <select #customSelect formControlName="specification" class="no-style select--modify" (change)="vehicleSpecificationChange()">
                                <option *ngFor="let option of assetsTypeList" value="{{ option?.id }}">
                                    {{ option?.specification }}
                                </option>
                            </select>
                        </material-dropdown>
                        <app-error [controlName]="assetsDetailsForm.controls.specification"></app-error>
                    </div>
                </div>
        
                <div class="col-xl-3 col-lg-4 col-sm-6">
                    <div class="input-wrap m-0">
                        <label for=""  class="input--required">Asset (Brand and Model)</label>
                    </div>
                    <ng-container>
                        <div class="row" formGroupName="brand" [ngClass]="{'disable':!assetsDetailsForm.controls.specification.value}">
                            <div class="col-6">
                                <div class="input-wrap"
                                    [ngClass]="addErrorClass(assetsDetailsForm.controls.brand.get('make'))">
                                    <material-dropdown [searchable]="true" [selectedOption]="initialValues.make" [addable]="true" class="dropDownWidth"
                                        [disabled]="!assetsDetailsForm.controls.specification.value" [postApiUrl]="assetMakeUrl" [params]="assetMakeParam"
                                        (postApiResponse)="getNewAssetMake($event)"
                                        (addValueToList)="addNewAssetMake($event)">
                                        <select #customSelect formControlName="make" class="no-style select--modify"
                                            (change)="onMakeSelected($event)">
                                            <option *ngFor="let option of assetsMake" value="{{ option.id }}">
                                                {{ option.make_name }}
                                            </option>
                                        </select>
                                    </material-dropdown>
                                    <app-error
                                        [controlName]="assetsDetailsForm.controls.brand.get('make')"></app-error>
                                </div>
                            </div>
                            <div class="col-6" [ngClass]="{'disable':!assetsDetailsForm.controls.brand.get('make').value}">
                                <div class="input-wrap"
                                    [ngClass]="addErrorClass(assetsDetailsForm.controls.brand.get('model'))">
                                    <material-dropdown  [disabled]="!assetsDetailsForm.controls.brand.get('make').value"  [selectedOption]="initialValues.model" [searchable]="true" [addable]="true" class="dropDownWidth"
                                        [addBlank]="false" [postApiUrl]="assetModelUrl" [params]="assetModelParam"
                                        (postApiResponse)="getNewAssetModel($event)"
                                        (addValueToList)="addNewAssetModel($event)">
                                        <select #customSelect formControlName="model" class="no-style select--modify">
                                            <option *ngFor="let option of assetModel" value="{{ option.id }}">
                                                {{ option.model_name }}
                                            </option>
                                        </select>
                                    </material-dropdown>
                                    <app-error [controlName]="assetsDetailsForm.controls.brand.get('model')"></app-error>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </div>
              
            </div>
            <div class="gb-tab-wrapper" >
                <mat-tab-group mat-stretch-tabs="false" [selectedIndex]="selectedTabIndex"  animationDuration="0ms" mat-align-tabs="start"  #tabGroup>
                  <mat-tab label="Asset Details">
                    <ng-template mat-tab-label>  
                      <span  >Asset Details</span>
                    </ng-template>
                    <app-assets-details [catagory]="catagory" [assetsDetailsForm]="this.assetsDetailsForm" [documentEditList]="ownAssetSubDetails">
                    </app-assets-details>
                   </mat-tab>
                  <mat-tab label="Certificates">
                    <ng-template mat-tab-label>
                      <span class="fw-semibold " [ngClass]="{taberror:isCertificateTabError}" >Certificates</span>
                    </ng-template>
                    <app-assets-certificate
                    [assetsDetailsForm]="this.assetsDetailsForm" [isFormValid]="isFormValid" [newPartyDetails]="newPartyDetailsCertificate" (addNewParty)="addNewParty($event)" [catagory]="catagory"  [documentEditList]="certificate"></app-assets-certificate>
                    </mat-tab>

                    <mat-tab label="Permits">
                        <ng-template mat-tab-label>
                          <span class="fw-semibold " [ngClass]="{taberror:isPermitsTabError}" >Permits</span>
                        </ng-template>
                        <app-assets-permits [assetsDetailsForm]="this.assetsDetailsForm" [isEdit]="assetId?true:false" [isFormValid]="isFormValid" [newPartyDetails]="newPartyDetailsAssets" [permitEditList]="assetsPermits" (addNewParty)="addNewParty($event)" [catagory]="catagory"></app-assets-permits>
                    </mat-tab>


                  <mat-tab label="Attachments">
                    <ng-template mat-tab-label>
                      <span class="fw-semibold "[ngClass]="{taberror:isSubAssetTabError}"  >Attachments</span>
                    </ng-template>
                    <app-assets-attachments [catagory]="catagory" [isFormValid]="isFormValid" [assetsDetailsForm]="this.assetsDetailsForm" [documentEditList]="subAssets">
                    </app-assets-attachments>
                  </mat-tab>
                  <mat-tab label="Tyre Master" >
                    <ng-template mat-tab-label>
                      <span  >Tyre Master</span>
                    </ng-template>
                    <app-assets-tyre-master [assetsDetailsForm]="this.assetsDetailsForm" [editTyreDetails]="tyreDetails"></app-assets-tyre-master>
                  </mat-tab>
                </mat-tab-group>
              </div>

            
        </form>

    </div>

</div>



<div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end" *ngIf="canCreateAsset">

    <button class="btn btn--sm me-2" type="button" [routerLink]="[prefixUrl+'/onboarding/assets/list']">Cancel</button>
    <button class="btn btn--primary btn--sm"  (click)="submitForm()">{{assetId?'Update':'Save'}}</button>

</div>
<app-add-party-popup *ngIf="showAddPartyPopup.status" [popDetail]="showAddPartyPopup" (closeModal)="closePartyPopup()"
  (partyAdded)="addPartyToOption($event)" [isVendor]="true"></app-add-party-popup>
