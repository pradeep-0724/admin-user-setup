<div [formGroup]="truckFormGroup" >
    <div class="form-layout--pd pt-0">
       <div class="row">
           <div class="col-xl-3 col-lg-3 col-md-3 col-6">
               <div class="input-wrap mb-0 error dropdownArrow  rounded-input-box"
                   [ngClass]="addErrorClass(truckFormGroup.controls.route_code)">
                   <label for="">Route</label>
                   <app-tool-tip class="route-tool-tip-position" [totalSlides]="routeToolTip.content.length"
                       position="right" [toolTipContent]="routeToolTip"></app-tool-tip>
                   <material-dropdown [searchable]="true" [addable]="false"
                       [selectedOption]="initialValues.route_code">
                       <select #customSelect formControlName="route_code" class="no-style select--modify"
                           (change)="routeSelected()">
                           <option *ngFor="let option of routeCodeList" value="{{ option?.name }}">
                               {{ option?.name }}
                           </option>
                       </select>
                   </material-dropdown>
                   <app-error [controlName]="truckFormGroup.controls.route_code"></app-error>
               </div>
           </div>
       </div>
    </div>
   <app-multiple-destination2 [multipleDestinationForm]="truckFormGroup" [ismultipleDestinationFormValid]="ismultipleDestinationFormValid" [routeId]="routeId" [routeDestinations]="routeDestinations"
   [customerId]="customerId"></app-multiple-destination2>

   <div class="quotation-customFields">
       <div class="gb-tab-wrapper">
           <mat-tab-group mat-stretch-tabs="false" class="mat-group" animationDuration="0ms" mat-align-tabs="start">
             <mat-tab>
               <ng-template mat-tab-label>
                 <span [ngClass]="{ taberror:isClientFreightError  }">Customer Freight</span>
               </ng-template>
               <app-generic-freight-material-section   [showRateAndUnitsFields]="true" [showTax]="true" [editDetails]="materialFreightEditDetails"  (materailsFormValue)="materailsFormValue($event)" [parentForm]="truckFormGroup" [isSubFormValid]="isSubFormValid"></app-generic-freight-material-section>
               </mat-tab>
               <mat-tab>
                   <ng-template mat-tab-label>
                     <span [ngClass]="{ taberror: isAddChargesTabError  }">Additional Charges</span>
                   </ng-template>
                   <div class="p-4">
                    <div class="mb-3">
                        <button class="btn btn--primary ms-auto w-auto" (click)="addCharges()">+ Add Additional charge</button>

                    </div>
                    <div class="addable-row-table " formArrayName="additional_charge">

                        <table>
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>
                                        Additional Charge
                                    </th>
                                    <th *ngIf="isTax">Tax</th>
                                    <th>Unit Of Measurement </th>
                                    <th>No. Of Units </th>
                                    <th>Unit Cost   ( {{ currency_type?.symbol}})</th>
                                    <th>Total Amount  ( {{ currency_type?.symbol}}) </th>

                                </tr> 

                            </thead>
                            <tbody>
                                <tr class="border-0" *ngIf="this.truckFormGroup.controls['additional_charge']['controls'].length==0 || !this.truckFormGroup.controls['additional_charge']['controls'][0].get('name').value">
                                    <td class="bg-white" colspan="30">
                                      <div class="no-list-data-wrap">
                                        <figure>
                                          <img src="assets/img/no-content.png" alt="">
                                        </figure>
                                        <h5 class="mt-3 primary-brand-text">No additional charges added!</h5>
                                      </div> 
                                    </td>
                                </tr>
                                <tr *ngFor="let control of this.truckFormGroup.controls['additional_charge']['controls'];let i = index"
                                    [formGroupName]="i">
                                    <ng-container *ngIf="control.get('name').value?.['name']">
                                        <td class="ps-4"> <mat-checkbox formControlName="is_checked" (change)="onChangeAdditionalChargeCheckBox(control)"
                                            color="primary"></mat-checkbox></td>
                                    <td>{{control.get('name').value?.['name']}}</td>
                                    <td  *ngIf="isTax" [ngClass]="{'invalid-input':control.get('tax').invalid && control.get('tax').touched ,'disable':!control.get('is_checked').value}">
                                        <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" [selectedOption]="initialValues.additionalTax[i]" [disabled]="!control.get('is_checked').value">
                                            <select #customSelect name="" class="no-style select--modify error-box" formControlName="tax" (change)="onCalculationsChange()">
                                            <option *ngFor="let option of quotationTotals.taxes"
                                                value="{{ option.id }}">{{
                                                option.label }}</option>
                                            </select>
                                          </material-dropdown>
                                    </td>
                                    <td [ngClass]="{'invalid-input':control.get('unit_of_measurement').invalid && control.get('unit_of_measurement').touched ,'disable':!control.get('is_checked').value}">
                                        <material-dropdown [disabled]="!control.get('is_checked').value" [searchable]="true" [selectedOption]="initialValues.unit[i]">
                                            <select #customSelect formControlName="unit_of_measurement">
                                                <option *ngFor="let option of unitOfMeasurementList" [ngValue]="option">
                                                    {{ option?.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>
                                    </td>
                                    <td [ngClass]="{'invalid-input':control.get('quantity').invalid && control.get('quantity').touched ,'disable':!control.get('is_checked').value}">
                                        <div>
                                            <input type="text" [readonly]="!control.get('is_checked').value" [ngClass]="{'disable':!control.get('is_checked').value}" positiveThreeDigitDecimalNumber formControlName="quantity" class="error-box"
                                                placeholder="Eg.: 1234567" value="0" (change)="onChangeAdditionalCharge()">
                                        </div>
                                    </td>

                                    <td [ngClass]="{'invalid-input':control.get('unit_cost').invalid && control.get('unit_cost').touched ,'disable':!control.get('is_checked').value}">
                                        <div>
                                            <input [ngClass]="{'disable':!control.get('is_checked').value}" [readonly]="!control.get('is_checked').value" type="number" positiveThreeDigitDecimalNumber formControlName="unit_cost" class="error-box"
                                                placeholder="Eg.: 1234567" value="0" (change)="onChangeAdditionalCharge()">
                                        </div>
                                    </td>
                                    <td [ngClass]="{'disable':!control.get('is_checked').value}">
                                        <div>
                                            <input [ngClass]="{'disable':!control.get('is_checked').value}" type="text" positiveThreeDigitDecimalNumber formControlName="total" class="error-box"
                                                placeholder="Eg.: 1234567" readonly>
                                        </div>
                                    </td>
                                    </ng-container>

                                </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                </mat-tab>
           </mat-tab-group>
         </div>
   </div>
<div class="row">
   <div class="col-lg-7 p-0">
       <div class="fake-tab-bar">
           <span>Signature</span>
       </div>
       <div class="row p-4 ps-5">
           <div class="col-lg-5 ">
               <div class="input-wrap clearfix">
                   <div class="d-flex flex-wrap">
                   <label for="" class=" me-2">Terms and condition</label>
                   <app-tool-tip  [totalSlides]="T_AND_C_Tooltip.content.length"
                       position="right" [toolTipContent]="T_AND_C_Tooltip"></app-tool-tip>
                   </div>
                   <div>
                       <material-dropdown [addBlank]="true" [selectedOption]="initialValues.termsAndCondition">
                           <select #customSelect class="no-style select--modify"
                               formControlName="terms_and_condition">
                               <option *ngFor="let option of tersmAndConditions " value="{{option.id}}">
                                   {{option.name}}
                               </option>
                           </select>
                       </material-dropdown>
                   </div>
               </div>
           </div>

           <!-- <div class="col-lg-5">
               <div class="input-wrap clearfix">
                   <label for="" class="">Customer Approval Status</label>
                   <div>
                       <material-dropdown [selectedOption]="initialValues.clientApprovalStatus">
                           <select #customSelect class="no-style select--modify"
                               formControlName="status">
                               <option *ngFor="let option of quotationApprovalStatus "
                                   value="{{option.value}}">
                                   {{option.label}}
                               </option>
                           </select>
                       </material-dropdown>
                   </div>
               </div>
           </div> -->

           <div class="col-lg-5">
               <div class="input-wrap clearfix">
                   <label for="" class="">Narration</label>
                   <div>
                       <input type="text" class="no-style input--bd" placeholder="Narration"
                           formControlName="narration" value="">
                   </div>
               </div>
           </div>
           <div class="col-lg-5">
               <div class="input-wrap clearfix">
                   <div class="d-flex flex-wrap">
                   <label for="" class="me-2">Signature</label>
                   <app-tool-tip  [totalSlides]="signatureToolTip.content.length"
                       position="right" [toolTipContent]="signatureToolTip"></app-tool-tip>
                       </div>
                   <div>
                       <material-dropdown [addBlank]="true" [selectedOption]="initialValues.signature">
                           <select #customSelect class="no-style select--modify" formControlName="signature">
                               <option *ngFor="let option of digitalSignature " value="{{option.id}}">
                                   {{option.name}}
                               </option>
                           </select>
                       </material-dropdown>
                   </div>
               </div>
           </div>
       </div>

   </div>
   <div class=" col-lg-5 p-0 box-shadow-left">
       <div class="fake-tab-bar">
           <span>Balance</span>
       </div>
       <div>
          
           <div class="p-4">
               <div class="d-flex align-items-center justify-content-between mb-4">
                   <p class=" fw-bold min-w-145px ">  Subtotal freight </p>
                   <p class=" fw-bold"> {{ currency_type?.symbol}} {{
                       quotationTotals.subtotal_freights|numberFormat }}</p>
               </div>
               <div class="d-flex align-items-center justify-content-between mb-4">
                   <p class=" fw-bold min-w-145px "> Subtotal Additional Charges </p>
                   <p class=" fw-bold"> {{ currency_type?.symbol}} {{
                       quotationTotals.subtotal_others|numberFormat }}</p>
               </div>
               <div class=" mb-4 align-items-center " [ngStyle]="{ 'display': 'none'  }">
                   <div class="d-flex align-items-center">
                       <p class="fw-bold min-w-145px "> Discount</p>
                       <div class="input gst-input">
                           <input twoDigitDecimalNumber type="text" class="error-box" placeholder=""
                               formControlName="discount_value" (change)="onCalculationsChange()">
                       </div>
                       <div class="select-wrap dropdown gst-symbol-dropdown">
                           <select name="" class="no-style select--modify custom-select"
                               formControlName="discount_choice" (change)="onCalculationsChange()">
                               <option value="0" selected>%</option>
                               <option value="1">{{ currency_type?.symbol}}</option>
                           </select>
                       </div>

                   </div>
                   <p class="fw-bold"> {{ currency_type?.symbol}} {{
                       quotationTotals.discountTotal
                       }} </p>
               </div>

              
               <ng-container  *ngFor="let percentageTotal of quotationTotals.taxes;">
                   <div class=" mb-4 align-items-center d-flex justify-content-between"  *ngIf="percentageTotal.total && percentageTotal.taxAmount>0">
                       <p class="fw-bold min-w-145px"> Include {{terminology.tax_type}} &#64;{{
                           percentageTotal.value  }}% on
                           <span>{{ percentageTotal.total|numberFormat }}</span>:
                       </p>
                       <p class="fw-bold"> {{ currency_type?.symbol}} {{ percentageTotal.taxAmount|numberFormat }} </p>
                   </div> 
               </ng-container>
             
              


               <div *ngIf="isTax" class=" mb-4 align-items-center d-flex justify-content-between">
                   <div class="d-flex align-items-center">
                       <p class="fw-bold min-w-145px "> Discount after Tax</p>
                       <div class="input gst-input">
                           <input positiveThreeDigitDecimalNumber type="text" class="error-box"
                               placeholder="0.00" formControlName="discount_value_after_tax"
                               (change)="onCalculationsChange()">
                       </div>
                       <div class="select-wrap dropdown gst-symbol-dropdown">
                           <select name="" class="no-style select--modify custom-select"
                               formControlName="discount_choice_after_tax" (change)="onCalculationsChange()">
                               <option value="0">%</option>
                               <option value="1">{{ currency_type?.symbol}}</option>
                           </select>
                       </div>

                   </div>
                   <p class="fw-bold"> {{ currency_type?.symbol}} {{
                       quotationTotals.discountAfterTaxTotal }} </p>
               </div>


               <div class=" mb-4 align-items-center d-flex justify-content-between">
                   <div class="d-flex  ">
                       <p class=" fw-bold min-w-145px "> Round Off </p>
                       <mat-checkbox [disableRipple]="true" (change)="onRoundOffEvent($event)"
                           formControlName="is_roundoff">
                       </mat-checkbox>
                   </div>
                   <p class="fw-bold"> {{ currency_type?.symbol}} {{
                       quotationTotals.roundOffAmount }} </p>
               </div>

           </div>

           <div class="d-flex justify-content-between px-4 py-3 border-top border-2">
               <p class=" fw-bold min-w-145px fs-5 "> Total </p>
               <p class=" fw-bold fs-5"> {{ currency_type?.symbol}} {{ quotationTotals.total|numberFormat
                   }}</p>
           </div>
       </div>


   </div>

</div>

</div>

