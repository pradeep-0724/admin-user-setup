<div class="right-section__header">
    <h1 class="heading col-8" *ngIf="!fleetExpenseId">Add Vehicle Payment</h1>
    <h1 class="heading col-8" *ngIf="fleetExpenseId">Edit Vehicle Payment</h1>
    <button class="gb-video-play float-right" (click)="openGothrough()">
        <i class="bi bi-play-circle-fill"></i>
    </button>

</div>
<form [formGroup]="mechanicActivityForm" *ngIf="mechanicActivityForm">
    <div class="alert-msg" *ngIf="apiError">
        <span class="icon-wrap"></span>
        <p class="message-cont">{{ apiError }}</p>
    </div>
    <div class="error-msg-list" *ngIf="globalFormErrorList.length > 0">
        <p class="message-head">{{ errorHeaderMessage }}</p>
        <span class="icon-wrap"></span>
        <ul *ngFor="let error of globalFormErrorList">
            <li class="message-cont">{{ error }}</li>
        </ul>
    </div>
    <div class="form-body pb-0 shadow-inset-top-lg form-layout form-layout--pd no-br-tl no-br-tr">
        <div class="row">

            <div *ngIf="fleetExpenseId" class="col-lg-3 col-sm-6">
                <div class="input-wrap disabled">
                    <label for="" class="input--required position-relative">Vendor <span *ngIf="isTdsDecleration"
                            class="blueTag">TDS Declaration Received</span></label>
                    <div class="input--bd">{{ initialValues.vendor.label }}</div>
                    <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}}</span>
                </div>
            </div>

            <div *ngIf="!fleetExpenseId" class="col-lg-3 col-sm-6">
                <div class="input-wrap error change_function"
                    [ngClass]="addErrorClass(mechanicActivityForm.controls.vendor)">
                    <label for="" class="input--required position-relative">Vendor <span class="blueTag"
                            *ngIf="isTdsDecleration">TDS Declaration Received</span> </label>
                    <material-dropdown [searchable]="true" [addable]="true" class="dropDownWidth"
                        [selectedOption]="initialValues.vendor" [party]="true"
                        (addPartyPopup)="openAddPartyModal($event)" (addValueToList)="addValueToPartyPopup($event)"
                        [params]="vendorNamePopup" [maxLength]="255">
                        <select #customSelect formControlName="vendor" class="no-style select--modify removeLoader"
                            (change)="onVendorSelected($event.target.value)" (change)="stopLoaderClasstoBody()">
                            <option *ngFor="let vendor of vendorList" value="{{ vendor.id }}">
                                {{ vendor.party_display_name }}</option>
                        </select>
                    </material-dropdown>
                    <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}}</span>

                    <app-error [controlName]="mechanicActivityForm.controls.vendor"></app-error>

                </div>
            </div>


            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap">
                    <label for="">Employee In Charge</label>
                    <material-dropdown [searchable]="true" [addable]="false" [selectedOption]="initialValues.employee"
                        class="dropDownWidth" [addBlank]="true">
                        <select #customSelect formControlName="employee" class="no-style select--modify"
                            (change)="handleEmployeeChange()">
                            <option *ngFor="let employee of employeeList" value="{{ employee.id }}">
                                {{ employee.emp_name_id }}</option>
                        </select>
                    </material-dropdown>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap error" [ngClass]="addErrorClass(mechanicActivityForm.controls.bill_number)"
                    [class.disabled]="isAmountUsed">
                    <label for="" class="input--required">Bill Number</label>
                    <input type="text" class="no-style input--bd" placeholder="Eg.:1234567" value=""
                        formControlName="bill_number">
                    <span class="border-anim"></span>
                    <app-error [controlName]="mechanicActivityForm.controls.bill_number"></app-error>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap error" [ngClass]="addErrorClass(mechanicActivityForm.controls.bill_date)">
                    <label for="" class="input--required">Bill Date</label>
                    <mat-form-field>
                        <input matInput readonly [matDatepicker]="bill_date" (focus)="bill_date.open()"
                            formControlName="bill_date" (dateChange)="onCalendarChangePTerm($event.target.value)"
                            placeholder="DD/MM/YYYY">
                        <mat-datepicker-toggle matSuffix [for]="bill_date"></mat-datepicker-toggle>
                        <mat-datepicker #bill_date></mat-datepicker>
                    </mat-form-field>
                    <app-error [controlName]="mechanicActivityForm.controls.bill_date"></app-error>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap">
                    <label for="" class="input">Payment Term</label>
                    <material-dropdown [searchable]="true" [addable]="false"
                        [selectedOption]="initialValues.paymentTerm" class="dropDownWidth"
                        [selectedOption]="initialValues.paymentTerm" [addBlank]="true">
                        <select #customSelect formControlName="payment_term" class="no-style select--modify"
                            (change)="onpaymentTermSelected($event.target.value)">
                            <option *ngFor="let option of staticOptions.paymentTermList" value="{{ option.id }}">
                                {{ option.label }}</option>
                        </select>
                    </material-dropdown>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap error" [ngClass]="addErrorClass(mechanicActivityForm.controls.due_date)">
                    <label for="" *ngIf="!isDueDateRequired">Due Date</label>
                    <label for="" class="input--required" *ngIf="isDueDateRequired">Due Date</label>
                    <mat-form-field>
                        <input matInput [min]="minDate" [matDatepicker]="due_date" (focus)="due_date.open()"
                            (dateChange)="onWorkEndDateChange()" formControlName="due_date" placeholder="DD/MM/YYYY">
                        <mat-datepicker-toggle matSuffix [for]="due_date"></mat-datepicker-toggle>
                        <mat-datepicker #due_date></mat-datepicker>
                    </mat-form-field>
                    <app-error [controlName]="mechanicActivityForm.controls.due_date"></app-error>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap error" [ngClass]="addErrorClass(mechanicActivityForm.controls.reference_no)">
                    <label for="" class="input">Reference No </label>
                    <input type="text" class="no-style input--bd" placeholder="Reference No"
                        formControlName="reference_no">
                    <!-- <span class="border-anim"></span> -->
                    <app-error [controlName]="mechanicActivityForm.controls.reference_no"></app-error>
                </div>
            </div>

            <div class="col-lg-3 col-sm-6">
                <div class="input-wrap">
                    <label for="">Point of Contact (Name)</label>
                    <material-dropdown [searchable]="true" [disableLastInput]="true"
                        (nonOptionSetValue)="setContactPersons($event)"
                        [selectedOption]="{label:mechanicActivityForm.controls.contact_person_name.value,value:''}"
                        [addable]="false" class="dropDownWidth" [addBlank]="true">
                        <select #customSelect formControlName="contact_person_name" class="no-style select--modify"
                            (change)="onContactPersonChange()">
                            <option *ngFor="let contactperson of contactPersonList"
                                value="{{ contactperson.display_name}}">
                                {{ contactperson.display_name }}
                            </option>
                        </select>
                    </material-dropdown>
                    <!-- <span class="border-anim"></span> -->
                </div>
            </div>

            <div class="col-lg-3 col-sm-6 input-wrap mb-0 country-filed-height">

                <label for="" class="input" id="cc-font">Point of Contact (Mobile)</label>

                <div class="row mx-0" formGroupName="contact_person_no">
                    <div class="col-4 px-0">
                        <div class="width-country-code custom-margin me-0">

                            <material-dropdown class="dropDownWidth"
                                [selectedOption]="{label:mechanicActivityForm.controls['contact_person_no'].get('code').value,value:''}">
                                <select #customSelect formControlName="code" class="no-style select--modify">
                                    <option *ngFor="let phone_code of countryPhoneCode" [value]="phone_code">
                                        {{phone_code}}
                                    </option>
                                </select>
                            </material-dropdown>
                        </div>
                    </div>
                    <div class="px-0 number-grow col-8 px-0">
                        <div class="ms-3">
                            <div class="w-auto px-0 number-grow">
                                <div class="error input-wrap"
                                    [ngClass]="addErrorClass(mechanicActivityForm.controls['contact_person_no'].get('no'))">
                                    <input type="text" class="no-style input--bd" placeholder="9999999999"
                                        formControlName="no">
                                    <app-error
                                        [controlName]="mechanicActivityForm.controls['contact_person_no'].get('no')"></app-error>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <app-tax-inclusive [taxInclusiveForm]="mechanicActivityForm"  [editData]="editData" [partyDetails]="partyTaxDetails" [ngClass]="{'hiddenContent':!isTax}"
            (taxInclusiveFormValueChange)="headerTaxDetails($event)"
            [isValidForm]="taxFormValid">
            </app-tax-inclusive>
        </div>

    </div>
    <div class="gb-tab-wrapper">
        <mat-tab-group animationDuration="0ms" [selectedIndex]="activetabIndex">

            <mat-tab *ngIf="isCarneDataAvailable">
                <ng-template mat-tab-label>
                    <span>Job for Cranes</span>
                </ng-template>

                <div class="row mx-0  py-2">
                    <div class="col-lg-3 col-md-6 my-2 ">
                        <div class="box-tab" matRipple [matRippleDisabled]="craneTabActiveIndex==1"
                            (click)="craneTabActiveIndex=1" [ngClass]="{'active':craneTabActiveIndex==1}">
                            <b>Timesheets </b>
                            <ng-container *ngIf="craneTimeSheet.selectedSheetList.length==0">
                                <p *ngIf="craneTimeSheet.sheetList.length>0">Please select by clicking <span
                                        (click)="openCraneAwpTimeSheet('crane')" class="custom-link"
                                        [ngClass]="{'disable':craneTabActiveIndex!=1}"> here </span></p>
                                <p *ngIf="craneTimeSheet.sheetList.length==0">No Timesheets found.</p>
                            </ng-container>

                        </div>

                    </div>
                    <div class="col-lg-3 col-md-6 my-2">
                        <div class="box-tab" matRipple [matRippleDisabled]="craneTabActiveIndex==3"
                            (click)="craneTabActiveIndex=3" [ngClass]="{'active':craneTabActiveIndex==3}">
                            <b>Job Charge</b>
                            <ng-container *ngIf="craneCharges.selectedChargeList.length==0">
                                <p *ngIf="craneCharges.chargeList.length>0">Please select by clicking <span
                                        (click)="openCraneAwpCharges('crane')" class="custom-link"
                                        [ngClass]="{'disable':craneTabActiveIndex!=3}"> here </span></p>
                                <p *ngIf="craneCharges.chargeList.length==0">No Job Charges found.</p>
                            </ng-container>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 my-2 ">
                        <div class="box-tab" matRipple [matRippleDisabled]="craneTabActiveIndex==4"
                            (click)="craneTabActiveIndex=4" [ngClass]="{'active':craneTabActiveIndex==4}">
                            <b>Job Deduction</b>
                            <ng-container *ngIf="craneDeductions.selectedDeductionList.length==0">
                                <p *ngIf="craneDeductions.deductionList.length>0">Please select by clicking <span
                                        (click)="openCraneAwpDeductions('crane')" class="custom-link"
                                        [ngClass]="{'disable':craneTabActiveIndex!=4}"> here </span></p>
                                <p *ngIf="craneDeductions.deductionList.length==0">No Job Deductions found.</p>
                            </ng-container>
                        </div>
                    </div>
                </div>

                <div *ngIf="craneTabActiveIndex ==1 && this.craneTimeSheet.selectedSheetList.length"
                    formGroupName="crane">


                    <div class="d-flex justify-content-between p-3 pt-0">
                        <div>

                            <div [ngClass]="{'hiddenContent':!isTax}" class="tabIndexActiveFields">
                                <div >
                                    <div class="tax-input-box ">
                                        <span for="">Tax</span>
                                        <material-dropdown 
                                            [selectedOption]="initialValues.craneTax">
                                            <select #customSelect class="no-style select--modify"
                                                formControlName="timesheet_tax"
                                                (change)="onSelectTimeSheetTax('crane')">
                                                <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                                    {{ option.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openCraneAwpTimeSheet('crane')">Manage</button>
                        </div>
                    </div>
                    <div class="addable-row-table m-1 mt-0 ws-nowrap">
                        <table>
                            <thead>
                                <tr>
                                    <th rowspan="2" class="border-start-0">
                                        Sales Order No.
                                    </th>
                                    <th rowspan="2">JOB NO. </th>
                                    <th rowspan="2">JOB Date. </th>
                                    <th rowspan="2">VEHICLE NO.</th>
                                    <th rowspan="2">Timesheet No.</th>
                                    <th rowspan="2">Start Date</th>
                                    <th rowspan="2">End Date</th>
                                    <th colspan="3" class="text-center">Billing Amount ({{currency_type?.symbol}})</th>
                                    <th colspan="3" class="text-center">Extra Amount ({{currency_type?.symbol}})</th>
                                    <th rowspan="2" *ngIf="isTax">Total Tax ({{currency_type?.symbol}})</th>
                                    <th rowspan="2">Total Amount ({{currency_type?.symbol}})</th>

                                </tr>
                                <tr>

                                    <th>Unit</th>
                                    <th>Rate per Unit ({{currency_type?.symbol}})</th>
                                    <th>Amount ({{currency_type?.symbol}})</th>
                                    <th>Unit</th>
                                    <th>Rate per Unit ({{currency_type?.symbol}})</th>
                                    <th>Amount ({{currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="timesheets">
                                <tr *ngFor="let timesheet of mechanicActivityForm.controls.crane.controls.timesheets.controls; let i = index;"
                                    [formGroupName]="i">

                                    <td class="py-3">{{timesheet.value.workorder_no
                                        ?timesheet.value.workorder_no:'-'}}</td>
                                    <td>{{timesheet.value.trip_id ?timesheet.value.trip_id:'-'}}</td>
                                    <td>{{timesheet.value?.date |formateDate }}</td>
                                    <td>{{timesheet.value?.vehicle_no ?timesheet.value?.vehicle_no:'-'}}</td>
                                    <td>{{timesheet.value?.timesheet_no ?timesheet.value?.timesheet_no:'-'}}</td>
                                    <td>{{timesheet.value?.start_date |formateDate }}</td>
                                    <td>{{timesheet.value?.end_date |formateDate }}</td>
                                    <td>{{timesheet.value?.billing_hours ?timesheet.value?.billing_hours:'0'}}</td>
                                    <td>{{timesheet.value?.billing_rate ?timesheet.value?.billing_rate:'0'}}</td>
                                    <td>{{timesheet.value?.billing_amount ?timesheet.value?.billing_amount:'0'}}
                                    </td>
                                    <td>{{timesheet.value?.extra_hours ?timesheet.value?.extra_hours:'0'}}</td>
                                    <td>{{timesheet.value?.extra_rate ?timesheet.value?.extra_rate:'0'}}</td>
                                    <td>{{timesheet.value?.extra_amount ?timesheet.value?.extra_amount:'0'}}</td>
                                    <td *ngIf="isTax">{{timesheet.value?.tax_amount
                                        ?timesheet.value?.tax_amount:'0'}}</td>
                                    <td>{{timesheet.value?.amount ?timesheet.value?.amount:'0'}}</td>
                                </tr>
                                <tr>

                                    <td class="fw-semibold text-center py-3">Total</td>
                                    <td colspan="6"></td>
                                    <td class="fw-semibold">{{totals.craneTimesheet.billingHoursTotal}}</td>
                                    <td></td>
                                    <td class="fw-semibold">{{totals.craneTimesheet.billingHoursAmountTotal}}</td>
                                    <td class="fw-semibold">{{totals.craneTimesheet.extraHoursTotal}}</td>
                                    <td></td>
                                    <td class="fw-semibold">{{totals.craneTimesheet.extraHoursAmountTotal}}</td>
                                    <td class="fw-semibold" *ngIf="isTax">
                                        {{totals.craneTimesheet.timeSheetTaxTotal}}</td>
                                    <td class="fw-semibold">{{totals.craneTimesheet.timeSheetSubTotal}}</td>

                                </tr>


                            </tbody>
                        </table>
                    </div>

                </div>

                <div *ngIf="craneTabActiveIndex ==3 && this.craneCharges.selectedChargeList.length"
                    formGroupName="crane">
                    <!-- charges -->
                    <div class="d-flex justify-content-end p-3 pt-0 ">
                        <div class="col-lg-6 document-selected">
                        </div>
                        <div>
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openCraneAwpCharges('crane')">Manage</button>
                        </div>
                    </div>
                    <div class="addable-row-table m-1 mt-0 ws-nowrap">
                        <table>
                            <thead>
                                <tr>

                                    <th>SO No</th>
                                    <th>Job No</th>
                                    <th>Job Date</th>
                                    <th>Job Charges</th>
                                    <th>Vehicle No</th>
                                    <th>Charge Amount ({{currency_type?.symbol}})</th>
                                    <th *ngIf="isTax">Tax</th>
                                    <th>Total Amount ({{currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="charges">
                                <tr *ngFor="let charge of mechanicActivityForm.controls.crane.controls.charges.controls; let i = index;"
                                    [formGroupName]="i">

                                    <td class="py-3">{{charge.value.workorder_no ?charge.value.workorder_no:'-'}}
                                    </td>
                                    <td>{{charge.value.trip_id?charge.value.trip_id:'-'}}</td>
                                    <td> {{charge.value.date | formateDate}}</td>
                                    <td>{{charge.value.name?charge.value.name:'-'}}</td>
                                    <td>{{charge.value.vehicle_no?charge.value.vehicle_no:'-'}}</td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="amount" (change)="onCalcuationsChanged()">
                                    </td>
                                    <td *ngIf="isTax">
                                        <div >
                                            <material-dropdown [searchable]="true" [addable]="false"
                                                [selectedOption]="{label:charge.value.tax_label,value:''}"
                                                >
                                                <select #customSelect formControlName="tax"
                                                    (change)="taxValueChanged('crane',i);onCalcuationsChanged()">
                                                    <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                                        {{ option.label }}
                                                    </option>
                                                </select>
                                            </material-dropdown>
                                        </div>
                                    </td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="total" readonly>
                                    </td>

                                </tr>
                                <tr>
                                    <td class="py-3 fw-semibold">Total</td>
                                    <td colspan="4"></td>
                                    <td class="fw-semibold">{{totals.craneCharges.amountTotal}}</td>
                                    <td class="fw-semibold" *ngIf="isTax">{{totals.craneCharges.taxTotal}}</td>
                                    <td class="fw-semibold">{{totals.craneCharges.total}}</td>


                                </tr>
                            </tbody>
                        </table>
                    </div>


                </div>
                <div *ngIf="craneTabActiveIndex ==4 && this.craneDeductions.selectedDeductionList.length"
                    formGroupName="crane">
                    <div class="d-flex justify-content-end p-3 pt-0 ">
                        <div class="col-lg-6 document-selected">
                        </div>
                        <div>
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openCraneAwpDeductions('crane')">Manage</button>
                        </div>
                    </div>
                    <div class="addable-row-table m-1 mt-0 ws-nowrap ">
                        <table>
                            <thead>
                                <tr>

                                    <th>SO No.</th>
                                    <th>Job No.</th>
                                    <th>Job Date</th>
                                    <th>Job Deductions</th>
                                    <th>Vehicle No.</th>
                                    <th>Deductions Amount ({{currency_type?.symbol}})</th>
                                    <th>Total Amount ({{currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="deductions">
                                <tr *ngFor="let deductions of mechanicActivityForm.controls.crane.controls.deductions.controls; let i = index;"
                                    [formGroupName]="i">

                                    <td class="py-3">{{deductions.value.workorder_no
                                        ?deductions.value.workorder_no:'-'}}</td>
                                    <td>{{deductions.value.trip_id?deductions.value.trip_id:'-'}}</td>
                                    <td>{{deductions.value.date|formateDate }}</td>
                                    <td>{{deductions.value.name?deductions.value.name:'-'}}</td>
                                    <td>{{deductions.value.vehicle_no?deductions.value.vehicle_no:'-'}}</td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="amount" (change)="onCalcuationsChanged()">
                                    </td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="total" readonly>
                                    </td>

                                </tr>
                                <tr>
                                    <td class="py-3 fw-semibold">Total</td>
                                    <td colspan="4"></td>
                                    <td class="fw-semibold">{{totals.craneDeduction.amountTotal}}</td>
                                    <td class="fw-semibold">{{totals.craneDeduction.total}}</td>


                                </tr>

                            </tbody>
                        </table>
                    </div>


                </div>
            </mat-tab>

            <mat-tab *ngIf="isAWPDataAvailable">
                <ng-template mat-tab-label>
                    <span>Job for AWP</span>
                </ng-template>

                <div class="row mx-0  py-2">
                    <div class="col-lg-3 col-md-6 my-2 ">
                        <div class="box-tab" matRipple [matRippleDisabled]="awpTabActiveIndex==1"
                            (click)="awpTabActiveIndex=1" [ngClass]="{'active':awpTabActiveIndex==1}">
                            <b>Timesheets </b>
                            <ng-container *ngIf="awpTimeSheet.selectedSheetList.length==0">
                                <p *ngIf="awpTimeSheet.sheetList.length>0">Please select by clicking <span
                                        (click)="openCraneAwpTimeSheet('awp')" class="custom-link"
                                        [ngClass]="{'disable':awpTabActiveIndex!=1}"> here </span></p>
                                <p *ngIf="awpTimeSheet.sheetList.length==0">No Timesheets found.</p>
                            </ng-container>

                        </div>

                    </div>
                    <div class="col-lg-3 col-md-6 my-2">
                        <div class="box-tab" matRipple [matRippleDisabled]="awpTabActiveIndex==3"
                            (click)="awpTabActiveIndex=3" [ngClass]="{'active':awpTabActiveIndex==3}">
                            <b>Job Charge</b>
                            <ng-container *ngIf="awpCharges.selectedChargeList.length==0">
                                <p *ngIf="awpCharges.chargeList.length>0">Please select by clicking <span
                                        (click)="openCraneAwpCharges('awp')" class="custom-link"
                                        [ngClass]="{'disable':awpTabActiveIndex!=3}"> here </span></p>
                                <p *ngIf="awpCharges.chargeList.length==0">No Job Charges found.</p>
                            </ng-container>

                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 my-2 ">
                        <div class="box-tab" matRipple [matRippleDisabled]="awpTabActiveIndex==4"
                            (click)="awpTabActiveIndex=4" [ngClass]="{'active':awpTabActiveIndex==4}">
                            <b>Job Deduction</b>
                            <ng-container *ngIf="awpDeductions.selectedDeductionList.length==0">
                                <p *ngIf="awpDeductions.deductionList.length>0">Please select by clicking <span
                                        (click)="openCraneAwpDeductions('awp')" class="custom-link"
                                        [ngClass]="{'disable':awpTabActiveIndex!=4}"> here </span></p>
                                <p *ngIf="awpDeductions.deductionList.length==0">No Job Deductions found.</p>
                            </ng-container>
                        </div>
                    </div>
                </div>

                <div *ngIf="awpTabActiveIndex ==1 && this.awpTimeSheet.selectedSheetList.length" formGroupName="awp">


                    <div class="d-flex justify-content-between p-3 pt-0">
                        <div>

                            <div [ngClass]="{'hiddenContent':!isTax}" class="tabIndexActiveFields">
                                <div >
                                    <div class="tax-input-box ">
                                        <span for="">Tax</span>
                                        <material-dropdown 
                                            [selectedOption]="initialValues.awpTax">
                                            <select #customSelect class="no-style select--modify"
                                                formControlName="timesheet_tax" (change)="onSelectTimeSheetTax('awp')">
                                                <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                                    {{ option.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openCraneAwpTimeSheet('awp')">Manage</button>
                        </div>
                    </div>
                    <div class="addable-row-table m-1 mt-0 ws-nowrap">
                        <table>
                            <thead>
                                <tr>
                                    <th rowspan="2" class="border-start-0">
                                        Sales Order No.
                                    </th>
                                    <th rowspan="2">JOB NO. </th>
                                    <th rowspan="2">JOB Date. </th>
                                    <th rowspan="2">VEHICLE NO.</th>
                                    <th rowspan="2">Timesheet No.</th>
                                    <th rowspan="2">Start Date</th>
                                    <th rowspan="2">End Date</th>
                                    <th colspan="3" class="text-center">Billing Amount ({{currency_type?.symbol}})</th>
                                    <th colspan="3" class="text-center">Extra Amount ({{currency_type?.symbol}})</th>
                                    <th rowspan="2" *ngIf="isTax">Total Tax ({{currency_type?.symbol}})</th>
                                    <th rowspan="2">Total Amount ({{currency_type?.symbol}})</th>

                                </tr>
                                <tr>

                                    <th>Unit</th>
                                    <th>Rate per Unit ({{currency_type?.symbol}})</th>
                                    <th>Amount ({{currency_type?.symbol}})</th>
                                    <th>Unit</th>
                                    <th>Rate per Unit ({{currency_type?.symbol}})</th>
                                    <th>Amount ({{currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="timesheets">
                                <tr *ngFor="let timesheet of mechanicActivityForm.controls.awp.controls.timesheets.controls; let i = index;"
                                    [formGroupName]="i">

                                    <td class="py-3">{{timesheet.value.workorder_no
                                        ?timesheet.value.workorder_no:'-'}}</td>
                                    <td>{{timesheet.value.trip_id ?timesheet.value.trip_id:'-'}}</td>
                                    <td>{{timesheet.value?.date |formateDate }}</td>
                                    <td>{{timesheet.value?.vehicle_no ?timesheet.value?.vehicle_no:'-'}}</td>
                                    <td>{{timesheet.value?.timesheet_no ?timesheet.value?.timesheet_no:'-'}}</td>
                                    <td>{{timesheet.value?.start_date |formateDate }}</td>
                                    <td>{{timesheet.value?.end_date |formateDate }}</td>
                                    <td>{{timesheet.value?.billing_hours ?timesheet.value?.billing_hours:'0'}}</td>
                                    <td>{{timesheet.value?.billing_rate ?timesheet.value?.billing_rate:'0'}}</td>
                                    <td>{{timesheet.value?.billing_amount ?timesheet.value?.billing_amount:'0'}}
                                    </td>
                                    <td>{{timesheet.value?.extra_hours ?timesheet.value?.extra_hours:'0'}}</td>
                                    <td>{{timesheet.value?.extra_rate ?timesheet.value?.extra_rate:'0'}}</td>
                                    <td>{{timesheet.value?.extra_amount ?timesheet.value?.extra_amount:'0'}}</td>
                                    <td *ngIf="isTax">{{timesheet.value?.tax_amount
                                        ?timesheet.value?.tax_amount:'0'}}</td>
                                    <td>{{timesheet.value?.amount ?timesheet.value?.amount:'0'}}</td>
                                </tr>
                                <tr>

                                    <td class="fw-semibold text-center py-3">Total</td>
                                    <td colspan="6"></td>
                                    <td class="fw-semibold">{{totals.awpTimesheet.billingHoursTotal}}</td>
                                    <td></td>
                                    <td class="fw-semibold">{{totals.awpTimesheet.billingHoursAmountTotal}}</td>
                                    <td class="fw-semibold">{{totals.awpTimesheet.extraHoursTotal}}</td>
                                    <td></td>
                                    <td class="fw-semibold">{{totals.awpTimesheet.extraHoursAmountTotal}}</td>
                                    <td class="fw-semibold" *ngIf="isTax">{{totals.awpTimesheet.timeSheetTaxTotal}}
                                    </td>
                                    <td class="fw-semibold">{{totals.awpTimesheet.timeSheetSubTotal}}</td>

                                </tr>


                            </tbody>
                        </table>
                    </div>

                </div>

                <div>

                </div>

                <div *ngIf="awpTabActiveIndex ==3 && this.awpCharges.selectedChargeList.length" formGroupName="awp">


                    <!-- charges -->
                    <div class="d-flex justify-content-end p-3 pt-0 ">
                        <div class="col-lg-6 document-selected">
                        </div>
                        <div>
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openCraneAwpCharges('awp')">Manage</button>
                        </div>
                    </div>
                    <div class="addable-row-table m-1 mt-0 ws-nowrap">
                        <table>
                            <thead>
                                <tr>

                                    <th>SO No</th>
                                    <th>Job No</th>
                                    <th>Job Date</th>
                                    <th>Job Charges</th>
                                    <th>Vehicle No</th>
                                    <th>Charge Amount ({{currency_type?.symbol}})</th>
                                    <th *ngIf="isTax">Tax</th>
                                    <th>Total Amount ({{currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="charges">
                                <tr *ngFor="let charge of mechanicActivityForm.controls.awp.controls.charges.controls; let i = index;"
                                    [formGroupName]="i">

                                    <td class="py-3">{{charge.value.workorder_no ?charge.value.workorder_no:'-'}}
                                    </td>
                                    <td>{{charge.value.trip_id?charge.value.trip_id:'-'}}</td>
                                    <td>{{charge.value.date|formateDate }}</td>
                                    <td>{{charge.value.name?charge.value.name:'-'}}</td>
                                    <td>{{charge.value.vehicle_no?charge.value.vehicle_no:'-'}}</td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="amount" (change)="onCalcuationsChanged()">
                                    </td>
                                    <td *ngIf="isTax">
                                        <div >
                                            <material-dropdown [searchable]="true" [addable]="false"
                                                [selectedOption]="{label:charge.value.tax_label,value:''}"
                                               >
                                                <select #customSelect formControlName="tax"
                                                    (change)="taxValueChanged('awp',i); onCalcuationsChanged()">
                                                    <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                                        {{ option.label }}
                                                    </option>
                                                </select>
                                            </material-dropdown>
                                        </div>
                                    </td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="total" readonly>
                                    </td>

                                </tr>
                                <tr>
                                    <td class="py-3 fw-semibold">Total</td>
                                    <td colspan="4"></td>
                                    <td class="fw-semibold">{{totals.awpCharges.amountTotal}}</td>
                                    <td class="fw-semibold" *ngIf="isTax">{{totals.awpCharges.taxTotal}}</td>
                                    <td class="fw-semibold">{{totals.awpCharges.total}}</td>


                                </tr>
                            </tbody>
                        </table>
                    </div>


                </div>
                <div *ngIf="awpTabActiveIndex ==4 && this.awpDeductions.selectedDeductionList.length"
                    formGroupName="awp">
                    <!-- charges -->
                    <div class="d-flex justify-content-end p-3 pt-0 ">
                        <div class="col-lg-6 document-selected">
                        </div>

                        <div>
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openCraneAwpDeductions('awp')">Manage</button>
                        </div>
                    </div>
                    <div class="addable-row-table m-1 mt-0 ws-nowrap ">
                        <table>
                            <thead>
                                <tr>

                                    <th>SO No.</th>
                                    <th>Job No.</th>
                                    <th>Job Date</th>
                                    <th>Job Deductions</th>
                                    <th>Vehicle No.</th>
                                    <th>Deductions Amount ({{currency_type?.symbol}})</th>
                                    <th>Total Amount ({{currency_type?.symbol}})</th>
                                </tr>
                            </thead>
                            <tbody formArrayName="deductions">
                                <tr *ngFor="let deductions of mechanicActivityForm.controls.awp.controls.deductions.controls; let i = index;"
                                    [formGroupName]="i">

                                    <td class="py-3">{{deductions.value.workorder_no
                                        ?deductions.value.workorder_no:'-'}}</td>
                                    <td>{{deductions.value.trip_id?deductions.value.trip_id:'-'}}</td>
                                    <td>{{deductions.value.date|formateDate }}</td>
                                    <td>{{deductions.value.name?deductions.value.name:'-'}}</td>
                                    <td>{{deductions.value.vehicle_no?deductions.value.vehicle_no:'-'}}</td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="amount" (change)="onCalcuationsChanged()">
                                    </td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text" placeholder="1000"
                                            formControlName="total" readonly>
                                    </td>

                                </tr>
                                <tr>
                                    <td class="py-3 fw-semibold">Total</td>
                                    <td colspan="4"></td>
                                    <td class="fw-semibold">{{totals.awpDeduction.amountTotal}}</td>
                                    <td class="fw-semibold">{{totals.awpDeduction.total}}</td>


                                </tr>

                            </tbody>
                        </table>
                    </div>


                </div>
            </mat-tab>
            <mat-tab  *ngIf="isLooseCargoDataAvailable">
                <ng-template mat-tab-label>
                  <span >Job for Loose Cargo</span>
                </ng-template>
    
                <div class="row mx-0  py-2">
                  <div class="col-lg-3 col-md-6 my-2 ">
                    <div class="box-tab" matRipple [matRippleDisabled]="looseCargoTabActiveIndex==1" (click)="looseCargoTabActiveIndex=1" [ngClass]="{'active':looseCargoTabActiveIndex==1}">
                      <b>Jobs</b>
                      <ng-container>
                        <p  style="color: #B2B2B2;"  *ngIf="tripChallansListForLooseCargo.length == 0 && doTripChallanExistsForLoosecargo">You can select Jobs by clicking  <span (click)="openDescriptionPopupForLooseCargo()" class="custom-link">  here  </span></p>
                        <p style="color: #B2B2B2;"  *ngIf="!doTripChallanExistsForLoosecargo">No Jobs Completed for this Customer .</p>
                      </ng-container>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6 my-2">
                    <div class="box-tab" matRipple [matRippleDisabled]="looseCargoTabActiveIndex==3" (click)="looseCargoTabActiveIndex=3" [ngClass]="{'active':looseCargoTabActiveIndex==3}">
                      <b>Job Charge</b>
                      <ng-container *ngIf="looseCargoCharges.selectedChargeList.length==0">
                        <p *ngIf="looseCargoCharges.chargeList.length>0">Please select by clicking <span (click)="openCraneAwpCharges('cargo')" class="custom-link" [ngClass]="{'disable':looseCargoTabActiveIndex!=3}">  here  </span></p>
                        <p  *ngIf="looseCargoCharges.chargeList.length==0" >No Job Charges found.</p>
                      </ng-container>
                   
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6 my-2 ">
                    <div class="box-tab" matRipple [matRippleDisabled]="looseCargoTabActiveIndex==4" (click)="looseCargoTabActiveIndex=4" [ngClass]="{'active':looseCargoTabActiveIndex==4}">
                      <b>Job Deduction</b>
                      <ng-container *ngIf="looseCargoDeductions.selectedDeductionList.length==0" >
                        <p *ngIf="looseCargoDeductions.deductionList.length>0">Please select by clicking <span (click)="openCraneAwpDeductions('cargo')" class="custom-link" [ngClass]="{'disable':looseCargoTabActiveIndex!=4}">  here  </span></p>
                        <p  *ngIf="looseCargoDeductions.deductionList.length==0" >No Job Deductions found.</p>
                      </ng-container>
                    </div>
                  </div>
                </div>
                <div>
    
                </div> 
                <ng-container  *ngIf="looseCargoTabActiveIndex ==1 && tripChallansListForLooseCargo.length > 0" formGroupName="cargo">
                  <div class="row mx-0 p-3">
                    <div class="col-lg-4">
                      <div [ngClass]="{'hiddenContent':!isTax}" class="tabIndexActiveFields">
                        <div >
                          <div class="tax-input-box tax-input-box-big">
                            <span for="" class="ws-nowrap" style="padding: 13px 20px 10px 20px;">Tax on freights</span>
                          <material-dropdown 
                            [selectedOption]="tripChallanCommonTaxForLooseCargo">
                            <select #customSelect class="no-style select--modify" formControlName="trip_challan_tax" (change)="onSelectPopulateTaxForCargoAndContainer($event.target.value,'cargo')">
                              <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                {{ option.label }}
                              </option>
                            </select>
                          </material-dropdown>
                           
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6 document-selected" >
                       
                    </div>
                    <div class="col-md-2 ">
                     <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto" (click)="openManageDescriptionPopupForLooseCargo()">Manage</button>
                    </div>
                  </div>
                  <div class="addable-row-table m-1 mt-0 ws-nowrap" >
                    <table>
                        <thead>
                            <tr>
                             
                                <th  class="border-start-0" >
                                  SALES ORDER NO.
                                </th>
                                <th >JOB NO. DATE</th>
                                <th >JOB NO. </th>
                                <th >VEHICLE NO.</th>
                                <th >MARKET VEHICLE FREIGHT ({{currency_type?.symbol}})</th>
                                <th >TOTAL TAX ({{currency_type?.symbol}})</th>
                                <th >TOTAL AMOUNT ({{currency_type?.symbol}})</th>
        
                            </tr>
                        </thead>
                        <tbody formArrayName="trip_challan" >
                          <ng-container *ngFor="let challan of mechanicActivityForm.get('cargo').get('trip_challan').controls;let i_trip = index;"
                          [formGroupName]="i_trip">
                          <tr>
                            
                            <td class=" border-start-0 py-3">
                              
                              {{ challan.value?.work_order_no ?challan.value?.work_order_no :'-' }}
                              
                            </td>
                            <td>
                              {{ challan.value?.date }}                      
                            </td>
                            <td>{{challan.value?.trip_id?challan.value?.trip_id:'-' }}   </td>
                            <td>{{ challan.value?.vehicle }}</td>
                            <td >
                              <div class="d-flex justify-content-between align-items-center">{{ challan.value?.freights }}<button mat-icon-button class="ms-2 def-color">
                              <mat-icon class="fs-6 " (click)="editTripFreightForLooseCargo(challan.value?.trip,challan.value?.work_order_no)">create</mat-icon>
                            </button></div>
                          </td>
                     <td>{{ challan.value?.tax_amount }}</td>
                     <td>{{ challan.value?.total_amount }}</td>
                      </tr>
                      
                      
                    </ng-container>
                    <tr>
                     
                      <td class="fw-semibold border-start-0 py-3">Total</td>
                      <td colspan="3"></td>
                      <td class="fw-semibold">{{totals.looseCargo.freightTotal}}</td>
                      <td class="fw-semibold">{{totals.looseCargo.totaltax}}</td>
                      <td class="fw-semibold">{{totals.looseCargo.totalAmount}}</td>
                    </tr>
                   </tbody>
                    </table>
                </div>
      
                </ng-container>
                
                <div *ngIf="looseCargoTabActiveIndex ==3 && this.looseCargoCharges.selectedChargeList.length" formGroupName="cargo">
                 
    
                  <!-- charges -->
                  <div class="d-flex justify-content-end p-3 pt-0 ">
                    <div class="col-lg-6 document-selected" >
                    </div> 
                    <div >
                     <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto" (click)="openCraneAwpCharges('cargo')" >Manage</button>
                    </div>
                  </div>
                  <div class="addable-row-table m-1 mt-0 ws-nowrap" >
                    <table>
                        <thead>
                          <tr>
                            <th></th>
                         <th>SO No</th>
                         <th>Job No</th>
                         <th>Job Date</th>
                         <th>Job Charges</th>
                         <th>Vehicle No</th>
                         <th>Charge Amount ({{currency_type?.symbol}})</th>
                         <th *ngIf="isTax">Tax</th>
                         <th>Total Amount ({{currency_type?.symbol}})</th>
                        </tr>
                        </thead>
                        <tbody formArrayName="charges" >
                          <tr *ngFor="let charge of mechanicActivityForm.controls.cargo.controls.charges.controls; let i = index;" [formGroupName]="i">
                            <td class="p-0 border-end-0">
                            </td>
                          <td class="py-3">{{charge.value.workorder_no ?charge.value.workorder_no:'-'}}</td>
                          <td>{{charge.value.trip_id?charge.value.trip_id:'-'}}</td>
                          <td>{{charge.value.date|formateDate }}</td>
                          <td>{{charge.value.name?charge.value.name:'-'}}</td>        
                          <td>{{charge.value.vehicle_no?charge.value.vehicle_no:'-'}}</td>                 
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text"  placeholder="1000"
                            formControlName="amount" (change)="onCalcuationsChanged()">
                          </td>
                          <td *ngIf="isTax">
                            <div >
                                <material-dropdown [searchable]="true" [addable]="false" 
                                  [selectedOption]="{label:charge.value.tax_label,value:''}" >
                                  <select #customSelect formControlName="tax" 
                                    (change)="taxValueChanged('cargo',i); onCalcuationsChanged()">
                                    <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                      {{ option.label }}
                                    </option>
                                  </select>
                                </material-dropdown>
                            </div>
                          </td> 
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" 
                            formControlName="total" readonly>
                          </td>
                         
                        </tr>  
                        <tr>
                          <td class="py-3 fw-semibold">Total</td>
                          <td colspan="5"></td>
                          <td class="fw-semibold">{{totals.looseCargoCharges.amountTotal}}</td>
                          <td class="fw-semibold" *ngIf="isTax">{{totals.looseCargoCharges.taxTotal}}</td>
                          <td class="fw-semibold">{{totals.looseCargoCharges.total}}</td>
    
    
                        </tr>  
                   </tbody>
                    </table>
                </div>
                  
    
                </div>
                <div *ngIf="looseCargoTabActiveIndex ==4 && this.looseCargoDeductions.selectedDeductionList.length" formGroupName="cargo">
                  <!-- charges -->
                  <div class="d-flex justify-content-end p-3 pt-0 "> 
                    <div class="col-lg-6 document-selected" >
                    </div> 
    
                    <div >
                     <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto" (click)="openCraneAwpDeductions('cargo')" >Manage</button>
                    </div>
                  </div>
                  <div class="addable-row-table m-1 mt-0 ws-nowrap " >
                    <table>
                        <thead>
                          <tr>
                            <th></th>
                         <th>SO No.</th>
                         <th>Job No.</th>
                         <th>Job Date</th>
                         <th>Job Deductions</th>
                         <th>Vehicle No.</th>
                         <th>Deductions Amount ({{currency_type?.symbol}})</th>
                         <th>Total Amount ({{currency_type?.symbol}})</th>
                        </tr>
                        </thead>
                        <tbody formArrayName="deductions" >
                          <tr *ngFor="let deductions of mechanicActivityForm.controls.cargo.controls.deductions.controls; let i = index;" [formGroupName]="i">
                            <td class="p-0 border-end-0">
                            </td>
                          <td class="py-3">{{deductions.value.workorder_no ?deductions.value.workorder_no:'-'}}</td>
                          <td>{{deductions.value.trip_id?deductions.value.trip_id:'-'}}</td>
                          <td>{{deductions.value.date|formateDate }}</td>
                          <td>{{deductions.value.name?deductions.value.name:'-'}}</td>        
                          <td>{{deductions.value.vehicle_no?deductions.value.vehicle_no:'-'}}</td>                 
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text"  placeholder="1000"
                            formControlName="amount" (change)="onCalcuationsChanged()">
                          </td>
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" 
                            formControlName="total" readonly>
                          </td>
                         
                        </tr>   
                        <tr>
                          <td class="py-3 fw-semibold">Total</td>
                          <td colspan="5"></td>
                          <td class="fw-semibold">{{totals.looseCargoDeduction.amountTotal}}</td>
                         
                          
                          <td class="fw-semibold">{{totals.looseCargoDeduction.total}}</td>
    
    
                        </tr>  
                        
                   </tbody>
                    </table>
                </div>
                  
    
                </div>
            </mat-tab>
            <mat-tab  *ngIf="isContainerDataAvailable">
                <ng-template mat-tab-label>
                  <span >Job for Container</span>
                </ng-template>
    
                <div class="row mx-0  py-2">
                  <div class="col-lg-3 col-md-6 my-2 ">
                    <div class="box-tab" matRipple [matRippleDisabled]="containerTabActiveIndex==1" (click)="containerTabActiveIndex=1" [ngClass]="{'active':containerTabActiveIndex==1}">
                      <b>Jobs</b>
                      <ng-container>
                        <p  style="color: #B2B2B2;"  *ngIf="tripChallansListForContainer.length == 0 && doTripChallanExistsForContainer">You can select Jobs by clicking  <span (click)="openDescriptionPopupForContainer()" class="custom-link">  here  </span></p>
                        <p style="color: #B2B2B2;"  *ngIf="!doTripChallanExistsForContainer">No Jobs Completed for this Customer .</p>
                      </ng-container>
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6 my-2">
                    <div class="box-tab" matRipple [matRippleDisabled]="containerTabActiveIndex==3" (click)="containerTabActiveIndex=3" [ngClass]="{'active':containerTabActiveIndex==3}">
                      <b>Job Charge</b>
                      <ng-container *ngIf="containerCharges.selectedChargeList.length==0">
                        <p *ngIf="containerCharges.chargeList.length>0">Please select by clicking <span (click)="openCraneAwpCharges('container')" class="custom-link" [ngClass]="{'disable':containerTabActiveIndex!=3}">  here  </span></p>
                        <p  *ngIf="containerCharges.chargeList.length==0" >No Job Charges found.</p>
                      </ng-container>
                   
                    </div>
                  </div>
                  <div class="col-lg-3 col-md-6 my-2 ">
                    <div class="box-tab" matRipple [matRippleDisabled]="containerTabActiveIndex==4" (click)="containerTabActiveIndex=4" [ngClass]="{'active':containerTabActiveIndex==4}">
                      <b>Job Deduction</b>
                      <ng-container *ngIf="containerDeductions.selectedDeductionList.length==0" >
                        <p *ngIf="containerDeductions.deductionList.length>0">Please select by clicking <span (click)="openCraneAwpDeductions('container')" class="custom-link" [ngClass]="{'disable':containerTabActiveIndex!=4}">  here  </span></p>
                        <p  *ngIf="containerDeductions.deductionList.length==0" >No Job Deductions found.</p>
                      </ng-container>
                    </div>
                  </div>
                </div>
                <div>
    
                </div> 
                <ng-container  *ngIf="containerTabActiveIndex ==1 && tripChallansListForContainer.length > 0" formGroupName="container">
                  <div class="row mx-0 p-3">
                    <div class="col-lg-4">
                      <div [ngClass]="{'hiddenContent':!isTax}" class="tabIndexActiveFields">
                        <div >
                          <div class="tax-input-box tax-input-box-big">
                            <span for="" class="ws-nowrap" style="padding: 13px 20px 10px 20px;">Tax on freights</span>
                          <material-dropdown 
                            [selectedOption]="tripChallanCommonTaxForContainer">
                            <select #customSelect class="no-style select--modify" formControlName="trip_challan_tax" (change)="onSelectPopulateTaxForCargoAndContainer($event.target.value,'container')">
                              <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                {{ option.label }}
                              </option>
                            </select>
                          </material-dropdown>
                           
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-6 document-selected" >
                       
                    </div>
                    <div class="col-md-2 ">
                     <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto" (click)="openManageDescriptionPopupForContainer()">Manage</button>
                    </div>
                  </div>
                  <div class="addable-row-table m-1 mt-0 ws-nowrap" >
                    <table>
                        <thead>
                            <tr>
                             
                                <th  class="border-start-0" >
                                  SALES ORDER NO.
                                </th>
                                <th >JOB NO. DATE</th>
                                <th >JOB NO. </th>
                                <th >VEHICLE NO.</th>
                                <th >MARKET VEHICLE FREIGHT ({{currency_type?.symbol}})</th>
                                <th >TOTAL TAX ({{currency_type?.symbol}})</th>
                                <th >TOTAL AMOUNT ({{currency_type?.symbol}})</th>
        
                            </tr>
                        </thead>
                        <tbody formArrayName="trip_challan" >
                          <ng-container *ngFor="let challan of mechanicActivityForm.get('container').get('trip_challan').controls;let i_trip = index;"
                          [formGroupName]="i_trip">
                          <tr>
                            
                            <td class=" border-start-0 py-3">
                              
                              {{ challan.value?.work_order_no ?challan.value?.work_order_no :'-' }}
                              
                            </td>
                            <td>
                              {{ challan.value?.date }}                      
                            </td>
                            <td>{{challan.value?.trip_id?challan.value?.trip_id:'-' }}   </td>
                            <td>{{ challan.value?.vehicle }}</td>
                            <td >
                              <div class="d-flex justify-content-between align-items-center">{{ challan.value?.freights }} 
                                <!-- <button mat-icon-button class="ms-2 def-color">
                                  <mat-icon class="fs-6 " (click)="editTripFreightForLooseCargo(challan.value?.trip,challan.value?.work_order_no)">create</mat-icon>
                                </button> -->
                              </div>
                          </td>
                     <td>{{ challan.value?.tax_amount }}</td>
                     <td>{{ challan.value?.total_amount }}</td>
                      </tr>
                      
                      
                    </ng-container>
                    <tr>
                     
                      <td class="fw-semibold border-start-0 py-3">Total</td>
                      <td colspan="3"></td>
                      <td class="fw-semibold">{{totals.container.freightTotal}}</td>
                      <td class="fw-semibold">{{totals.container.totaltax}}</td>
                      <td class="fw-semibold">{{totals.container.totalAmount}}</td>
                    </tr>
                   </tbody>
                    </table>
                </div>
      
                </ng-container>
                
                <div *ngIf="containerTabActiveIndex ==3 && this.containerCharges.selectedChargeList.length" formGroupName="container">
                 
    
                  <!-- charges -->
                  <div class="d-flex justify-content-end p-3 pt-0 ">
                    <div class="col-lg-6 document-selected" >
                    </div> 
                    <div >
                     <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto" (click)="openCraneAwpCharges('container')" >Manage</button>
                    </div>
                  </div>
                  <div class="addable-row-table m-1 mt-0 ws-nowrap" >
                    <table>
                        <thead>
                          <tr>
                            <th></th>
                         <th>SO No</th>
                         <th>Job No</th>
                         <th>Job Date</th>
                         <th>Job Charges</th>
                         <th>Vehicle No</th>
                         <th>Charge Amount ({{currency_type?.symbol}})</th>
                         <th *ngIf="isTax">Tax</th>
                         <th>Total Amount ({{currency_type?.symbol}})</th>
                        </tr>
                        </thead>
                        <tbody formArrayName="charges" >
                          <tr *ngFor="let charge of mechanicActivityForm.controls.container.controls.charges.controls; let i = index;" [formGroupName]="i">
                            <td class="p-0 border-end-0">
                            </td>
                          <td class="py-3">{{charge.value.workorder_no ?charge.value.workorder_no:'-'}}</td>
                          <td>{{charge.value.trip_id?charge.value.trip_id:'-'}}</td>
                          <td>{{charge.value.date|formateDate }}</td>
                          <td>{{charge.value.name?charge.value.name:'-'}}</td>        
                          <td>{{charge.value.vehicle_no?charge.value.vehicle_no:'-'}}</td>                 
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text"  placeholder="1000"
                            formControlName="amount" (change)="onCalcuationsChanged()">
                          </td>
                          <td *ngIf="isTax">
                            <div >
                                <material-dropdown [searchable]="true" [addable]="false" 
                                  [selectedOption]="{label:charge.value.tax_label,value:''}" >
                                  <select #customSelect formControlName="tax" 
                                    (change)="taxValueChanged('container',i); onCalcuationsChanged()">
                                    <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                      {{ option.label }}
                                    </option>
                                  </select>
                                </material-dropdown>
                            </div>
                          </td> 
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" 
                            formControlName="total" readonly>
                          </td>
                         
                        </tr>  
                        <tr>
                          <td class="py-3 fw-semibold">Total</td>
                          <td colspan="5"></td>
                          <td class="fw-semibold">{{totals.containerCharges.amountTotal}}</td>
                          <td class="fw-semibold" *ngIf="isTax">{{totals.containerCharges.taxTotal}}</td>
                          <td class="fw-semibold">{{totals.containerCharges.total}}</td>
                        </tr>  
                   </tbody>
                    </table>
                </div>
                  
    
                </div>
                <div *ngIf="containerTabActiveIndex ==4 && this.containerDeductions.selectedDeductionList.length" formGroupName="container">
                  <!-- charges -->
                  <div class="d-flex justify-content-end p-3 pt-0 "> 
                    <div class="col-lg-6 document-selected" >
                    </div> 
    
                    <div >
                     <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto" (click)="openCraneAwpDeductions('container')" >Manage</button>
                    </div>
                  </div>
                  <div class="addable-row-table m-1 mt-0 ws-nowrap " >
                    <table>
                        <thead>
                          <tr>
                            <th></th>
                         <th>SO No.</th>
                         <th>Job No.</th>
                         <th>Job Date</th>
                         <th>Job Deductions</th>
                         <th>Vehicle No.</th>
                         <th>Deductions Amount ({{currency_type?.symbol}})</th>
                         <th>Total Amount ({{currency_type?.symbol}})</th>
                        </tr>
                        </thead>
                        <tbody formArrayName="deductions" >
                          <tr *ngFor="let deductions of mechanicActivityForm.controls.container.controls.deductions.controls; let i = index;" [formGroupName]="i">
                            <td class="p-0 border-end-0">
                            </td>
                          <td class="py-3">{{deductions.value.workorder_no ?deductions.value.workorder_no:'-'}}</td>
                          <td>{{deductions.value.trip_id?deductions.value.trip_id:'-'}}</td>
                          <td>{{deductions.value.date|formateDate }}</td>
                          <td>{{deductions.value.name?deductions.value.name:'-'}}</td>        
                          <td>{{deductions.value.vehicle_no?deductions.value.vehicle_no:'-'}}</td>                 
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text"  placeholder="1000"
                            formControlName="amount" (change)="onCalcuationsChanged()">
                          </td>
                          <td>
                            <input positiveThreeDigitDecimalNumber type="text" placeholder="1000" 
                            formControlName="total" readonly>
                          </td>
                         
                        </tr>   
                        <tr>
                          <td class="py-3 fw-semibold">Total</td>
                          <td colspan="5"></td>
                          <td class="fw-semibold">{{totals.containerDeduction.amountTotal}}</td>
                         
                          
                          <td class="fw-semibold">{{totals.containerDeduction.total}}</td>
    
    
                        </tr>  
                        
                   </tbody>
                    </table>
                </div>
                  
    
                </div>
            </mat-tab>
            <mat-tab *ngIf="isOthersDataAvailable">
                <ng-template mat-tab-label>
                    <span>Job for Loose Cargo</span>
                </ng-template>
                <ng-container *ngIf="tripChallansList.length > 0" formGroupName="others">
                    <div class="row mx-0 p-3">
                        <div class="col-lg-4">
                            <div [ngClass]="{'hiddenContent':!isTax}" class="tabIndexActiveFields">
                              <div >
                                <div class="tax-input-box tax-input-box-big">
                                  <span for="" class="ws-nowrap" style="padding: 13px 20px 10px 20px;">Tax on freights</span>
                                <material-dropdown 
                                  [selectedOption]="itemChallanCommonTax">
                                  <select #customSelect class="no-style select--modify" formControlName="trip_challan_tax" (change)="onSelectPopulateTax($event.target.value,'cargo')">
                                    <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                      {{ option.label }}
                                    </option>
                                  </select>
                                </material-dropdown>
                                 
                                </div>
                              </div>
                            </div>
                          </div>
                        <div class="col-lg-6"></div>
                        <div class="col-md-2 ">
                            <button class="gb-edit-btn-secondary ps-3 w-auto ms-auto"
                                (click)="openManageDescriptionPopup()">Manage</button>
                        </div>
                    </div>
                    <div *ngIf="tripChallansList.length > 0">
                        <div class="addable-row-table m-1 mt-0">
                            <table class="table-container">
                                <thead>
                                    <tr class="desktop_th">
                                        <th rowspan="2" width=10%>Date</th>
                                        <th rowspan="2" width=10%>Vehicle No.</th>
                                        <th rowspan="2" *ngIf="!isWOEmpty">Work Order No.</th>
                                        <th rowspan="2">FREIGHT ({{currency_type.symbol}})</th>
                                        <th colspan="2" class="text-center">JOB CHARGES ({{currency_type.symbol}})</th>
                                        <th rowspan="2" class="text-center">JOB DEDUCTION ({{currency_type.symbol}})</th>
                                        <th rowspan="2"  width=10% [ngClass]="{'hiddenContent':!isTax}">Total Tax ({{currency_type.symbol}})</th>
                                        <th rowspan="2" width=10%>Total Amount ({{currency_type?.symbol}})</th>
                                    </tr>
                                    <tr>
                       
                                        <th>TAX APPLICABLE</th>
                                        <th>TAX NOT APPLICABLE</th>    
                                      </tr>
                                </thead>
                                <tbody formArrayName="trip_challan">
                                    <tr class="mobile-flex icon-14"
                                        *ngFor="let challan of mechanicActivityForm.get('others').get('trip_challan').controls;let i_trip = index;"
                                        [formGroupName]="i_trip">
                                        <td class="max-wd120 ">
                                            <h5 class="th_h5_mobile">Date</h5>
                                            <div> {{ challan.value?.date }}</div>
                                        </td>
                                        <td class="max-wd120 ">
                                            <h5 class="th_h5_mobile">Vehicle No.</h5>
                                            <div>{{ challan.value?.vehicle }}</div>
                                        </td>
                                        <td class="max-wd120 " *ngIf="!isWOEmpty">
                                            <h5 class="th_h5_mobile">Work Order No.</h5>
                                            <div>{{ challan.value?.work_order_no }}</div>
                                        </td>
                                        <td>
                                            <div class="d-flex justify-content-between align-items-center">{{ challan.value?.freights }}<button mat-icon-button
                                                class="ms-2">
                                                <mat-icon class="fs-6 "
                                                  (click)="editTripFreight(challan.value?.trip)">create</mat-icon>
                                              </button></div>
                                          </td>
                                          <td>
                                            <div class="d-flex justify-content-between align-items-center">{{ challan.value?.charges_wt_tax }}<button
                                                mat-icon-button class="ms-2">
                                                <mat-icon class="fs-6 " (click)="editTripAddBillCharges(challan.value?.trip)">create</mat-icon>
                                              </button></div>
                                          </td>
                                          <td>
                                            <div class="d-flex justify-content-between align-items-center">{{ challan.value?.charges_wo_tax }}<button
                                                mat-icon-button class="ms-2">
                                                <mat-icon class="fs-6 " (click)="editTripAddBillCharges(challan.value?.trip)">create</mat-icon>
                                              </button></div>
                                          <td>
                                            <div class="d-flex justify-content-between align-items-center">{{ challan.value?.deductions }}<button
                                                mat-icon-button class="ms-2">
                                                <mat-icon class="fs-6 " (click)="editTripReduceBillCharges(challan.value?.trip)">create</mat-icon>
                                              </button></div>
                                          </td>
                                        <td *ngIf="isTax">{{ challan.value?.tax_amount }}</td>



                                        <td class="max-wd-120 align-middle ">
                                            <h5 class="th_h5_mobile">Total </h5>
                                            <div>{{
                                                challan.value.total
                                                }} </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-semibold border-start-0 py-3">Total</td>
                                        <td></td>
                                        <td *ngIf="!isWOEmpty"></td>
                                        <td class="fw-semibold">{{totals.others.freightTotal}}</td>
                                        <td class="fw-semibold">{{totals.others.chargesWttax}}</td>
                                        <td class="fw-semibold">{{totals.others.chargesWotax}}</td>
                                        <td class="fw-semibold">{{totals.others.deduction}}</td>
                                        <td class="fw-semibold" *ngIf="isTax">{{totals.others.totaltax}}</td>
                                        <td class="fw-semibold">{{totals.others.totalAmount}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="tripChallansList.length == 0 && doTripChallanExists">
                    <div class="p-5 d-flex justify-content-center align-items-center">
                        <p class="m-4 fs-6" style="color: #B2B2B2;">You can select Job for Others by clicking <span
                                (click)="openDescriptionPopup()" class="custom-link"> here </span></p>
                    </div>
                </ng-container>
                <ng-container *ngIf="!doTripChallanExists">
                    <div class="p-5 d-flex justify-content-center align-items-center">
                        <p class="m-4 fs-6" style="color: #B2B2B2;">No Jobs Completed in Others category for this
                            Vendor .</p>
                    </div>
                </ng-container>


            </mat-tab>

            <mat-tab>
                <ng-template mat-tab-label>
                    <span>Additional Charges</span>
                </ng-template>
                <div>
                    <div class="addable-row-table m-1 mx-2">
                        <table class="table-container">
                            <thead>
                                <tr class="desktop_th">
                                    <th width=15%>Additional Charge</th>
                                    <th width=15%>Expense Account</th>
                                    <th width=7%>Unit of Measurement</th>
                                    <th width=13%>Quantity</th>
                                    <th width=9%>Unit Cost ({{ currency_type?.symbol}})</th>
                                    <th width=7% [ngClass]="{'d-none':!isTax}">Amount ({{
                                        currency_type?.symbol}})</th>
                                    <th width=7% [ngClass]="{'d-none':!isTax}">Tax</th>
                                    <th width=11%>Total Amount ({{ currency_type?.symbol}})</th>
                                    <th width=9%></th>
                                </tr>
                            </thead>
                            <tbody formArrayName="other_expenses">
                                <tr class="mobile-flex"
                                    *ngFor="let otherItem of mechanicActivityForm.controls.other_expenses.controls; let i = index;"
                                    [formGroupName]="i">
                                    <td>
                                        <material-dropdown [searchable]="true" [addable]="true" class="dropDownWidth" [addBlank]="false"
                                        [addErrorClass]="addErrorClass(otherItem.controls.item)" [maxLength]="20"
                                        [selectedOption]="initialValues?.item[i]" [addNewOptions]="true"
                                        (addNewOption)="addNewAdditionalCharge($event,i)">
                                        <select #customSelect formControlName="item" class="no-style select--modify" (change)="onChangeOtherExpenseItem(i)">
                                            <option *ngFor="let option of staticOptions.materialList" value="{{ option?.id }}">
                                                {{ option.name }}
                                            </option>
                                        </select>
                                      </material-dropdown>
                                    </td>
                                    <td>


                                        <material-dropdown [searchable]="true" [addable]="true" class="dropDownWidth"
                                            [chartOfAccount]="true" (addChartOfAccount)="openAddCoaModal($event, i)"
                                            [params]="coaParams" (addValueToList)="addParamsCoaItem($event)"
                                            [addErrorClass]="addErrorClass(otherItem.controls.expense_account)"
                                            [selectedOption]="initialValues.expenseAccount[i]">
                                            <select #customSelect formControlName="expense_account"
                                                class="no-style select--modify">
                                                <option *ngFor="let account of accountList" value="{{ account.id }}">
                                                    {{ account.name }}</option>
                                            </select>
                                        </material-dropdown>

                                    </td>
                                    <td>

                                        <material-dropdown [searchable]="true" [addable]="false" [addBlank]="true"
                                            class="dropDownWidth"
                                            [addErrorClass]="addErrorClass(otherItem.controls.unit)"
                                            [selectedOption]="initialValues.units[i]">
                                            <select #customSelect formControlName="unit"
                                                class="no-style select--modify">
                                                <option *ngFor="let option of staticOptions.itemUnits"
                                                    value="{{ option.id }}">
                                                    {{ option.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>

                                    </td>
                                    <td>


                                        <input positiveThreeDigitDecimalNumber type="text" class="error-box"
                                            [ngClass]="addErrorClass(otherItem.controls.quantity)"
                                            placeholder="Eg.: 1234567" formControlName="quantity"
                                            (change)="calculateItemOthersAmount(i)">


                                    </td>
                                    <td>
                                        <input positiveThreeDigitDecimalNumber type="text"
                                            [ngClass]="addErrorClass(otherItem.controls.unit_cost)" placeholder="1000"
                                            formControlName="unit_cost" (change)="calculateItemOthersAmount(i)">


                                    </td>
                                    <td [ngClass]="{'d-none':!isTax}">



                                        <input positiveThreeDigitDecimalNumber type="text" readonly placeholder="1000"
                                            formControlName="total_before_tax" (change)="calculateItemOther(i)"
                                            [ngClass]="addErrorClass(otherItem.controls.total_before_tax)">

                                    </td>
                                    <td [ngClass]="{'d-none':!isTax}">

                                        <div [ngClass]="{disable:disableTax || !companyRegistered}">

                                            <material-dropdown [searchable]="true" [addable]="false"
                                                [selectedOption]="initialValues.taxPercent[i]" class="dropDownWidth"
                                                [disabled]="disableTax || !companyRegistered"
                                                [ngClass]="addErrorClass(mechanicActivityForm.controls['other_expenses'].controls[i].controls.tax)">
                                                <select #customSelect formControlName="tax"
                                                    class="no-style select--modify" (change)="onCalcuationsChanged()">
                                                    <option *ngFor="let option of taxOptions" value="{{ option.id }}">
                                                        {{ option.label }}
                                                    </option>
                                                </select>
                                            </material-dropdown>
                                            <app-error
                                                [controlName]="mechanicActivityForm.controls['other_expenses'].controls[i].controls.tax">
                                            </app-error>

                                        </div>
                                    </td>
                                    <td>
                                        <input type="number" readonly placeholder="1000" formControlName="total" />

                                    </td>
                                    <td class="rc-row-btn-wrap border-start-0 border-end-0">
                                        <div class="d-flex ">
                                            <button (click)="removeOtherItem(i)"
                                                *ngIf="mechanicActivityForm.controls.other_expenses.controls.length !== 1"
                                                class="  row-btn row-btn-delete "><span class="material-icons">
                                                    close</span></button>

                                            <button (click)="addMoreOtherItem()"
                                                *ngIf="mechanicActivityForm.controls.other_expenses.controls.length - 1 == i"
                                                class="  row-btn row-btn-add "><span class="material-icons">
                                                    add
                                                </span></button>
                                        </div>


                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-3 fw-semibold">Total</td>
                                    <td colspan="4"></td>
                                    <td class="fw-semibold" *ngIf="isTax">{{totals.itemOther.amountTotal}}</td>
                                    <td *ngIf="isTax" class="fw-semibold" > {{totals.itemOther.taxTotal}}</td>
                                    <td class="fw-semibold">{{totals.itemOther.total}}</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mx-2 my-3">
                        <a class="custom-link" (click)="clearAllOtherItems()">Remove all</a>
                    </div>
                </div>

            </mat-tab>
        </mat-tab-group>
    </div>
    <div class="row mx-0 def-color">
        <div class="col-lg-7 px-0">
            <div class="gb-fake-tab-wrapper">
                <span>Payment info</span>
            </div>
            <div class="px-2">
            <app-payment-status [vendorId]="mechanicActivityForm.get('vendor').value" [balanceAmount]="totals.balance"
                [billDate]="mechanicActivityForm.get('bill_date').value" [vendorList]="vendorList"
                [$paymentStatusValid]="$paymentStatusValid" [editPayemntStatusData]="fleetExpenseEditdata"
                (paymentStatusData)="paymentStatusData($event)" [customerId]="customerId"> </app-payment-status>
            <div class="row mx-0">
                <div class="col-lg-3 col-md-6">
                    <div class="input-wrap">
                        <label for="">Remind Date</label>
                        <mat-form-field>
                            <input matInput [matDatepicker]="reminder" formControlName="reminder"
                                (focus)="reminder.open()" placeholder="DD/MM/YYYY">
                            <mat-datepicker-toggle matSuffix [for]="reminder"></mat-datepicker-toggle>
                            <mat-datepicker #reminder></mat-datepicker>
                        </mat-form-field>
                        <span class="error-message">Error messge!</span>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="input-wrap ">
                        <label for="" class="">Optional Comment</label>
                        <input type="text" class="no-style input--bd" placeholder="Comments" formControlName="comments">
                    </div>
                </div>

            </div>

            <div class="mx-2">
                <file-uploader (onFileUploaded)="fileUploader($event)" (onFileDeleted)="fileDeleted($event)"
                    [multiple]="true" [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'"
                    [showFileName]="false" [patchFileUrls]="patchFileUrls">
                </file-uploader>
            </div>
        </div>
        </div>
        <div class="col-lg-5 px-0 balance-block">
            <div class="gb-fake-tab-wrapper">
                <span>Purchase Amount</span>
            </div>
            <div class="gst-table-wrapper  p-4 pb-0">
                <div class="d-flex fw-semibold justify-content-between align-items-center mb-3">
                    <span class=" me-5">Subtotal:</span>
                    <span>{{ currency_type?.symbol}} {{ totals.subtotal|numberFormat }}</span>
                </div>
                <div class="d-flex fw-semibold justify-content-between align-items-center mb-3" *ngIf="isTax">
                    <span class=" me-5">Tax Amount:</span>
                    <span>{{ currency_type?.symbol}} {{ totals.taxTotal |numberFormat}}</span>
                </div>
                <div class="gst-main" [ngClass]="{'hiddenContent':!isTax}"
                    *ngFor="let percentageTotal of    totals.taxes;">
                    <ng-container *ngIf="percentageTotal.total && percentageTotal.taxAmount>0">
                        <div class="text-end gst-left"> Include {{terminology.tax_type}} &#64; {{ percentageTotal.value }}%
                            on
                            <span>{{ percentageTotal.total |numberFormat}}</span>
                        </div>
                        <div class="px-0  text-end gst-right">{{ currency_type?.symbol}} {{ percentageTotal.taxAmount|numberFormat }}
                        </div>
                    </ng-container>
                </div>
                <div [ngClass]="{'hiddenContent':!isTax}" class="gst-main">
                    <div class=" text-end p-0 " >
                        <span class="fw-bold p-0">Discount after Tax </span>
                        <div [ngClass]="addErrorClass(mechanicActivityForm.controls.discount_after_tax)" class="input"
                            >
                            <input positiveThreeDigitDecimalNumber type="text" class="error-box" placeholder="0.00"
                                formControlName="discount_after_tax"
                                (change)="onCalcuationsChanged()">
                        </div>
                        <div class="select-wrap dropdown">
                            <select name="" class="no-style select--modify custom-select"
                                formControlName="discount_after_tax_type" (change)="onCalcuationsChanged()">
                                <option value="0">%</option>
                                <option value="1">{{ currency_type?.symbol}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="px-0 gst-right text-end fw-bold">{{ currency_type?.symbol}} {{
                        totals.discountAfterTaxTotal |numberFormat}}</div>
                </div>

                <div class="d-flex fw-semibold justify-content-between align-items-center mb-3">
                    <span class=" me-5">Total: </span>
                    <span>{{ currency_type?.symbol}} {{ totals.total |numberFormat}}</span>
                </div>
                <div class="gst-main fw-bold justify-content-between" [ngClass]="{'hiddenContent':!isTax||isTds}">
                    <div class="text-end pt-0 ">
                        <app-last-section-inputfield-box [lastSectionTaxDetails]="lastSectionTaxDetails"
                            [lastSectionEditData]="lastSectionEditData"
                            (lastSectionOutPut)="lastSectionOutPut($event)"></app-last-section-inputfield-box>
                    </div>
                    <div class=""> {{ currency_type?.symbol}} {{ totals.tdsAmount }}</div>
                </div>

                <div class="text-end gst-main my-3 justify-content-between">
                    <div class="text-end h5"><strong>Balance:</strong></div>
                    <div class="px-0 text-end ms-3 h5"> <strong>{{ currency_type?.symbol}} {{ totals.balance |numberFormat}}
                        </strong></div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">

        <button class="btn me-2 btn--sm" [routerLink]="[prefixUrl+'/trip/vehicle-payment/list']"
            routerLinkActive="active">Cancel</button>
        <button class="btn btn--primary" (click)="saveExpense()">{{fleetExpenseId?'Update':'Save'}} Expense</button>

    </div>
</form>

<add-new-coa [popDetail]="showAddCoaPopup" [isExpenseType]="true" (closeModal)="closeCoaPopup" (coaAdded)="addExpenseToOption($event)">
</add-new-coa>
<!-- for loose cargo -->
<app-trip-challan     [isFleetExpenseScreen]="false" [isTripChallanListForCargo]="true" paramsCategory = "cargo" [tripId]="tripId" [openDescription]="openDescriptionForLooseCargo" [openManageDescription]="openManageDescriptionForLooseCargo" [showManageDiscription]="false" [showDocument]="false" [alreadySelectedTripChallans]="tripChallansListForLooseCargo"
[inlineAdd]="tripChallanModelInlineForLooseCargo" [isAdd]="isTripAdd" (checkChallanExistForLooseCargo)="checkTripChallanExistForLooseCargo($event)"
(onAddChallanClickedForLooseCargo)="tripChallansForLooseCargoSelected($event)" ></app-trip-challan>
<!-- for container -->
<app-trip-challan     [isFleetExpenseScreen]="false" [isTripChallanListForCargo]="true" paramsCategory = "container" [tripId]="tripId" [openDescription]="openDescriptionForContainer" [openManageDescription]="openManageDescriptionForContainer" [showManageDiscription]="false" [showDocument]="false" [alreadySelectedTripChallans]="tripChallansListForContainer"
[inlineAdd]="tripChallanModelInlineForContainer" [isAdd]="isTripAdd" (checkChallanExistForContainer)="checkTripChallanExistForContainer($event)"
(onAddChallanClickedForContainer)="tripChallansForContainerSelected($event)" ></app-trip-challan>

<app-edit-trip-new-pop-up (dataFromEdit)="completeFReightEditcargo($event)" [showEditPopup]="showFreightPopupForLooseCargo" [isAddExpense]="isAddExpense"
*ngIf="showFreightPopupForLooseCargo.show"></app-edit-trip-new-pop-up>

<!-- Popup for adding party details -->
<app-add-party-popup [popDetail]="showAddVendorPopup" vendorPartyType="2" (closeModal)="closePartyPopup()"
    (partyAdded)="addPartyToOption($event)" [isVendor]="true"></app-add-party-popup>

<app-charges-popup (dataFromEdit)="editCompleteTripCharges($event)" [isAddExpense]="isAddExpense"
    [showChargesPopup]="showChargesPopup" [updateCharges]="true" *ngIf="showChargesPopup.show"></app-charges-popup>
<app-edit-trip-new-pop-up (dataFromEdit)="editCompleteTripFreight($event)" [isAddExpense]="isAddExpense"
    [showEditPopup]="showFreightPopup" *ngIf="showFreightPopup.show"></app-edit-trip-new-pop-up>
<app-trip-challan [showManageDiscription]="false" [openDescription]="openDescription"
    [openManageDescription]="openManageDescription" [alreadySelectedTripChallans]="tripChallansList"
    [inlineAdd]="tripChallanModelInline" [isAdd]="isTripAdd" (onAddChallanClicked)="tripChallansSelected($event)"
    [isFleetExpenseScreen]="true"  [isTripChallanListForCargo]="false"
    (checkChallanExist)="checkTripChallanExist($event)"></app-trip-challan>

<app-go-through [goThroughDetais]="goThroughDetais"></app-go-through>