<div class="plwrap" *ngIf="profitLossDataObj | async as profitLossData">
  <div class="p-4 px-5 border-bottom border-2" [ngStyle]="{'background-color': isVoid ? '#e97a7a5e' : 'initial'}">
    <!-- revenue-section -->
    <div class="d-flex mb-4 pt-3 justify-content-between align-items-center">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between ">

        <p class=" label green-label fs-6">Revenue (Pre-Tax) <span *ngIf="isVoid" class="dark"> (Job is Void)</span></p>
        <p class="label green-label fs-6">{{ profitLossData?.revenue.total | numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between"></div>
    </div>


    <!--         client frieght -->
   <ng-container *ngIf="!profitLossData?.revenue?.consideration?.show">
    <div class="d-flex mb-3 justify-content-between" *ngFor="let data of profitLossData?.revenue?.client_freight">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class=" label ">Client Freight </p>


        <p class="label">{{ data?.freight_amount | numberFormat}} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" [disabled]="!data.is_editable_deletable || headerData['approval_status']['status_screen_to_show'] ==='Completed'" *ngxPermissionsOnly="[trip[1]]"
        [routerLink]="[prefixUrl+'/trip/new-trip/edit/',tripId]">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <!-- <button class="del-btn"><i class="material-icons  text-danger">delete</i></button> -->
      </div>
    </div>
   </ng-container>
   
     <div class="d-flex mb-3 justify-content-between" *ngIf="profitLossData?.revenue?.consideration?.show">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class="label ">Consideration Amount</p>
        <div class="custom-box-input-wrap px-1" *ngIf="!considerationEdit">
          <input type="text" positivethreedigitdecimalnumber="" placeholder="Consideration Amount" [(ngModel)]="considerationAmountValue" class="box-input">
        </div>
        <p class="label" *ngIf="considerationEdit">{{ profitLossData?.revenue?.consideration?.amount | numberFormat}} {{ currency_type?.symbol}}</p>
      </div>
      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" *ngIf="considerationEdit" (click)="considerationEdit=false">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="edit-btn me-2" (click)="considerationAmount()" *ngIf="!considerationEdit">
          Update
        </button>
      </div>
    </div>
   

    
    

     <!--         Rental Charge -->

     <div class="d-flex mb-3 justify-content-between" *ngIf="profitLossData?.vehicle_category>=1 && profitLossData?.vehicle_category <=2">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class=" label ">  Rental Charge</p>
        <p class="label">{{ profitLossData?.revenue?.rental_charge| numberFormat }} {{ currency_type?.symbol}}</p>
      </div>
      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" *ngxPermissionsOnly="[trip[1]]"  [disabled]="!profitLossData.revenue.is_rental_editable  || headerData['approval_status']['status_screen_to_show'] ==='Completed'"
        [routerLink]="[prefixUrl+'/trip/new-trip/edit/',tripId]">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
      </div>
    </div>

    <!-- Extra Hours Charge -->
    <div class="d-flex mb-3 justify-content-between"
      *ngIf="profitLossData?.vehicle_category>=1 && profitLossData?.vehicle_category <=2 && profitLossData?.revenue?.extra_hours_charge>0">
        <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
          <p class=" label "> Extra {{billingUnitType}} </p>
          <p class="label">{{ profitLossData?.revenue?.extra_hours_charge | numberFormat}} {{ currency_type?.symbol}}</p>
        </div>
        <div class="box-110px d-flex justify-content-between ">
          <button class="edit-btn me-2" *ngxPermissionsOnly="[trip[1]]"
            [disabled]="headerData['approval_status']['status_screen_to_show'] ==='Completed'"
            [routerLink]="[prefixUrl+'/trip/new-trip/edit/',tripId]">
            <i class="bi bi-pencil-fill"></i>Edit
          </button>
        </div>
    </div>



    <div class="d-flex mb-3 justify-content-between"
      *ngFor="let data of profitLossData?.revenue?.charges?.party_add_bill_charges">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class="label ">{{data?.type?.label}}: 
          <ng-container *ngIf="data?.containers.length">
            ( <span *ngFor="let container of data?.containers;let last =last">{{container.name }}{{last ? ' ':', '}}</span> )
          </ng-container>  
        </p>
        <p class=" label">{{ data?.amount_before_tax | numberFormat}} {{ currency_type?.symbol}}</p>
      </div>

      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" [disabled]="!data.is_charge_editable_deletable"
          (click)="openChargeDeductionClient(data,'party_add_bill_charges')">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,data?.document_no)"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}"
         >
         <span class="material-icons">
          image
          </span>
        </button>
        
        <button class="del-btn " [disabled]="!data.is_deletable" (click)="deleteItems(data.id,'charges')"><i
            class="material-icons  text-danger">delete</i></button>
      </div>


    </div>




    <div class="d-flex mb-3 justify-content-between"
      *ngFor="let data of profitLossData?.revenue?.charges?.vp_reduce_bill_charges">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class="label ">{{data?.type?.label}}: 
          <ng-container *ngIf="data?.containers.length">
            ( <span *ngFor="let container of data?.containers;let last =last">{{container.name }}{{last ? ' ':', '}}</span> )
          </ng-container>  
        </p>
        <span class=" label">{{ data?.amount_before_tax | numberFormat}} {{ currency_type?.symbol}}</span>
      </div>

      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" [disabled]="!data.is_charge_editable_deletable"
          (click)="openChargeDeductionVendor(data,'vp_reduce_bill_charges')">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,data?.document_no)"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}"
          >
          <span class="material-icons">
           image
           </span>
         </button>
        <button (click)="deleteItems(data.id,'charges')" [disabled]="!data.is_deletable" class="del-btn "><i
            class="material-icons  text-danger">delete</i></button>
      </div>


    </div>


  </div>






  <div class="p-4 px-5 border-bottom border-2">


    <!-- ///////  Expense section   ///////////// -->
    <div class="d-flex mb-4  justify-content-between align-items-center">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between ">

        <p class=" label dark fs-6">Expense (Pre-Tax) <span *ngIf="isVoid" class="dark"> (Job is Void)</span></p>


        <p class="label dark fs-6">{{ profitLossData?.expense.total| numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between"></div>
    </div>


    <!-- vehicle freight -->
    <div class="d-flex mb-3 justify-content-between" *ngFor="let data of profitLossData?.expense?.vehicle_freight">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class=" label ">Vehicle Freight </p>


        <p class="label">{{ data?.freight_amount| numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between">
        <button class="edit-btn me-2" [disabled]="!data.is_editable_deletable  || headerData['approval_status']['status_screen_to_show'] ==='Completed'"
          (click)="openEditBillingPopup(data,'Vehicle',profitLossData.vehicle_category)">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <!-- <button  class="del-btn"><i class="material-icons  text-danger">delete</i></button> -->
      </div>
    </div>
    <div class="d-flex mb-3 justify-content-between" *ngIf="profitLossData?.vehicle_category>=1 && profitLossData?.vehicle_category<=2 && isTransporter">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class=" label ">Market Rental Charge</p>
        <p class="label">{{ profitLossData?.expense?.market_rental_charge| numberFormat }} {{ currency_type?.symbol}}</p>
      </div>
      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" *ngxPermissionsOnly="[trip[1]]"  [disabled]="!profitLossData.revenue.is_rental_editable  || headerData['approval_status']['status_screen_to_show'] ==='Completed'"
        [routerLink]="[prefixUrl+'/trip/new-trip/edit/',tripId]">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
      </div>
    </div>
    <div class="d-flex mb-3 justify-content-between" *ngIf="profitLossData?.vehicle_category>=1 && profitLossData?.expense?.market_extra_hours_charge>0 && isTransporter">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class=" label ">  Extra {{billingUnitType}} </p>
        <p class="label">{{ profitLossData?.expense?.market_extra_hours_charge| numberFormat }} {{ currency_type?.symbol}}</p>
      </div>
      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" *ngxPermissionsOnly="[trip[1]]"   [disabled]="headerData['approval_status']['status_screen_to_show'] ==='Completed'"
        [routerLink]="[prefixUrl+'/trip/new-trip/edit/',tripId]">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
      </div>
    </div>

    <div class="d-flex mb-3 justify-content-between"
      *ngFor="let data of profitLossData?.expense?.party_charges_add">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class="label ">{{data?.type?.label}}: 
          <ng-container *ngIf="data?.containers.length">
            ( <span *ngFor="let container of data?.containers;let last =last">{{container.name }}{{last ? ' ':', '}}</span> )
          </ng-container>  
        </p>
        <p class=" label">{{ data?.expense_amount_before_tax| numberFormat }} {{ currency_type?.symbol}}</p>
      </div>

      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" [disabled]="!data.is_expense_editable_deletable"
          (click)="openChargeDeductionClient(data,'party_add_bill_charges')">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,data?.document_no)"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}"
          >
          <span class="material-icons">
           image
           </span>
         </button>
        <button class="del-btn " [disabled]="!data.is_expense_editable_deletable" (click)="deleteItems(data.id,'charge_expense')"><i
            class="material-icons  text-danger">delete</i></button>
      </div>


    </div>
    <div class="d-flex mb-3  justify-content-between"
      *ngFor="let data of profitLossData?.expense?.vp_charges_reduce">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">
        <p class="label ">{{data?.type?.label}}: 
          <ng-container *ngIf="data?.containers.length">
            ( <span *ngFor="let container of data?.containers;let last =last">{{container.name }}{{last ? ' ':', '}}</span> )
          </ng-container>  
        </p>
        <span class=" label">{{ data?.expense_amount_before_tax| numberFormat }} {{ currency_type?.symbol}}</span>
      </div>

      <div class="box-110px d-flex justify-content-between ">
        <button class="edit-btn me-2" [disabled]="!data.is_expense_editable_deletable"
          (click)="openChargeDeductionVendor(data,'vp_reduce_bill_charges')">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,data?.document_no)"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}"
          >
          <span class="material-icons">
           image
           </span>
         </button>
        
        <button (click)="deleteItems(data.id,'charge_expense')" [disabled]="!data.is_expense_editable_deletable" class="del-btn "><i
            class="material-icons  text-danger">delete</i></button>
      </div>


    </div>




    <div class="d-flex mb-3 justify-content-between"
      *ngFor="let data of profitLossData?.expense?.charges?.party_reduce_bill_charges">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class="label ">{{data?.type?.label}}: 
          <ng-container *ngIf="data?.containers.length">
            ( <span *ngFor="let container of data?.containers;let last =last">{{container.name }}{{last ? ' ':', '}}</span> )
          </ng-container>  
        </p>
        <p class="label">{{ data?.amount_before_tax| numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between">
        <button class="edit-btn me-2" [disabled]="!data.is_editable"
          (click)="openChargeDeductionClient(data,'party_reduce_bill_charges')">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,data?.document_no)"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}"
          >
          <span class="material-icons">
           image
           </span>
         </button>
        <button (click)="deleteItems(data.id,'charges')" [disabled]="!data.is_deletable" class="del-btn"><i
            class="material-icons  text-danger">delete</i></button>
      </div>
    </div>


    <div class="d-flex mb-3 justify-content-between"
      *ngFor="let data of profitLossData?.expense?.charges?.vp_add_bill_charges">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class=" label ">{{data?.type?.label}} 
          <ng-container *ngIf="data?.containers.length">
            ( <span *ngFor="let container of data?.containers;let last =last">{{container.name }}{{ last ? ' ':', '}}</span> )
          </ng-container>  
        </p>
        <p class="label">{{ data?.amount_before_tax| numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between">
        <button class="edit-btn me-2" [disabled]="!data.is_editable"
          (click)="openChargeDeductionVendor(data,'vp_add_bill_charges')">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,data?.document_no)"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}"
          >
          <span class="material-icons">
           image
           </span>
         </button>
        <button (click)="deleteItems(data.id,'charges')" [disabled]="!data.is_deletable" class="del-btn"><i
            class="material-icons  text-danger">delete</i></button>
      </div>
    </div>


    <!--    fuel expenses     -->
    <div class="d-flex mb-3 justify-content-between" *ngFor="let data of profitLossData?.expense?.fuel">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class=" label ">Fuel Bill</p>
        <p class="label">{{ data?.amount| numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between">
        <button class="edit-btn me-2" [disabled]="!data?.is_editable_deletable" (click)="openFuelExpense(data)">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button (click)="deleteItems(data.id,'self_fuels')" [disabled]="!data?.is_editable_deletable" class="del-btn"><i
            class="material-icons  text-danger">delete</i></button>
      </div>
    </div>


    <!-- driver allowance expense -->


    <div class="d-flex mb-3 justify-content-between" *ngFor="let data of profitLossData?.expense?.driver_allowance">
      <div  *ngIf="data?.paid>0" class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class=" label ">{{data?.employee?.display_name ? data?.employee?.display_name : '-'}} {{data?.reason?.name ? '('+data.reason.name+')' : ''}}</p>


        <p class="label">{{ data?.paid | numberFormat}} {{ currency_type?.symbol}}</p>

      </div>
      <div *ngIf="data?.paid>0" class="box-110px d-flex justify-content-between">
        <button class="edit-btn me-2" [disabled]="!data.is_editable_deletable" (click)="openDriverAllowance(data)">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button (click)="deleteItems(data.id,'allowances')" [disabled]="!data.is_editable_deletable" class="del-btn"><i
            class="material-icons  text-danger">delete</i></button>
      </div>
    </div>


    <!--    other expenses -->

    <div class="d-flex mb-3  justify-content-between" *ngFor="let data of profitLossData?.expense?.other_expenses">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between align-items-center">

        <p class=" label ">{{data?.expense_type?.name}}</p>
        <p class="label">{{ data?.amount_before_tax| numberFormat }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between">
        <button class="edit-btn me-2" [disabled]="!data.is_editable_deletable" (click)="openOtherExpenses(data)">
          <i class="bi bi-pencil-fill"></i>Edit
        </button>
        <button class="del-btn me-2" (click)="viewUploadedDocument(data?.documents,'')"  [disabled]="data?.documents?.length == 0" [ngStyle]="{'color': data?.documents.length > 0 ? '#15A4F6' : '#CCCCCC'}">
          <span class="material-icons">image</span>
         </button>
        <button [disabled]="!data.is_editable_deletable" (click)="deleteItems(data.id,'expenses')" class="del-btn"><i
            class="material-icons  text-danger">delete</i></button>
      </div>
    </div>


  </div>



  <div class="p-4 px-5">



    <!-- total trip P/L -->
    <div class="d-flex  justify-content-between align-items-center">
      <div class="flex-grow-1  pe-5 d-flex justify-content-between ">

        <p class=" label green-label fs-6" *ngIf="profitLossData?.total>=0">Job Profit</p>
        <p class="label warning fs-6" *ngIf="profitLossData?.total<0">Job Loss</p>


        <p class="label fs-6" [ngClass]="profitLossData?.total>=0 ? 'green-label' : 'warning'">{{ profitLossData?.total| numberFormat
          }} {{ currency_type?.symbol}}</p>

      </div>
      <div class="box-110px d-flex justify-content-between"></div>
    </div>

  </div>

</div>

