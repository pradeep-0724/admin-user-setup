<form [formGroup]="craneFormGroup" class="def-color">
    <div class="quotation-edit-route-pop flex-lg-row flex-column ">
        <div class="form-wrap position-relative">
            <div class="gb-fake-tab-wrapper">
                <span>Location Details</span>

            </div>
            <div>
                <div formGroupName="location_details">
                    <div class="row  p-4  mx-0">
                        <div class="col-xl-4 col-lg-3 col-md-4 col-6">
                            <div class="input-wrap dropdownArrow ">
                                <label class="input">Zone</label>

                                <material-dropdown [selectedOption]="initialValues.zone" [addBlank]="true"
                                    [searchable]="true" class="dropDownWidth">
                                    <select #customSelect formControlName="zone" class="no-style select--modify"
                                        (change)="onZoneChange()">
                                        <option *ngFor="let option of zonesList" value="{{ option?.id }}">
                                            {{ option?.name }}
                                        </option>
                                    </select>
                                </material-dropdown>

                            </div>
                        </div>
                        <div class="col-xl-4 col-lg-3 col-md-4 col-6">
                            <div class="input-wrap clearfix dropdownArrow " [ngClass]="addErrorClass(craneFormGroup.controls.location_details.get('area'))">
                                <div class="location-input">
                                    <label class="input--required">Location 
                                    </label>
                                    <div class="show-in-invoice">
                                        <mat-checkbox  class="fw-semibold def-color" formControlName="show_in_invoice"  color="primary" >Show In Invoice</mat-checkbox>
                                    </div>
                                </div>                          
                                <material-dropdown [searchable]="true" [addable]="true"
                                [postApiUrl]="areaApi"
                                [params]="areaParams"
                                (postApiResponse)="getNewArea($event)"
                                (addValueToList)="addNewArea($event)"
                                  [selectedOption]="initialValues?.area">
                                  <select #customSelect formControlName="area" class="no-style select--modify" >
                                    <option *ngFor="let option of areaList" value="{{ option?.id }}">
                                      {{ option?.label }}
                                    </option>
                                  </select>
                                </material-dropdown>
                                <app-error [controlName]="craneFormGroup.controls.location_details.get('area')"></app-error>

                            </div>
                        </div>
                        <div class="col-xl-4 col-lg-4 col-6">
                            <div class="input-wrap clearfix  ">
                                <label class="input">Map Coordinate </label>
                                <app-tool-tip class="tool-tip-position lower" [totalSlides]="locationToolTip.content.length"
                                    position="top" [toolTipContent]="locationToolTip"></app-tool-tip>
                                <app-location-v2 *ngIf="!isLocationChanged" [isnameRequired]="false"
                                    [isFromToInvalid]="isLocationValid"
                                    [placeForm]="craneFormGroup.get('location_details')['controls'].location"
                                    (placeDetails)="locationSelected($event)"></app-location-v2>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <div class="input-wrap clearfix ">
                                <label for="" class="">Job Task</label>
                                <app-tool-tip class="tool-tip-position" [totalSlides]="tripTaskToolTip.content.length"
                                    position="right" [toolTipContent]="tripTaskToolTip"></app-tool-tip>
                                <app-check-list
                                    (selectedCheckList)="selectedCheckList($event,craneFormGroup.get('location_details'))"
                                    [selectedList]="craneFormGroup.get('location_details').get('checklist').value"></app-check-list>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-6">
                            <div class="input-wrap clearfix mb-0">
                                <label for="" class="">Job Start Date & Time</label>
                                <app-date-and-time-picker (dateTimeSelected)="dateTimeSelected($event)"
                                    *ngIf="!isStartDateChanged"
                                    [control]="craneFormGroup.get('location_details.job_start_date')"></app-date-and-time-picker>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-6">
                            <div class="input-wrap clearfix mb-0">
                                <label for="" class="">Job End Date & Time</label>
                                <app-date-and-time-picker *ngIf="!isStartDateChanged"
                                    [min]="craneFormGroup.get('location_details').get('job_start_date').value"
                                    [control]="craneFormGroup.get('location_details.job_end_date')"></app-date-and-time-picker>
                            </div>
                        </div>


                        <div class=" col-lg-4 col-md-6">
                            <div class="input-wrap dropdownArrow">
                                <label for="">Point Of Contact (Name)</label>
                                <material-dropdown [selectedOption]="initialValues.contactName"
                                    [disableLastInput]="true" (nonOptionSetValue)="setContactPerson($event)">
                                    <select #customSelect class="no-style select--modify" formControlName="contact_name"
                                        (change)="onContactPersonSelection($event.target.value)">
                                        <option *ngFor="let option of contactPersonList " value="{{option.name}}">
                                            {{option.name}}
                                        </option>
                                    </select>
                                </material-dropdown>
                            </div>
                        </div>

                        <div class=" col-lg-4 col-md-6 input-wrap mb-0">
                            <label
                                [ngClass]="{'input--required':craneFormGroup.get('location_details.contact_name')?.value!=''}">Point
                                Of Contact
                                (Mobile)</label>
                            <div class="mobile-no-wrapper d-flex align-items-start" formGroupName="contact_no">
                                <img [src]="craneFormGroup.get('location_details').get('contact_no').value['flag']" />
                                <div class="input-wrap m-no-prefix clearfix country-prefix">

                                    <material-dropdown [searchable]="true" [selectedOption]="initialValues.countryCode">
                                        <select #customSelect formControlName="code" class="no-style select--modify"
                                            (change)="onCountryCodeSelection(craneFormGroup.get('location_details'))">
                                            <option *ngFor="let option of countryPhoneCodeList"
                                                [value]="option?.phone_code">
                                                {{ option?.phone_code }}
                                            </option>
                                        </select>
                                    </material-dropdown>
                                </div>
                                <div class="input-wrap clearfix error mobile-no"
                                    [ngClass]="addErrorClass(craneFormGroup.get('location_details.contact_no.number'))">
                                    <input type="text" class="no-style input--bd" placeholder="Number" value=""
                                        formControlName="number" />
                                    <app-error
                                        [controlName]="craneFormGroup.get('location_details.contact_no.number')"></app-error>
                                </div>


                            </div>

                        </div>
                    </div>


                </div>

            </div>
        </div>
        <div class="map-wrap">
            <div class="map-top">
                <div>
                    <div> </div>
                </div>
            </div>
            <div class="google-map-box">
                <google-map height="100%" width="100%" *ngIf="zoom" [zoom]="zoom" [center]="center">
                    <map-marker *ngFor="let markerPosition of markerPositions" [position]="markerPosition"
                        [options]="markerOptions"></map-marker>
                </google-map>
            </div>

        </div>
    </div>
    <div class="quotation-customFields">
        <div class="gb-tab-wrapper">
            <mat-tab-group mat-stretch-tabs="false" class="mat-group" animationDuration="0ms" mat-align-tabs="start">
                <mat-tab>
                    <ng-template mat-tab-label>
                        <span [ngClass]="{ taberror:isRentalChargesTabError  }">Rental Charge</span>
                    </ng-template>
                    <div>
                        <div *ngIf="!isRentalEditable" role="alert" class="alert alert-warning m-3 mb-0"> Can not edit
                            the rental charges, as the timesheet has been invoiced.</div>
                        <div formGroupName="rental_charge" [ngClass]="{'disable':!isRentalEditable }">
                            <div class="row px-4 pt-4 mx-0">
                                <div class="col-lg-2 col-6">
                                    <div class="input-wrap clearfix">
                                        <label for="" >Billing Unit</label>
                                        <material-dropdown [selectedOption]="initialValues.billingUnit">
                                            <select #customSelect formControlName="billing_unit" (change)="onBillingUnitChange()"
                                            
                                                class="no-style select--modify">
                                                <option *ngFor="let option of rateCardBillingList" value="{{ option?.value}}">
                                                    {{ option?.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>
                                   </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="input-wrap dropdownArrow ">
                                        <label class="input">No. of Shift</label>

                                        <material-dropdown [searchable]="true" [selectedOption]="initialValues.shifType"
                                            class="dropDownWidth">
                                            <select #customSelect formControlName="no_of_shifts"
                                                class="no-style select--modify" (change)="onShiftChange()">
                                                <option *ngFor="let option of shiftType" [value]="option?.value">
                                                    {{ option?.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>
                                    </div>
                                </div>
                                <div class="col-lg-2">
                                    <div class="input-wrap dropdownArrow ">
                                        <label class="input">Fuel Provision</label>

                                        <material-dropdown [searchable]="true" [selectedOption]="initialValues.fuelType"
                                            class="dropDownWidth">
                                            <select #customSelect formControlName="fuel_type"
                                                class="no-style select--modify"
                                                (change)="onShiftChange();getAndSetRentalCharge()">
                                                <option *ngFor="let option of fuelType" [value]="option?.value">
                                                    {{ option?.label }}
                                                </option>
                                            </select>
                                        </material-dropdown>
                                    </div>
                                </div>
                                <div class="col-lg-3">

                                    <div class="input-wrap clearfix" formGroupName="working_duration">
                                        <label for="" class="">Working Duration</label>
                                        <div class="d-flex justify-content-center align-items-center">
                                            <input type="text" value="0" formControlName="duration" positiveDigitNumber
                                                [ngClass]="{'invalid-input':craneFormGroup.get('rental_charge.working_duration').get('duration')?.invalid&&craneFormGroup.get('rental_charge.working_duration').get('duration')?.touched }"
                                                class="no-style input--bd w-25" (change)="onChangeWorkingDuration()" />

                                            <div class=" border-1 mx-2 border" style="height: 15px;"></div>

                                            <div class="flex-grow-1">
                                                <material-dropdown [searchable]="true"
                                                    [selectedOption]="initialValues.working" [addable]="false"
                                                    class="dropDownWidth">
                                                    <select #customSelect formControlName="working"
                                                        class="no-style select--modify"
                                                        (change)="onChangeWorkingDuration();getAndSetRentalCharge()">
                                                        <option *ngFor="let option of durationType"
                                                            value="{{ option.value }}">
                                                            {{ option.label }}
                                                        </option>
                                                    </select>
                                                </material-dropdown>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                                <div class="col-lg-3">
                                    <div class="input-wrap">
                                        <ng-container *ngIf="jobBasedOn=='hour'">
                                            <label for="">Total Working Hours</label>
                                        </ng-container>
                                        <ng-container *ngIf="jobBasedOn=='day'">
                                            <label for="">Total Working Days</label>
                                        </ng-container>
                                        {{totalJobsHours}}
                                    </div>

                                </div>
                            </div>
                            <div class="addable-row-table m-4 mt-0">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>RENTAL CHARGE</th>
                                            <ng-container *ngIf="jobBasedOn=='hour'">
                                                <th>RATE PER HOUR ({{ currency_type?.symbol}})</th>
                                            </ng-container>
                                            <ng-container *ngIf="jobBasedOn=='day'">
                                                <th>RATE PER DAY ({{ currency_type?.symbol}})</th>
                                            </ng-container>
                                            <th>TOTAL ESTIMATE AMOUNT   ({{ currency_type?.symbol}})</th>
                                            <ng-container *ngIf="jobBasedOn=='hour'">
                                                <th>EXTRA HOURS AMOUNT   ({{ currency_type?.symbol}})</th>
                                            </ng-container>
                                            <ng-container *ngIf="jobBasedOn=='day'">
                                                <th>EXTRA DAYS AMOUNT   ({{ currency_type?.symbol}})</th>
                                            </ng-container>
                                        </tr>

                                    </thead>
                                    <tbody formArrayName="rental_charges">

                                        <ng-container
                                            *ngFor="let control of craneFormGroup.controls['rental_charge'].get('rental_charges')['controls'];let i = index"
                                            [formGroupName]="i">

                                            <tr>
                                                <td>
                                                    <div>
                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                            formControlName="rental_charge" class="error-box"
                                                            placeholder="Eg.: 1234567" value="0"
                                                            (change)="onchangeRentalCharge()">
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                            formControlName="rental_rate" class="error-box"
                                                            placeholder="Eg.: 1234567" value="0" readonly>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                            formControlName="total_amount" class="error-box"
                                                            placeholder="Eg.: 1234567" value="0" readonly>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div>
                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                            formControlName="extra_hours" class="error-box"
                                                            placeholder="Eg.: 1234567" value="0">
                                                    </div>
                                                </td>
                                            </tr>
                                        </ng-container>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="quotation-customFields" *ngIf="displayMarketRentalCharges">
                        <div class="gb-tab-wrapper">
                            <mat-tab-group mat-stretch-tabs="false" class="mat-group" animationDuration="0ms" mat-align-tabs="start">
                                <mat-tab>
                                    <ng-template mat-tab-label>
                                        <span [ngClass]="{ taberror:isMarketRentalChargesTabError  }">Market Rental Charge</span>
                                    </ng-template>
                                    <div>
                                        <div formGroupName="market_rental_charge" [ngClass]="{'disable':!isMarketRentakEditable }">
                                            <div class="addable-row-table m-4 ">
                                                <table>
                                                    <thead>
                                                        <tr>
                                                            <th>RENTAL CHARGE</th>
                                                            <ng-container *ngIf="jobBasedOn=='hour'">
                                                                <th>RATE PER HOUR ({{ currency_type?.symbol}})</th>
                                                            </ng-container>
                                                            <ng-container *ngIf="jobBasedOn=='day'">
                                                                <th>RATE PER DAY ({{ currency_type?.symbol}})</th>
                                                            </ng-container>
                                                            <th>TOTAL ESTIMATE AMOUNT</th>
                                                            <ng-container *ngIf="jobBasedOn=='hour'">
                                                                <th>EXTRA HOURS AMOUNT</th>
                                                            </ng-container>
                                                            <ng-container *ngIf="jobBasedOn=='day'">
                                                                <th>EXTRA DAYS AMOUNT</th>
                                                            </ng-container>
                                                        </tr>
                
                                                    </thead>
                                                    <tbody formArrayName="market_rental_charges">
                
                                                        <ng-container
                                                            *ngFor="let control of craneFormGroup.controls['market_rental_charge'].get('market_rental_charges')['controls'];let i = index"
                                                            [formGroupName]="i">
                
                                                            <tr>
                                                                <td>
                                                                    <div>
                                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                                            formControlName="market_rental_charge" class="error-box"
                                                                            placeholder="Eg.: 1234567" value="0"
                                                                            (change)="onchangeRentalChargeFrMarket()">
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div>
                                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                                            formControlName="market_rental_rate" class="error-box"
                                                                            placeholder="Eg.: 1234567" value="0" readonly>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div>
                                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                                            formControlName="market_total_amount" class="error-box"
                                                                            placeholder="Eg.: 1234567" value="0" readonly>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div>
                                                                        <input type="text" positiveThreeDigitDecimalNumber
                                                                            formControlName="market_extra_hours" class="error-box"
                                                                            placeholder="Eg.: 1234567" value="0">
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </ng-container>
                
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                
                
                                </mat-tab>
                            </mat-tab-group>
                        </div>
                    </div>


                </mat-tab>
                <!-- <mat-tab>
                    <ng-template mat-tab-label>
                        <span [ngClass]="{ taberror: iscustomFieldTabError }">Custom Field </span>
                    </ng-template>
                    <app-custom-field [editData]="customFieldData" [parentForm]="craneFormGroup"
                        [isFormValid]="isFormValidCustomField"></app-custom-field>
                </mat-tab> -->

                <mat-tab *ngIf="!parentForm.get('is_transporter').value">
                    <ng-template mat-tab-label>
                        <span [ngClass]="{ taberror: isDriverAllowanceTabError }">Driver Commission</span>
                    </ng-template>
                    <app-driver-allowance-v2 [isPaidByDriver]="isPaidByDriver"
                        [driverAllowanceEdit]="driverAllowanceEdit" [driverId]="driverId" [parentForm]="craneFormGroup"
                        [isFormValid]="isFormValidDriverAllowanceField"></app-driver-allowance-v2>
                </mat-tab>

                <mat-tab>
                    <ng-template mat-tab-label>
                        <span>Job Documents</span>

                    </ng-template>
                    <div class="d-flex flex-wrap gap-3 p-4 ">
                        <file-uploader-v2 (onFileUploaded)="fileUploader($event)" fileName="Document Unknown"
                            [uploaderId]="'1234'" [isShowOnlyUpload]="false"></file-uploader-v2>
                        <app-file-delete-view [showInlineEdit]="true" [editedFileName]="editedFileName"
                            [fileData]="document" *ngFor="let document of  craneFormGroup.get('documents').value"
                            (fileDeleted)="fileDeleted($event)"></app-file-delete-view>
                    </div>
                </mat-tab>

            </mat-tab-group>
        </div>
    </div>
    
</form>