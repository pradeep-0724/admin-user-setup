<section>

  <div class="right-section__header">
    <h1 class="heading my-1">Balance Sheet</h1>
    <div class="header-actions my-1 w-auto">
      <button class="btn btn--primary btn--dropdown  mg-right-10 export-mobile-icon" (click)="$event.stopPropagation();canDownloadBalance = !canDownloadBalance">Export <span><i class="fas fa-file-export"></i></span><i class="material-icons mobile-hide">arrow_drop_down</i>
        <ul class="more-actions__menu" [ngClass]="{'show': canDownloadBalance}">
            <!-- <li class="more-actions__item" type="button" (click)="downLoadxlsxOrpdf('xlsx','Balance Sheet ')"  >Export As xlsx</li> -->
            <li class="more-actions__item" type="button"  (click)="downLoadxlsxOrpdf('pdf','Balance Sheet ')" >Export As Pdf</li>
        </ul>
       </button>

      <div class="mobile-calender">
        <input type="text" class="form-control date-range date-range-style" [ngModelOptions]="{standalone: true}" bsDaterangepicker
        [(ngModel)]="selectedRange" (bsValueChange)="filterBalanceSheet($event)"
        [bsConfig]="{ rangeInputFormat: 'DD MMM YYYY', showWeekNumbers: false }">
      </div>

    </div>
  </div>
  <div class="balance-header box-shadow">
    <div class="row">
      <div class="col-md-6">
        <h2 class="sub-heading">{{(companyData?.company_name)?(companyData?.company_name):'-'}}</h2>
        <p class="fs-14 mt-3 sub-text" *ngIf="selectedRange">Balance sheet from {{selectedRange[0] | date}} to {{selectedRange[1] | date}}</p>
      </div>
      <div class="col-md-6 actions-item">
        <div class="actions-wrap">
          <button class="btn" [ngClass]="{'btn--primary':!collapseFlag}"  (click)="expandCollapseAll(false)">Collapse All</button>
          <button class="btn mg-left-10" [ngClass]="{'btn--primary':collapseFlag}"  (click)="expandCollapseAll(true)">Expand All</button>
        </div>
      </div>
    </div>
  </div>
  <div class="balance-sheet-container" [ngClass]="{'t-shaped-wrapper': type == 't'}" id="break-all">
    <div class="form-layout balance-sheet-wrap mg-top-30 box-shadow" [ngClass]="{'mg-right-5 col-lg-6': type == 't' }">
      <div class="container balance-sheet-table">
        <div class="row tree-row flex-box">
          <div class="flex-grow-1 pd-left-25 tree-heading w-auto">
            EQUITY & LIABILITIES
          </div>
          <div class="wd-200  text-end pd-right-10 tree-heading w-auto">
            AMOUNT ({{ currency_type?.symbol}})
          </div>
        </div>
        <div *ngFor="let equity of equityAndLiabilities | keyvalue;let i = index">
          <div class="flex-box">
            <div class="name">
              <span *ngIf="equity.value?.length>0" class="mg-right-7">
                <a class="plus-icon-sm" *ngIf="!show[i]" (click)="show[i] = !show[i]"></a>
                <a class="minus-icon-sm" *ngIf="show[i]" (click)="show[i] = !show[i]"></a>
              </span>
              <span *ngIf="equity.value?.length==0" class="mg-left-22"></span>
              <span [ngClass]="{'fw-600':show[i]}">{{equity.key}}</span>
            </div>
            <div *ngIf="!show[i]" class="debit">
              <span>{{ identifyAmountType(calculateParentSubTotal(equity.value),false) }}</span>&nbsp;
              <span class="rupee-symbol rupee-symbol--sm"></span>
              {{ currency_type?.symbol}} {{ fixedTo3Decimal(returnAbsoluteNumber(calculateParentSubTotal(equity.value))) }}</div>
          </div>
          <div class="nested-items" *ngIf="show[i]">
            <div *ngFor="let acc of equity?.value">
              <tree [debitPositive]="false" [response]="acc"></tree>
            </div>
            <div class="flex-box mg-left-7">
              <div class="total fw-600">
                Total for {{equity.key}}
              </div>
              <div class="debit">
                <span>{{ identifyAmountType(calculateParentSubTotal(equity.value),false) }}</span>&nbsp;
                <span class="rupee-symbol rupee-symbol--sm"></span>
                {{ currency_type?.symbol}} {{ fixedTo3Decimal(returnAbsoluteNumber(calculateParentSubTotal(equity.value))) }}</div>
            </div>
          </div>
        </div>
        <div class="row tree-row flex-box">
          <div class="flex-grow-1 pd-left-15 tree-heading fs-14 w-auto">
            TOTAL
          </div>
          <div class="wd-200  text-end pd-right-15 tree-heading fs-14 w-auto">
            <span>{{ identifyAmountType(equityLiabilityTotal,false) }}</span>&nbsp;
            <span class="rupee-symbol rupee-symbol--sm"> {{ currency_type?.symbol}} {{ fixedTo3Decimal(returnAbsoluteNumber(equityLiabilityTotal)) }}</span>
          </div>
        </div>
        <div class="row tree-row flex-box">
          <div class="flex-grow-1 pd-left-15 tree-heading fs-14 w-auto">
            NET
            <span>{{ identifyProfitOrLoss(balanceSheetData?.net_amount) }}</span>
          </div>
          <div class="wd-200  text-end pd-right-15 tree-heading fs-14 w-auto">
            <span class="rupee-symbol rupee-symbol--sm"> {{ currency_type?.symbol}} {{ fixedTo3Decimal(returnAbsoluteNumber(balanceSheetData?.net_amount)) }}</span>
          </div>
        </div>
        <div class="row tree-row flex-box">
          <div class="flex-grow-1 pd-left-15 tree-heading fs-14 w-auto">
            FINAL TOTAL
          </div>
          <div class="wd-200  text-end pd-right-15 tree-heading fs-14 w-auto">
            <span>{{ identifyAmountType(returnAbsoluteNumber(equityLiabilityTotal) + balanceSheetData?.net_amount,false) }}</span>&nbsp;
            <span class="rupee-symbol rupee-symbol--sm"> {{ currency_type?.symbol}} {{ fixedTo3Decimal(calculateNetAmount(equityLiabilityTotal,balanceSheetData?.net_amount)) }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="form-layout balance-sheet-wrap mg-top-30 box-shadow" [ngClass]="{'mg-left-5 col-lg-6': type == 't' }">
      <div class="container balance-sheet-table">
        <div class="row tree-row flex-box">
          <div class="flex-grow-1 pd-left-25 tree-heading w-auto">
            ASSETS
          </div>
          <div class="wd-200  text-end pd-right-10 tree-heading w-auto">
            AMOUNT ({{ currency_type?.symbol}})
          </div>
        </div>
        <div *ngFor="let asset of balanceSheetData?.Assets | keyvalue;let i = index">
          <div class="flex-box">
            <div class="name">
              <span *ngIf="asset.value?.length>0" class="mg-right-7">
                <a class="plus-icon-sm" *ngIf="!showAssets[i]" (click)="showAssets[i] = !showAssets[i]"></a>
                <a class="minus-icon-sm" *ngIf="showAssets[i]" (click)="showAssets[i] = !showAssets[i]"></a>
              </span>
              <span *ngIf="asset.value?.length==0" class="mg-left-22"></span>
              <span [ngClass]="{'fw-600':showAssets[i]}">{{asset.key}}</span>
            </div>
            <div *ngIf="!showAssets[i]" class="debit">
              <span>{{ identifyAmountType(calculateParentSubTotal(asset.value),true) }}</span>&nbsp;
              <span class="rupee-symbol rupee-symbol--sm"></span>
               {{ fixedTo3Decimal(returnAbsoluteNumber(calculateParentSubTotal(asset.value))) }}
            </div>
          </div>
          <div class="nested-items" *ngIf="showAssets[i]">
            <div *ngFor="let acc of asset?.value">
              <tree [debitPositive]="true" [response]="acc"></tree>
            </div>
            <div class="flex-box mg-left-7">
              <div class="total fw-600">
                Total for {{asset.key}}
              </div>
              <div class="debit">
                <span>{{ identifyAmountType(calculateParentSubTotal(asset.value),true) }}</span>&nbsp;
                <span class="rupee-symbol rupee-symbol--sm"></span>
                {{ currency_type?.symbol}} {{ fixedTo3Decimal(returnAbsoluteNumber(calculateParentSubTotal(asset.value))) }}
              </div>
            </div>
          </div>
        </div>
        <div class="row tree-row flex-box">
          <div class="flex-grow-1 pd-left-15 tree-heading fs-14 w-auto">
            FINAL TOTAL
          </div>
          <div class="wd-200  text-end pd-right-15 tree-heading fs-14 w-auto">
            <span>{{ identifyAmountType(assetsTotal,true) }}</span>&nbsp;
            <span class="rupee-symbol rupee-symbol--sm"> {{ currency_type?.symbol}} {{ fixedTo3Decimal(returnAbsoluteNumber(assetsTotal)) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</section>
