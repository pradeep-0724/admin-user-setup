<div class="add-screen-wrap">
<div class="right-section__header">
    <h1 *ngIf="vendorAdvanceId" class="heading">Edit Vendor Advance</h1>
    <h1 *ngIf="!vendorAdvanceId" class="heading">Add Vendor Advance</h1>
    <button class="gb-video-play float-right"  (click)="openGothrough()">
        <i class="bi bi-play-circle-fill"></i>
    </button>
</div>
<form [formGroup]="advancePaymentForm">
    <div class="shadow-inset-top-lg form-layout--pd">
        <div class="form-layout__card active">
            <div class="form-body">
                <div class="row tabIndexActiveFields">

                    <div *ngIf="!vendorAdvanceId" class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap error" [ngClass]="addErrorClass(advancePaymentForm.controls.party)">
                            <label for="" class="input--required">Vendor</label>
                            <material-dropdown [searchable]="true"
                                               [addable]="false"
                                               class="dropDownWidth"
                                               [selectedOption]="initialValues.party"
                                               [party]="true" (addPartyPopup)="openAddPartyModal($event)"
                                               (addValueToList)="addValueToPartyPopup($event)"
                                               [params]="partyNamePopup"
                                               [maxLength]="255"
                                               >
                                    <select #customSelect formControlName="party" class="no-style select--modify"
                                           (change)="onVendorSelected($event)"  (change)="stopLoaderClasstoBody()">
                                        <option *ngFor="let vendor of vendorList" value="{{ vendor.id }}">
                                            {{ vendor.party_display_name }}
                                        </option>
                                    </select>
                            </material-dropdown>
                            <span *ngIf="gstin" class="font-small-blue"> GSTIN: {{gstin}} </span>
                            <app-error [controlName]="advancePaymentForm.controls.party"></app-error>

                        </div>
                    </div>

                    <div *ngIf="vendorAdvanceId" class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap disabled">
                            <label for="" class="input--required">Vendor</label>
                            <div class="input--bd">{{ initialValues.vendor.label }}</div>
                            <span *ngIf="gstin" class="font-small-blue"> GSTIN: {{gstin}} </span>

                        </div>
                    </div>

                    <div class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap error" [ngClass]="addErrorClass(advancePaymentForm.controls.advance_number)">
                            <label for="" class="input--required">Advance Number</label>
                            <input type="text" class="no-style input--bd" placeholder="Enter Number" value=""
                                formControlName="advance_number">
                           <!--  <span class="border-anim"></span> -->
                            <app-error [controlName]="advancePaymentForm.controls.advance_number"></app-error>
                        </div>
                    </div>
                    <div class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap">
                            <label for="" class="">Employee In Charge</label>
                            <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" [addBlank]="true"
                                               [selectedOption]="initialValues.employee">
                                    <select #customSelect formControlName="employee"(change)="handleEmployeeChange()" class="no-style select--modify">
                                        <option *ngFor="let employee of employeeList" value="{{ employee.id }}">
                                            {{ employee.emp_name_id }}
                                        </option>
                                    </select>
                            </material-dropdown>
                            <span class="error-message">Error messge!</span>
                        </div>
                    </div>


                    <div class="col-20 col-lg-3 col-sm-6 datepicker-width-fix">
                        <div class="input-wrap error" [ngClass]="addErrorClass(advancePaymentForm.controls.date)">
                            <label for="" class="input--required">Date</label>
                            <mat-form-field>
                                <input matInput [matDatepicker]="date" (focus)="date.open()" formControlName="date" placeholder="DD/MM/YYYY">
                                <mat-datepicker-toggle matSuffix [for]="date"></mat-datepicker-toggle>
                                <mat-datepicker #date></mat-datepicker>
                            </mat-form-field>
                            <app-error [controlName]="advancePaymentForm.controls.date"></app-error>
                        </div>
                    </div>
                    <div class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap error" [ngClass]="addErrorClass(advancePaymentForm.controls.amount)">
                            <label for="" class="input--required">Amount ({{ currency_type?.symbol}})</label>
                            <input type="number" class="no-style input--bd" placeholder="2000" value="" positiveThreeDigitDecimalNumber
                                formControlName="amount" (change)="roundOffAmount(advancePaymentForm.controls.amount)">
                            <!-- <span class="border-anim"></span> -->
                            <app-error [controlName]="advancePaymentForm.controls.amount"></app-error>
                        </div>
                    </div>
                    <div class="col-20 col-lg-3 col-sm-6">
                            <div class="input-wrap error" [ngClass]="addErrorClass(advancePaymentForm.controls.payment_mode)">
                            <label for="" class="input--required">Payment Mode</label>
                            <material-dropdown [searchable]="true" [addable]="false" class="dropDownWidth" [selectedOption]="initialValues.paymentMode">
                                    <select #customSelect formControlName="payment_mode" class="no-style select--modify"
                                        (change)="onPaymentModeSelected($event)">
                                        <option *ngFor="let account of accountList" value="{{ account.id }}">
                                            {{ account.name }}
                                        </option>
                                    </select>
                            </material-dropdown>
                            <app-error [controlName]="advancePaymentForm.controls.payment_mode"></app-error>
                        </div>
                    </div>
                    <div class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap" [ngClass]="{disabled: !bankingChargeRequired}">
                            <label for="" class="">Banking Charges ({{ currency_type?.symbol}})</label>
                            <input type="text" class="no-style input--bd " placeholder="2000"
                                formControlName="banking_charge"
                                (change)="roundOffAmount(advancePaymentForm.controls.banking_charge)"
                                [attr.disabled]="!bankingChargeRequired ? '' : null">
                            <!-- <span class="border-anim"></span> -->
                            <span class="error-message">Error messge!</span>
                        </div>
                    </div>
                    <div class="col-20 col-lg-3 col-sm-6">
                        <div class="input-wrap">
                            <label for="">Description of supply</label>
                            <input type="text" class="no-style input--bd" placeholder="Items" value=""
                                formControlName="description_of_supply">
                           <!--  <span class="border-anim"></span> -->
                            <span class="error-message">Error messge!</span>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="input-wrap">
                            <label for="" class="">Remarks (For Internal Use)</label>
                            <input type="text" class="no-style input--bd" placeholder="Max 250 Characters"
                                value="" formControlName="remarks">
                        </div>
                    </div>
                </div>
                <app-header-input-field-box [ngClass]="{'hiddenContent':true}" [partyDetailsData]="partyTaxDetails" [editData]="editData" [showIsInclusive]="false" [taxFormValid]="taxFormValid" (headerTaxDetails)="headerTaxDetails($event)"></app-header-input-field-box>

            </div>
        </div>
        <div class="form-layout__card mg-top-30">
            <file-uploader (onFileUploaded)="fileUploader($event)"
            (onFileDeleted)="fileDeleted($event)" [multiple]="true"
            [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'"
            [showFileName]="false" [patchFileUrls]="patchFileUrls">
            </file-uploader>
         </div>
    </div>
    
</form>
</div>
<div class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">
       
            <button class="btn btn--sm me-2" [routerLink]="[prefixUrl+'/payments/list/advance']" routerLinkActive="active">Cancel</button>
            <button  *ngIf="vendorAdvanceId" class="btn btn--primary btn--sm" (click)="updateAdvanceForm()">Update</button>
            <button *ngIf="!vendorAdvanceId" class="btn btn--primary btn--sm" (click)="saveAdvanceForm()">Save</button>

      
    </div>
    <!-- Popup for adding party details -->
    <app-add-party-popup [popDetail]="showAddPartyPopup" (closeModal)="closePartyPopup()"
    (partyAdded)="addPartyToOption($event)" [isVendor]="true"></app-add-party-popup>
    <app-go-through  [goThroughDetais]="goThroughDetais"></app-go-through>
