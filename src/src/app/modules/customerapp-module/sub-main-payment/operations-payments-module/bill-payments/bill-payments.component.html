<div  class="right-section__header d-flex justify-content-space-around">
  <h1  *ngIf="billPaymentId" class="heading">Edit Bill Payment</h1>
  <h1 *ngIf="!billPaymentId" class="heading">Bill Payment</h1>
  <button class="gb-video-play float-right"  (click)="openGothrough()">
    <i class="bi bi-play-circle-fill"></i>
</button>
</div>



<div class="alert-msg" #alertMsg *ngIf="apiError">
  <span class="icon-wrap"></span>
  <p class="message-cont">{{ apiError }}</p>
</div>
<div class="error-msg-list" *ngIf="globalFormErrorList.length > 0">
  <p class="message-head">{{ errorHeaderMessage }}</p>
  <span class="icon-wrap"></span>
  <ul *ngFor="let error of globalFormErrorList">
    <li class="message-cont">{{ error }}</li>
  </ul>
</div>
<form [formGroup]="editBillPaymentForm">
  <div class="form-layout shadow-inset-top-lg form-layout--pd">
    <div class="form-layout__card active">
      <div class="form-body">
        <div class="row tabIndexActiveFields">
          <div *ngIf="billPaymentId" class="col-lg-3 col-sm-6">
            <div class="input-wrap disabled">
              <label for="" class="input--required position-relative">Vendor <span *ngIf="isTdsDecleration" class="blueTag">TDS Declaration Received</span></label>
              <div class="input--bd">{{ initialValues.vendor.label }}</div>
              <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
            </div>
          </div>

          <div *ngIf="!billPaymentId" class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.party)"
            >
              <label for="" class="input--required position-relative">Vendor <span class="blueTag" *ngIf="isTdsDecleration">TDS Declaration Received</span></label>
              <material-dropdown
                [searchable]="true"
                [addable]="false"
                class="dropDownWidth"
                [selectedOption]="initialValues.party"
                [party]="true"
                (addPartyPopup)="openAddPartyModal($event)"
                (addValueToList)="addValueToPartyPopup($event)"
                [params]="partyNamePopup"
                [maxLength]="255"
              >
                <select
                  #customSelect
                  formControlName="party"
                  class="no-style select--modify"
                  (change)="onVendorSelected($event)"  (change)="stopLoaderClasstoBody()"
                >
                  <option
                    *ngFor="let vendor of vendorList"
                    value="{{ vendor.id }}"
                  >
                    {{ vendor.party_display_name }}
                  </option>
                </select>
              </material-dropdown>
              <span *ngIf="gstin" class="font-small-blue"> {{terminology.tax_no_type}}: {{gstin}} </span>
              <app-error
                [controlName]="editBillPaymentForm.controls.party"
              ></app-error>
            </div>
          </div>

          <div class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.date_of_payment)"
            >
              <label for="" class="input--required">Date of Payment</label>
              <mat-form-field>
                <input
                  matInput
                  [matDatepicker]="date_of_payment"
                  (focus)="date_of_payment.open()"
                  formControlName="date_of_payment"
                  placeholder="DD/MM/YYYY"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="date_of_payment"
                ></mat-datepicker-toggle>
                <mat-datepicker #date_of_payment></mat-datepicker>
              </mat-form-field>
              <app-error
                [controlName]="editBillPaymentForm.controls.date_of_payment"
              ></app-error>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.payment_no)"
            >
              <label for="" class="input--required">Payment Number</label>
              <input
                type="text"
                class="no-style input--bd"
                placeholder="2000"
                value=""
                formControlName="payment_no"
              />
             <!--  <span class="border-anim"></span> -->
              <app-error
                [controlName]="editBillPaymentForm.controls.payment_no"
              ></app-error>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.employee)"
            >
              <label>Employee In Charge</label>
              <material-dropdown
                [searchable]="true"
                [addable]="false"
                class="dropDownWidth"
                [addBlank]="true"
                [selectedOption]="initialValues.employee"
              >
                <select
                  #customSelect
                  formControlName="employee"
                  class="no-style select--modify"
                  (change)="handleEmployeeChange()"
                >
                  <option
                    *ngFor="let employee of employeeList"
                    value="{{ employee.id }}"
                  >
                    {{ employee.emp_name_id }}
                  </option>
                </select>
              </material-dropdown>
              <app-error
                [controlName]="editBillPaymentForm.controls.employee"
              ></app-error>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6">
            <div class="input-wrap">
              <label for="">Reference Number</label>
              <input
                type="text"
                class="no-style input--bd"
                placeholder="2000"
                value=""
                formControlName="reference_no"
              />
              <!-- <span class="border-anim"></span> -->
            </div>
          </div>
        </div>
        <div>
          <app-revenue-payment-box
            (revenueHeader)="revenueHeader($event)"
            [ngClass]="{'hiddenContent':!isTax||isTds}"
            [editData]="editData"
          ></app-revenue-payment-box>
        </div>
        <div class="form-layout__card mg-top-30" *ngIf="creditList.length > 0">
          <div class="form-layout__header">
            <h2 class="sub-heading">Vendor Credits</h2>
            <span class="collapse-line"></span>
          </div>
          <div class="mg-top-30">
            <div
              class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg"
            >
              <table class="table-container">
                <thead>
                  <tr>
                    <th width="8%" class="" [ngStyle]="{'padding-right':'60px'}" class="table-checkbox">
                      <label  class="check-box">
                        <input
                        type="checkbox"(change)="vendorCreditAll($event)" formControlName="vendorCreditAllSelect"
                        />
                        <span class="check-mark"></span>
                      </label>
                      </th>
                    <th width="10%">Reference</th>
                    <th width="32%">Description</th>
                    <th width="10%">Date</th>
                    <th width="10%">
                      Original Amount ({{ currency_type?.symbol}})
                    </th>
                    <th width="10%">
                      Open Balance ({{ currency_type?.symbol}})
                    </th>
                    <th width="10%">Payment</th>
                    <th width="10%">
                      Final Balance ({{ currency_type?.symbol}})
                    </th>
                  </tr>
                </thead>
                <tbody formArrayName="vendor_credit">
                  <tr
                    *ngFor="let vendorCredit of creditList; let i = index;"
                    [formGroupName]="i"
                  >
                    <td class="table-checkbox">
                      <label for="vc-{{ i }}" class="check-box">
                        <input
                          type="checkbox"
                          id="vc-{{ i }}"
                          value="{{ vendorCredit.id }}"
                          formControlName="selected"
                          [checked]="vendorCredit?.selected"
                          (change)="onVendorCreditSelected($event, i)"
                        />
                        <span class="check-mark"></span>
                      </label>
                      <input type="hidden" formControlName="vendor_credits" />
                    </td>
                    <td>{{ vendorCredit.vendor_credit_number }}</td>
                    <td>-</td>
                    <td>{{ vendorCredit.vendor_credit_date }}</td>
                    <td class="rupee-symbol rupee-symbol--sm">
                       {{ vendorCredit.total | numberFormat}}
                    </td>
                    <td class="rupee-symbol rupee-symbol--sm">
                      {{ vendorCredit.balance | numberFormat}}
                    </td>
                    <td class="input-wrap error"  [ngClass]="addErrorClass( editBillPaymentForm.controls['vendor_credit'].controls[i].controls.availing)">
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        class="error-box"
                        formControlName="availing"
                        (change)="onChangeCreditAvail(i, vendorCredit)"
                      />
                    </td>
                    <td class="rupee-symbol rupee-symbol--sm">
                       {{
                      editBillPaymentForm.controls['vendor_credit'].controls[i].controls.total_balance.value | numberFormat
                      }}
                    </td>
                  </tr>
                  <tr>
                    <td ></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">
                     Total
                    </td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">
                      {{ currency_type?.symbol}} {{total_Vendor_Credit_Summation.aviling | numberFormat}}
                    </td>
                    <td>
                    </td>

                  </tr>
                </tbody>
                
              </table>
            </div>
          </div>
        </div>
        <div class="form-layout__card mg-top-30" *ngIf="advanceList.length > 0">
          <div class="form-layout__header">
            <h2 class="sub-heading">Vendor Advance</h2>
            <span class="collapse-line"></span>
          </div>
          <div class="mg-top-30">
            <div
              class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg"
            >
              <table class="table-container">
                <thead>
                  <tr>
                    <th width="8%" [ngStyle]="{'padding-right':'60px'}" class="table-checkbox">

                      <label  class="check-box">
                        <input
                          type="checkbox"
                         
                         
                          formControlName="vendorAdvanceAllSelect"(change)="vendorAdvanceAll($event)"
                        />
                        <span class="check-mark"></span>
                      </label>
                    </th>
                    <th width="10%">Reference</th>
                    <th width="20%">Description</th>
                    <th width="10%">Date</th>
                    <th width="15%">
                      Original Amount ({{ currency_type?.symbol}})
                    </th>
                    <th width="15%">
                      Open Balance ({{ currency_type?.symbol}})
                    </th>
                    <th width="10%">Payment</th>
                    <th width="10%">
                      Final Balance ({{ currency_type?.symbol}})
                    </th>
                  </tr>
                </thead>
                <tbody formArrayName="vendor_advances">
                  <tr
                    *ngFor="let vendorAdvance of advanceList; let i = index;"
                    [formGroupName]="i"
                  >
                    <td class="table-checkbox">
                      <label for="va-{{ i }}" class="check-box">
                        <input
                          type="checkbox"
                          id="va-{{ i }}"
                          value="{{ vendorAdvance.id }}"
                          formControlName="selected"
                          [checked]="vendorAdvance?.selected"
                          (change)="onVendorAdvanceSelected($event, i)"
                        />
                        <span class="check-mark"></span>
                      </label>
                      <input type="hidden" formControlName="vendor_advance" />
                    </td>
                    <td>{{ vendorAdvance.advance_number }}</td>
                    <td>{{ vendorAdvance.description_of_supply }}</td>
                    <td>{{ vendorAdvance.date }}</td>
                    <td class="rupee-symbol rupee-symbol--sm">
                       {{ vendorAdvance.amount | numberFormat}}
                    </td>
                    <td class="rupee-symbol rupee-symbol--sm">
                      {{ vendorAdvance.balance | numberFormat}}
                    </td>
                    <td
                      class="input-wrap"
                      [ngClass]="addErrorClass(editBillPaymentForm.controls['vendor_advances'].controls[i].controls.availing)"
                    >
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        class="error-box"
                        formControlName="availing"
                        (change)="onChangeAdvanceAvail(i, vendorAdvance)"
                      />
                    </td>
                    <td class="rupee-symbol rupee-symbol--sm">
                      {{
                      editBillPaymentForm.controls['vendor_advances'].controls[i].controls.total_balance.value | numberFormat
                      }}
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_Vendor_Advances_Summation.aviling | numberFormat}}</td>
                    <td></td>
                  </tr>
                </tbody>
                
              </table>
            </div>
          </div>
        </div>
        <div class="form-layout__card mg-top-30" *ngIf="billList.length > 0">
          <div class="form-layout__header">
            <h2 class="sub-heading">Outstanding Bills</h2>
            <span class="collapse-line"></span>
          </div>
          <div class="mg-top-30">
            <div
              class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg"
            >
              <table class="table-container">
                <thead>
                  <tr>
                    <th width="8%" [ngStyle]="{'padding-right':'60px'}">

                      <label  class="check-box">
                        <input
                        type="checkbox" (change)="outStandingBillsAll($event)" formControlName="outStandingbillsAllSelect"
                        />
                        <span class="check-mark"></span>
                      </label>
                      </th>
                    <th width="11%">Date of Bills</th>
                    <th width="11%">Bill Number</th>
                    <th width="10%">Due Date</th>
                    <th width="10%">
                      Bill Amount ({{ currency_type?.symbol}})
                    </th>
                    <th width="10%">Amount Due ({{ currency_type?.symbol}})</th>
                    <th width="10%">Adjustment</th>
                    <th width="10%" [ngClass]="{'hiddenContent':!isTax||isTds}">
                      Withheld ({{ currency_type?.symbol}})
                    </th>
                    <th width="10%">
                      Amount Paid ({{ currency_type?.symbol}})
                    </th>
                    <th width="10%">Balance ({{ currency_type?.symbol}})</th>
                  </tr>
                </thead>
                <tbody formArrayName="outstanding_bills">
                  <tr
                    *ngFor="let outstandingBill of billList; let i = index;"
                    [formGroupName]="i"
                  >
                    <td class="table-checkbox">
                      <label for="ob-{{ i }}" class="check-box">
                        <input
                          type="checkbox"
                          id="ob-{{ i }}"
                          value="{{ outstandingBill.id }}"
                          formControlName="selected"
                          [checked]="outstandingBill?.selected"
                          (change)="onOutstandingSelected($event, i)"
                        />
                        <span class="check-mark"></span>
                      </label>
                      <input type="hidden" formControlName="bill" />
                    </td>
                    <td>{{ dateChange(outstandingBill.bill_date) }}</td>
                    <td>{{ emptyString(outstandingBill.bill_number) }}</td>
                    <td>{{ dateChange(outstandingBill.due_date) }}</td>
                    <td class="rupee-symbol rupee-symbol--sm">
                      {{ outstandingBill.total | numberFormat}}
                    </td>
                    <td class="rupee-symbol rupee-symbol--sm">
                      {{
                      editBillPaymentForm.controls['outstanding_bills'].controls[i].controls.balance.value | numberFormat
                      }}
                    </td>
                    <td>
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        placeholder="1000"
                        formControlName="adjustment"
                        (change)="onChangeBillAdjustment(i, outstandingBill)"
                      />
                    </td>
                    <td [ngClass]="{'hiddenContent':!isTax||isTds}">
                      <div
                        class="input-wrap"
                        [ngClass]="{disabled: deductAmountDisabled}"
                      >
                        <input
                          positiveThreeDigitDecimalNumber
                          type="text"
                          placeholder="1000"
                          formControlName="withheld"
                          (change)="onChangeBillWithheld(i, outstandingBill.id);"
                        />
                      </div>
                    </td>
                    <td>
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        placeholder="1000"
                        formControlName="amount_paid"
                        (change)="onChangeBillAmount(i, outstandingBill)"
                      />
                    </td>
                    <td
                      class="input-wrap disabled"
                      [ngClass]="addErrorClass(editBillPaymentForm.controls['outstanding_bills'].controls[i].controls.total_balance)"
                    >
                      <input
                        positiveThreeDigitDecimalNumber
                        class="error-box"
                        type="text"
                        placeholder="1000"
                        formControlName="total_balance"
                        [attr.disabled]="true"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">Total</td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}}  {{total_Outstanding_Summation.adjustment | numberFormat}}</td>
                    <td [ngClass]="{'hiddenContent':!isTax||isTds}" class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}}  {{total_Outstanding_Summation.withheld | numberFormat}}</td>
                    <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}}  {{total_Outstanding_Summation.amount_paid | numberFormat}}</td>
                    <td></td>
                  </tr>
                </tbody>
                
              </table>
            </div>
          </div>
        </div>

        <div class="form-layout__card mg-top-30" *ngIf="labourList.length > 0">
          <div class="form-layout__header">
            <h2 class="sub-heading">Outstanding Labour Bills</h2>
            <span class="collapse-line"></span>
          </div>
          <div class="mg-top-30">
            <div
              class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg"
            >
              <table class="table-container">
                <thead>
                  <tr>
                    <th width="8%" [ngStyle]="{'padding-right':'60px'}">
                      <label  class="check-box">
                        <input
                        type="checkbox"  formControlName="outStandingLaborBillsAllSelect" (change)="outStandingLaborBillsAll($event)"                        />
                        <span class="check-mark"></span>
                      </label>
                     </th>
                    <th width="8%">Type</th>
                    <th width="8%">Date</th>
                    <th width="8%">Bill No</th>
                    <th width="8%">Due Date</th>
                    <th width="8%">Bill Amount ({{ currency_type?.symbol}})</th>
                    <th width="8%">Amount Due({{ currency_type?.symbol}})</th>
                    <th width="8%">Adjustment</th>
                    <th width="8%" [ngClass]="{'hiddenContent':!isTax||isTds}">
                      Withheld ({{ currency_type?.symbol}})
                    </th>
                    <th width="8%">Amount Paid ({{ currency_type?.symbol}})</th>
                    <th width="8%">Balance ({{ currency_type?.symbol}})</th>
                  </tr>
                </thead>
                <tbody formArrayName="outstanding_labour_bills">
                  <tr
                    *ngFor="let labourBill of labourList; let i = index;"
                    [formGroupName]="i"
                  >
                    <td class="table-checkbox">
                      <label for="labour-{{ i }}" class="check-box">
                        <input
                          type="checkbox"
                          id="labour-{{ i }}"
                          value="{{ labourBill.id }}"
                          formControlName="selected"
                          [checked]="labourBill?.selected"
                          (change)="onLabourSelected($event, i)"
                        />
                        <span class="check-mark"></span>
                      </label>
                      <!-- <input type="hidden" formControlName="bill"> -->
                    </td>
                    <td>{{ labourBill.type }}</td>
                    <td>{{ dateChange(labourBill.date) }}</td>
                    <td>{{labourBill.bill_number}}</td>
                    <td>{{ dateChange(labourBill.due_date) }}</td>
                    <td>
                      {{labourBill.labour_total_balance | numberFormat }}
                    </td>
                    <td>
                      {{labourBill.labour_balance | numberFormat}}
                    </td>
                    <td>
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        placeholder="1000"
                        formControlName="adjustment"
                        (change)="onChangeBillLabourAdjustment(i, labourBill)"
                      />
                    </td>
                    <td [ngClass]="{'hiddenContent':!isTax||isTds}">
                      <div
                        class="input-wrap"
                        [ngClass]="{disabled: deductAmountDisabled}"
                      >
                        <input
                          positiveThreeDigitDecimalNumber
                          type="text"
                          placeholder="1000"
                          formControlName="withheld"
                          (change)="onChangeBillLabourWithheld(i, labourBill.id);"
                        />
                      </div>
                    </td>
                    <td>
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        placeholder="1000"
                        formControlName="amount_paid"
                        (change)="onChangeBillLabourAmount(i, labourBill)"
                      />
                    </td>
                    <td
                      class="input-wrap disabled"
                      [ngClass]="addErrorClass(editBillPaymentForm.controls['outstanding_labour_bills'].controls[i].controls.total_balance)"
                    >
                      <input
                        positiveThreeDigitDecimalNumber
                        class="error-box"
                        type="text"
                        placeholder="1000"
                        formControlName="total_balance"
                        [attr.disabled]="true"
                      />
                    </td>
                  </tr>
                  <tr>
                  
                    <td class="fs-6 fw-semibold ps-4">{{total_outstanding_labour_Summation.selected}}</td>
                   
                  <td ></td>
                  <td ></td>
                  <td ></td>
                  <td ></td>
                  <td ></td>
                  <td ></td>
                  <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_outstanding_labour_Summation.adjustment | numberFormat}}</td>
                  <td  [ngClass]="{'hiddenContent':!isTax||isTds}">
                    
                  </td>
                  <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_outstanding_labour_Summation.amount_paid | numberFormat}}</td>
                  <td class="rupee-symbol rupee-symbol--sm fw-semibold fs-6">{{ currency_type?.symbol}} {{total_outstanding_labour_Summation.totalBalance | numberFormat}}</td>
                  
                  

                </tr>
                </tbody>
                
              </table>
            </div>
          </div>
        </div>

        <div class="form-layout__card mg-top-30" *ngIf="foremanList.length > 0">
          <div class="form-layout__header">
            <h2 class="sub-heading">Outstanding Foreman Salary</h2>
            <span class="collapse-line"></span>
          </div>
          <div class="mg-top-30">
            <div
              class="table-wrapper table-wrapper--type1 table-wrapper--type2 table--bd table--nobg"
            >
              <table class="table-container">
                <thead>
                  <tr>
                    <th width="8%" [ngStyle]="{'padding-right':'45px'}">
                     
                      <label  class="check-box">
                        <input
                        type="checkbox" formControlName="foremanAllSelect" (change)="foremanAllSelected($event)"    />
                        <span class="check-mark"></span>
                      </label>
                    </th>
                    <th width="8%">Type</th>
                    <th width="8%">Date</th>
                    <th width="8%">Bill No</th>
                    <th width="8%">Due Date</th>
                    <th width="8%">Bill Amount ({{ currency_type?.symbol}})</th>
                    <th width="8%">Amount Due({{ currency_type?.symbol}})</th>
                    <th width="8%">Adjustment</th>
                    <th width="8%" [ngClass]="{'hiddenContent':!isTax||isTds}">
                      Withheld ({{ currency_type?.symbol}})
                    </th>
                    <th width="8%">Amount Paid ({{ currency_type?.symbol}})</th>
                    <th width="8%">Balance ({{ currency_type?.symbol}})</th>
                  </tr>
                </thead>
                <tbody formArrayName="outstanding_foreman_bills">
                  <tr
                    *ngFor="let foreman of foremanList; let i = index;"
                    [formGroupName]="i"
                  >
                    <td class="table-checkbox">
                      <label for="foreman-{{ i }}" class="check-box">
                        <input
                          type="checkbox"
                          id="foreman-{{ i }}"
                          value="{{ foreman.id }}"
                          formControlName="selected"
                          [checked]="foreman?.selected"
                          (change)="onForemanSelected($event, i)"
                        />
                        <span class="check-mark"></span>
                      </label>
                      <!-- <input type="hidden" formControlName="bill"> -->
                    </td>
                    <td>{{ foreman.type }}</td>
                    <td>{{ dateChange(foreman.date) }}</td>
                    <td>{{foreman.bill_number}}</td>
                    <td>{{ dateChange(foreman.due_date) }}</td>
                    <td>{{foreman.foreman_total_balance | numberFormat}}</td>
                    <td>{{foreman.foreman_balance | numberFormat}}</td>
                    <td>
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        placeholder="1000"
                        formControlName="adjustment"
                        (change)="onChangeBillForemanAdjustment(i, foreman)"
                      />
                    </td>
                    <td [ngClass]="{'hiddenContent':!isTax||isTds}">
                      <div
                        class="input-wrap"
                        [ngClass]="{disabled: deductAmountDisabled}"
                      >
                        <input
                          positiveThreeDigitDecimalNumber
                          type="text"
                          placeholder="1000"
                          formControlName="withheld"
                          (change)="onChangeBillForemanWithheld(i, foreman.id);"
                        />
                      </div>
                    </td>
                    <td>
                      <input
                        positiveThreeDigitDecimalNumber
                        type="text"
                        placeholder="1000"
                        formControlName="amount_paid"
                        (change)="onChangeBillForemanAmount(i, foreman)"
                      />
                    </td>
                    <td
                      class="input-wrap disabled"
                      [ngClass]="addErrorClass(editBillPaymentForm.controls['outstanding_foreman_bills'].controls[i].controls.total_balance)"
                    >
                      <input
                        positiveThreeDigitDecimalNumber
                        class="error-box"
                        type="text"
                        placeholder="1000"
                        formControlName="total_balance"
                        [attr.disabled]="true"
                      />
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.payment_mode)"
            >
              <label for="" class="input--required">Payment Mode</label>
              <material-dropdown
                [searchable]="true"
                [addable]="false"
                class="dropDownWidth"
                [selectedOption]="initialValues.paymentMode"
              >
                <select
                  #customSelect
                  formControlName="payment_mode"
                  class="no-style select--modify"
                >
                  <option
                    *ngFor="let account of accountList"
                    value="{{ account.id }}"
                  >
                    {{ account.name }}
                  </option>
                </select>
              </material-dropdown>
              <app-error
                [controlName]="editBillPaymentForm.controls.payment_mode"
              ></app-error>
            </div>
          </div>
          <div *ngIf="billPaymentId" class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.amount_paid)"
            >
              <label for="" [ngClass]="{'input--required':isAmount_Paid_Require}"
                >Amount Paid ({{ currency_type?.symbol}})</label
              >
              <input
                positiveThreeDigitDecimalNumber
                type="text"
                class="no-style input--bd"
                placeholder="2000"
                formControlName="amount_paid"
                (change)="calculateAmountPaid();"
              />
             <!--  <span class="border-anim"></span> -->
              <app-error
                [controlName]="editBillPaymentForm.controls.amount_paid"
              ></app-error>
            </div>
          </div>

          <div *ngIf="!billPaymentId" class="col-lg-3 col-sm-6">
            <div
              class="input-wrap error"
              [ngClass]="addErrorClass(editBillPaymentForm.controls.amount_paid)"
            >
              <label for="" [ngClass]="{'input--required':isAmount_Paid_Require}"
                >Amount Paid ({{ currency_type?.symbol}})</label
              >
              <input
                positiveThreeDigitDecimalNumber
                type="text"
                class="no-style input--bd"
                placeholder="2000"
                formControlName="amount_paid"
                (change)= "calculateTotal()"
              />
              <!-- (change)="autoFillOutStandingBalances()" -->
             <!--  <span class="border-anim"></span> -->
              <app-error
                [controlName]="editBillPaymentForm.controls.amount_paid"
              ></app-error>
            </div>
          </div>
        </div>












   <div class="gst-table-wrapper mg-top-30 gst-space">
        <div class="text-end gst-main">
          <div class="text-end gst-left"> <strong> Credit availed: </strong></div>
          <div class="px-0 text-end ms-3 gst-right"><strong>{{ currency_type?.symbol}} {{ billPaymentsTotals.creditAvailed | numberFormat}}</strong></div>
        </div>
        <div class="text-end gst-main">
          <div class="text-end gst-left"> <strong> Advance availed: </strong></div>
          <div class="px-0 text-end ms-3 gst-right"><strong>{{ currency_type?.symbol}} {{ billPaymentsTotals.advanceAvailed | numberFormat}}</strong></div>
        </div>
        <div class="text-end gst-main">
          <div class="text-end gst-left"> <strong> Amount paid: </strong></div>
          <div class="px-0 text-end ms-3 gst-right"><strong> {{ currency_type?.symbol}} {{ billPaymentsTotals.amountPaid | numberFormat}}</strong></div>
        </div>
        <div class="text-end gst-main"  [ngClass]="{'hiddenContent':!isTax||isTds}">
          <div class="text-end gst-left"> <strong> Withheld amount: </strong></div>
          <div class="px-0 text-end ms-3 gst-right"><strong>  {{ currency_type?.symbol}} {{ billPaymentsTotals.withheldAmount | numberFormat}}</strong></div>
        </div>
        <div class="text-end gst-main">
          <div class="px-0 text-end ms-3 gst-left flex-column d-block"><strong> Total: </strong>

            <p class="fw-light fst-italic py-2 pt-3">
              Bill Amount paid: {{ currency_type?.symbol}} {{ editBillPaymentForm.controls['amount_paid'].value | numberFormat}}
            </p>
            <p class="fw-light fst-italic py-2">
              Vendor Advance: {{ currency_type?.symbol}} {{ billPaymentsTotals.advanceAvailed | numberFormat}}
            </p>
            <p class="fw-light fst-italic py-2">
              Vendor Credit: {{ currency_type?.symbol}} {{ billPaymentsTotals.creditAvailed | numberFormat}}
            </p>
            <p class="fw-light fst-italic py-2">
              Discount: {{ currency_type?.symbol}} {{ billPaymentsTotals.discountAmount | numberFormat}}
            </p>
          </div>
          <div class="px-0 text-end ms-3 gst-right"><strong> {{ currency_type?.symbol}} {{ billPaymentsTotals.amountPayable | numberFormat}}</strong></div>
        </div>
    </div>

         <div class="row">
          <div class="col-xl-3 col-lg-3  col-md-3 col-6">
            <div class="input-wrap clearfix">
              <label for="" class="">Signature</label>
              <div>
                <material-dropdown [selectedOption]="initialValues.digitalSignature">
                  <select #customSelect class="no-style select--modify" formControlName="signature">
                    <option *ngFor="let option of digitalSignature " value="{{option.id}}">{{option.name}}
                    </option>
                  </select>
                </material-dropdown>
              </div>
            </div>
          </div>
          <div class="col-xl-9 col-lg-9  col-md-9 col-9">
            <div class="row tabIndexActiveFields">
              <div class="col-sm-6">
                <div class="input-wrap mb-0 pb-3">
                  <label for="" class="">Comments and Remarks</label>
                  <input
                    type="text"
                    class="no-style input--bd"
                    placeholder="Comments"
                    formControlName="comment"
                  />
                </div>
              </div>
            </div>
          </div>
         </div>

        <div class="form-layout__card mg-top-30">
          <file-uploader
            (onFileUploaded)="fileUploader($event)"
            (onFileDeleted)="fileDeleted($event)"
            [multiple]="true"
            [accept]="'capture=camera, image/jpeg,image/x-jpg,image/png, application/pdf'"
            [showFileName]="false"
            [patchFileUrls]="patchFileUrls"
          >
          </file-uploader>
        </div>
      </div>
    </div>
  </div>

    
      
</form> 
 <div  class="footer-bg p-2 px-4 custom-footer-bg d-flex justify-content-end">
<button
        class="btn btn--sm me-2"
        [routerLink]="[prefixUrl+'/payments/list/bill']"
        routerLinkActive="active"
      >
        Cancel
      </button>
      <button
        *ngIf="billPaymentId"
        class="btn btn--primary w-auto"
        (click)="updateBillPayment()"
      >
        Update Payment Made
      </button>
      <button
        *ngIf="!billPaymentId"
        class="btn btn--primary w-auto"
        (click)="submitBillPayment()"
      >
        Record Payment Made
      </button>
    
  </div>
<!-- Popup for adding party details -->
<app-add-party-popup
  [popDetail]="showAddPartyPopup"
  (closeModal)="closePartyPopup()"
  (partyAdded)="addPartyToOption($event)"
  [isVendor]="true"

></app-add-party-popup>

<!-- video-popup -->
<app-go-through  [goThroughDetais]="goThroughDetais"></app-go-through>
