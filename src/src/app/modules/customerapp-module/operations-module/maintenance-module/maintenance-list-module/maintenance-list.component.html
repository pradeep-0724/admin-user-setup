<div class="calc-height">
  <app-list-widget [isFilter]="true" [isDateRangeText]="true" [isDateRange]="false" [isDropDown]="true"
    [filterUrl]="filterUrl" [subtractDays]="30" [end_date]="end_date" [isDateDropDown]="true"
    [tabSelectionList]="tabSelectionList" (listWidgetData)="listWidgetData($event)">
    <button class="gb-video-play me-2" id="custom-button-left" (click)="openGothrough()">
      <i class="bi bi-play-circle-fill"></i>
    </button>
    <button class="btn btn--primary w-auto" id="custom-button-right" *ngxPermissionsOnly="maintenancePermission[0]"
      (click)="openAddMaintenance()">
      + Add Maintenance
    </button>
  </app-list-widget>
  <div class="container-fluid layout-bg">
    <div class="row px-3 py-3 shadow-inset-top">
      <div class="col-12">
        <span class="live-status-toggle" (click)="isLiveStatusOpen = !isLiveStatusOpen">
          <span>
            <i class="bi bi-caret-right-fill" *ngIf="!isLiveStatusOpen"></i>
            <i class="bi bi-caret-down-fill" *ngIf="isLiveStatusOpen"></i>
          </span>
          <span class="ms-3">Live Status</span></span>
      </div>
    </div>
    <div class="row px-3 def-color live-status-wrap" *ngIf="isLiveStatusOpen">
      <div class="col-lg col-md-4 col-6">
        <div class="live-status-card yellow-card">
          <span class="live-status-icon"><i class="bi bi-file-earmark-fill"></i></span>
          <div>
            <p class="fs-4 fw-semibold trips-amount">
              {{ liveStatus?.scheduled }}
            </p>
            <p class="fs-12px mt-2 pending-text">Scheduled Jobs</p>
          </div>
        </div>
      </div>
      <div class="col-lg col-md-4 col-6">
        <div class="live-status-card blue-card">
          <span class="live-status-icon"><i class="bi bi-file-earmark-fill"></i></span>
          <div>
            <p class="fs-4 fw-semibold trips-amount">
              {{ liveStatus?.inprogress }}
            </p>
            <p class="fs-12px mt-2 sky-blue-text">In-progress Jobs</p>
          </div>
        </div>
      </div>

      <div class="col-lg col-md-4 col-6">
        <div class="live-status-card yellow-card">
          <span class="live-status-icon"><i class="bi bi-file-earmark-fill"></i></span>
          <div>
            <p class="fs-4 fw-semibold trips-amount">
              {{
              liveStatus?.over_due?.scheduled +
              liveStatus?.over_due?.inprogress
              }}
            </p>
            <p class="d-flex align-items-center pending-text fs-12px">
              Overdue<mat-icon class="drop-down" mat-icon-button
                [matMenuTriggerFor]="overDueMenu">arrow_drop_down</mat-icon>
            </p>
          </div>
        </div>
      </div>
      <div class="col-lg col-md-4 col-6">
        <div class="live-status-card red-card">
          <span class="live-status-icon"><i class="bi bi-file-earmark-fill"></i></span>
          <div>
            <p class="fs-4 fw-semibold trips-amount">
              {{ currency_type?.symbol }}
              {{ liveStatus?.outstandings ? liveStatus?.outstandings : "0" }}
            </p>
            <p class="fs-12px mt-2 warn-text">Total Payable</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mx-0">
  <div class="custom-table-container bg-white fuel-list-wrap p-0 pb-4" (scroll)="onScroll($event)"
    id="maintenance-list">
    <table [ngClass]="{ 'h-100': maintenanceList.length == 0 }">
      <thead>
        <tr>
          <th>SCHEDULE DATE</th>
          <th>JOB CARD NO.</th>
          <th>VEHICLE/ASSET NO.</th>
          <th>PRIORITY</th>
          <th>TOTAL DAYS</th>
          <th>JOB CARD STATUS</th>
          <th class="icon-box"></th>
        </tr>
      </thead>
      <tbody *ngIf="maintenanceList.length == 0">
        <tr class="border-0">
          <td class="bg-white" colspan="30">
            <div class="no-list-data-wrap">
              <figure>
                <img src="assets/img/no-content.png" alt="" />
              </figure>
              <h5 class="mt-3 primary-brand-text">No data found!</h5>
            </div>
          </td>
        </tr>
      </tbody>

        <tbody>
          <tr *ngFor="let data of maintenanceList" [ngClass]="{'activated-row':selectedId==data.id}">
            <td>{{data?.start_date}}</td>
            <td ><span class="custom-link" (click)="navigateToJobCardDetails(data.id)">{{data?.job_card_no}}</span></td>
            <ng-container  *ngIf="data?.vehicle?.id && !data?.vehicle.is_asset;else elseBlock">
              <td *ngIf="data?.vehicle?.id && !data?.vehicle.is_market">
                <a class="custom-link"  target="_blank" [routerLink]="[prefixUrl+'/onboarding/vehicle/own/details',data?.vehicle.id]"  > {{data?.vehicle?.reg_no}} </a>
              </td>
            </ng-container>
            <ng-template #elseBlock>
              <td>
                <a class="custom-link"  target="_blank" [routerLink]="[prefixUrl+'/onboarding/assets/view',data?.vehicle.id]"  > {{data?.vehicle?.reg_no}} </a>
               </td>
            </ng-template>

          <td>
            <img [src]="
                '/assets/img/icons/priority-' + getImageType(data) + '.png'
              " class="priority-icon" alt="" />
            {{ data | priorityPipe }}
          </td>
          <td>{{ data?.total_days ? data?.total_days : "-" }}</td>
          <td>
            <span [ngStyle]="{ color: getJobCardColour(data) }">
              {{ data?.status }}
            </span>
          </td>
          <td *ngxPermissionsOnly="maintenancePermission[2]" class="icon-box">
            <div class="d-flex justify-content-center align-items-center">
              <button *ngIf="data?.can_delete" (click)="jobCardDeletePopUp(data)" class="del-btn">
                <i class="material-icons text-danger">delete</i>
              </button>

              <app-tool-tip *ngIf="!data?.can_delete" class="point-type" [totalSlides]="delete_Tooltip.content.length"
                position="left" [toolTipContent]="delete_Tooltip" [customIcon]="delIcon">
              </app-tool-tip>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<alert-popup [inputData]="maintenanceInputData" (outputData)="confirmButton($event)"></alert-popup>
<app-go-through [goThroughDetais]="goThroughDetais"></app-go-through>

<mat-menu #overDueMenu="matMenu" yPosition="below" class="py-2">
  <div mat-menu-item>
    <span>Scheduled </span>
    <span class="primary-brand-text float-end fw-bold">&nbsp; {{ liveStatus?.over_due?.scheduled }}
    </span>
  </div>

  <div mat-menu-item>
    <span>In-progress </span>
    <span class="primary-brand-text float-end fw-bold">&nbsp; {{ liveStatus?.over_due?.inprogress }}
    </span>
  </div>
</mat-menu>